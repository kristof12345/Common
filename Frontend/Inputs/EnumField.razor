@namespace Common.Web
@inherits AppInput<TEnum>

@using Syncfusion.Blazor.Inputs
@using Common.Application
@using Syncfusion.Blazor.DropDowns
@using Microsoft.AspNetCore.Components.Forms

@typeparam TEnum

<p style=@($"width: {Width}")>
    <SfDropDownList Value=@EnumExtensions.GetAttributeValue(Value) ValueChanged=@HandleValueChange DataSource=@Values FloatLabelType=@FloatLabelType.Auto Placeholder=@Label CssClass="e-outline e-bigger form-input" Enabled=@(!Disabled) TValue=string TItem=string />
    @if (ValidationExpression != null)
    {
        <ValidationMessage For=@ValidationExpression />
    }
</p>

@code
{
    [Parameter]
    public List<string> Except { get; set; } = new List<string>();

    private List<string> Values { get => EnumExtensions.GetAttributeList<TEnum>().Except(Except).ToList(); }

    private async Task HandleValueChange(string value)
    {
        if (!string.IsNullOrEmpty(value))
        {
            var EnumValue = EnumExtensions.GetValueFromAttribute<TEnum>(value);
            if (Value.ToString() != EnumValue.ToString())
            {
                await ValueChanged.InvokeAsync(EnumValue);
                await OnInput.InvokeAsync();
            }
        }
    }
}