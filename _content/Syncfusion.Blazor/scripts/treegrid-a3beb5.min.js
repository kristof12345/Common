!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="_content/Syncfusion.Blazor/scripts/",i(i.s="./bundles/treegrid.js")}({"./bundles/treegrid.js":function(e,t,i){"use strict";i.r(t);i("./modules/treegrid.js")},"./modules/treegrid.js":function(e,t){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.sf=window.sf||{},window.sf.treegrid=function(e){"use strict";var t,r,n,s,a=function(e){this.allowEditing=!0,this.edit={},this.disableHtmlEncode=!0,this.allowReordering=!0,this.showColumnMenu=!0,this.allowFiltering=!0,this.allowSorting=!0,this.allowResizing=!0,this.filter={},sf.base.merge(this,e)},o=(t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)},function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),d=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),d([sf.base.Property()],t.prototype,"field",void 0),d([sf.base.Property()],t.prototype,"operator",void 0),d([sf.base.Property()],t.prototype,"value",void 0),d([sf.base.Property()],t.prototype,"matchCase",void 0),d([sf.base.Property()],t.prototype,"ignoreAccent",void 0),d([sf.base.Property()],t.prototype,"predicate",void 0),d([sf.base.Property({})],t.prototype,"actualFilterValue",void 0),d([sf.base.Property({})],t.prototype,"actualOperator",void 0),d([sf.base.Property()],t.prototype,"type",void 0),d([sf.base.Property()],t.prototype,"ejpredicate",void 0),d([sf.base.Property()],t.prototype,"uid",void 0),d([sf.base.Property()],t.prototype,"isForeignKey",void 0),t}(sf.base.ChildProperty),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),d([sf.base.Collection([],l)],t.prototype,"columns",void 0),d([sf.base.Property("FilterBar")],t.prototype,"type",void 0),d([sf.base.Property()],t.prototype,"mode",void 0),d([sf.base.Property(!0)],t.prototype,"showFilterBarStatus",void 0),d([sf.base.Property(1500)],t.prototype,"immediateModeDelay",void 0),d([sf.base.Property()],t.prototype,"operators",void 0),d([sf.base.Property(!1)],t.prototype,"ignoreAccent",void 0),d([sf.base.Property("Parent")],t.prototype,"hierarchyMode",void 0),t}(sf.base.ChildProperty),h=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),c=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),c([sf.base.Property("Both")],t.prototype,"wrapMode",void 0),t}(sf.base.ChildProperty),g=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),f="https://ej2.syncfusion.com/documentation/treegrid",y="https://ej2.syncfusion.com/documentation",b=!1,m=function(e){function t(t){return sf.grids.Grid.Inject(sf.grids.Logger),e.call(this,t)||this}return g(t,e),t.prototype.getModuleName=function(){return"logger"},t.prototype.log=function(e,t){e instanceof Array||(e=[e]);for(var i=e,r=0;r<i.length;r++){var n=sf.grids.detailLists[i[r]],s=n.check(t,this.parent);if(s.success){var a=n.generateMessage(t,this.parent,s.options);a=a.replace("EJ2Grid","EJ2TreeGrid").replace("* Hierarchy Grid","").replace("* Grouping",""),b&&"primary_column_missing"===i[r]&&(a=a.replace("Editing","Row DragAndDrop"),b=!1);var o=a.indexOf("https"),d=a.substring(o);"module_missing"===i[r]?a=a.replace(d,f+"/modules"):"primary_column_missing"===i[r]||"selection_key_missing"===i[r]?a=a.replace(d,y+"/api/treegrid/column/#isprimarykey"):"grid_remote_edit"===i[r]?a=a.replace(d,f+"/edit"):"virtual_height"===i[r]?a=a.replace(d,f+"/virtual"):"check_datasource_columns"===i[r]?a=a.replace(d,f+"/columns"):"locale_missing"===i[r]&&(a=a.replace(d,f+"/global-local/#localization")),"datasource_syntax_mismatch"===i[r]&&(sf.base.isNullOrUndefined(this.treeGridObj)||sf.base.isNullOrUndefined(this.treeGridObj.dataStateChange))||console[n.logType](a)}}},t.prototype.treeLog=function(e,t,i){this.treeGridObj=i,e instanceof Array||(e=[e]);var r=e;i.allowRowDragAndDrop&&!i.columns.filter((function(e){return e.isPrimaryKey})).length&&(b=!0,this.log("primary_column_missing",t));for(var n=0;n<r.length;n++){var s=v[r[n]],a=s.check(t,i);if(a.success){var o=s.generateMessage(t,i,a.options);console[s.logType](o)}}},t}(sf.grids.Logger),v={mapping_fields_missing:{type:"mapping_fields_missing",logType:"error",check:function(e,t){var i={success:!1};return(sf.base.isNullOrUndefined(t.idMapping)&&sf.base.isNullOrUndefined(t.childMapping)&&sf.base.isNullOrUndefined(t.parentIdMapping)||!sf.base.isNullOrUndefined(t.idMapping)&&sf.base.isNullOrUndefined(t.parentIdMapping)||sf.base.isNullOrUndefined(t.idMapping)&&!sf.base.isNullOrUndefined(t.parentIdMapping))&&(i={success:!0}),i},generateMessage:function(){return"[EJ2TreeGrid.Error]: MAPPING FIELDS MISSING \nOne of the following fields is missing. It is required for the hierarchical relationship of records in TreeGrid:\n* childMapping\n* idMapping\n* parentIdMapping\nRefer to the following documentation links for more details.\n"+y+"/api/treegrid#childmapping\n"+y+"/api/treegrid#idmapping\n"+y+"/api/treegrid#$parentidmapping"}}},w=(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),R=function(e){function t(t){var i=e.call(this,t.grid)||this;return i.treeCopyContent="",i.copiedUniqueIdCollection=[],i.treeGridParent=t,i}return w(t,e),t.prototype.setCopyData=function(t){var i=this.treeGridParent.getCurrentViewRecords();if(""===window.getSelection().toString()){this.clipBoardTextArea.value=this.copyContent="";var r=this.treeGridParent.grid.getRows();if("Cell"!==this.treeGridParent.selectionSettings.mode){for(var n=this.treeGridParent.getSelectedRowIndexes().sort((function(e,t){return e-t})),s=0;s<n.length;s++)if(s>0&&(this.treeCopyContent+="\n"),!r[n[s]].classList.contains("e-summaryrow")){var a=[].slice.call(r[n[s]].querySelectorAll(".e-rowcell")),o=this.treeGridParent.getSelectedRecords()[s].uniqueID;-1===this.copiedUniqueIdCollection.indexOf(o)&&("Parent"!==this.treeGridParent.copyHierarchyMode&&"Both"!==this.treeGridParent.copyHierarchyMode||this.parentContentData(i,n[s],r,t,s),this.getCopyData(a,!1,"\t",t),this.treeCopyContent+=this.copyContent,this.copiedUniqueIdCollection.push(o),this.copyContent="","Child"!==this.treeGridParent.copyHierarchyMode&&"Both"!==this.treeGridParent.copyHierarchyMode||this.childContentData(i,n[s],r,t))}if(t){var d=[];for(s=0;s<this.treeGridParent.getVisibleColumns().length;s++)d[s]=this.treeGridParent.getVisibleColumns()[s].headerText;this.getCopyData(d,!1,"\t",t),this.treeCopyContent=this.copyContent+"\n"+this.treeCopyContent}var l={data:this.treeCopyContent,cancel:!1};if(this.treeGridParent.trigger("beforeCopy",l),l.cancel)return;this.clipBoardTextArea.value=this.copyContent=l.data,sf.base.Browser.userAgent.match(/ipad|ipod|iphone/i)?this.clipBoardTextArea.setSelectionRange(0,this.clipBoardTextArea.value.length):this.clipBoardTextArea.select(),this.isSelect=!0,this.copiedUniqueIdCollection=[],this.treeCopyContent=""}else e.prototype.setCopyData.call(this,t)}},t.prototype.parentContentData=function(e,t,i,r,n){if(!sf.base.isNullOrUndefined(e[t].parentItem))for(var s=e[t].parentItem.level,a=0;a<s+1;a++)for(var o=0;o<e.length;o++)if(!sf.base.isNullOrUndefined(e[t].parentItem)&&e[o].uniqueID===e[t].parentItem.uniqueID){t=o;var d=[].slice.call(i[t].querySelectorAll(".e-rowcell")),l=e[o].uniqueID;if(-1===this.copiedUniqueIdCollection.indexOf(l)){this.getCopyData(d,!1,"\t",r),this.treeCopyContent=n>0?this.treeCopyContent+this.copyContent+"\n":this.copyContent+"\n"+this.treeCopyContent,this.copiedUniqueIdCollection.push(l),this.copyContent="";break}}},t.prototype.copy=function(t){e.prototype.copy.call(this,t)},t.prototype.paste=function(t,i,r){e.prototype.paste.call(this,t,i,r)},t.prototype.getModuleName=function(){return"clipboard"},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.childContentData=function(e,t,i,r){if(e[t].hasChildRecords)for(var n=e[t].childRecords,s=0;s<n.length;s++)for(var a=0;a<e.length;a++)if(!sf.base.isNullOrUndefined(n[s].uniqueID)&&e[a].uniqueID===n[s].uniqueID){if(!sf.base.isNullOrUndefined(i[a])&&!i[a].classList.contains("e-summaryrow")){var o=[].slice.call(i[a].querySelectorAll(".e-rowcell")),d=e[a].uniqueID;-1===this.copiedUniqueIdCollection.indexOf(d)&&(this.getCopyData(o,!1,"\t",r),this.treeCopyContent+="\n"+this.copyContent,this.copyContent="",this.copiedUniqueIdCollection.push(d),this.childContentData(e,a,i,r))}break}},t}(sf.grids.Clipboard);function C(e){if(e.dataSource instanceof sf.data.DataManager){var t=e.dataSource.adaptor;return t instanceof sf.data.ODataAdaptor||t instanceof sf.data.WebApiAdaptor||t instanceof sf.data.WebMethodAdaptor||t instanceof sf.data.CacheAdaptor||t instanceof sf.data.UrlAdaptor}return!1}function x(e){return!(!e.dataSource||!("result"in e.dataSource))}function S(e){for(var t=0;t<e.columns.length;t++)if(e.columns[t].showCheckbox)return!0;return!1}function I(e){return!((sf.base.isNullOrUndefined(e.grid.searchSettings.key)||""===e.grid.searchSettings.key||"Child"!==e.searchSettings.hierarchyMode&&"None"!==e.searchSettings.hierarchyMode)&&(!e.allowFiltering||!e.grid.filterSettings.columns.length||"Child"!==e.filterSettings.hierarchyMode&&"None"!==e.filterSettings.hierarchyMode))}function D(e){for(var t=[],i=0,r=Object.keys(e).length;i<r;i++){sf.grids.getObject("hasChildRecords",e[i])&&t.push(e[i])}return t}function M(e,t,i){var r,n=sf.base.isNullOrUndefined(t.parentItem)?null:k(e,t.parentItem.uniqueID);return null==n||(!e.initialRender||sf.base.isNullOrUndefined(n[e.expandStateMapping])||n[e.expandStateMapping]?!1!==n.expanded&&(!n.parentItem||((r=k(e,n.parentItem.uniqueID))&&e.initialRender&&!sf.base.isNullOrUndefined(r[e.expandStateMapping])&&!r[e.expandStateMapping]?(r.expanded=!1,!1):(!r||!1!==r.expanded)&&(!r||M(e,r,i)))):(n.expanded=!1,!1))}function O(e){var t=[];if(sf.base.isNullOrUndefined(e)||!e.hasChildRecords&&!sf.base.isNullOrUndefined(e.childRecords)&&!e.childRecords.length)return[];if(!sf.base.isNullOrUndefined(e.childRecords))for(var i=e.childRecords,r=0,n=Object.keys(i).length;r<n;r++)t.push(i[r]),(i[r].hasChildRecords||!sf.base.isNullOrUndefined(i[r].childRecords)&&i[r].childRecords.length)&&(t=t.concat(O(i[r])));return t}function P(e){if(C(e)){var t=e.dataSource;return!sf.base.isNullOrUndefined(t.ready)}return!0}function E(e){for(var t,i,r=[],n=0;e&&n<e.length;n++){i=Object.keys(e[n]),t={};for(var s=0;s<i.length;s++)t[i[s]]=e[n][i[s]];r.push(t)}return r}function A(e){return delete e.hasChildRecords,delete e.childRecords,delete e.index,delete e.parentItem,delete e.level,delete e.taskData,delete e.uniqueID,e}function k(e,t,i){if(i){return e.uniqueIDFilterCollection[t]}return e.uniqueIDCollection[t]}function N(e){var t=window.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility}var q,U,B,T,L=function(){function e(e){this.parent=e,this.selectedItems=[],this.selectedIndexes=[],this.filteredList=[],this.addEventListener()}return e.prototype.getModuleName=function(){return"selection"},e.prototype.addEventListener=function(){this.parent.on("dataBoundArg",this.headerCheckbox,this),this.parent.on("columnCheckbox",this.columnCheckbox,this),this.parent.on("updateGridActions",this.updateGridActions,this),this.parent.grid.on("colgroup-refresh",this.headerCheckbox,this),this.parent.on("checkboxSelection",this.checkboxSelection,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("dataBoundArg",this.headerCheckbox),this.parent.off("columnCheckbox",this.columnCheckbox),this.parent.grid.off("colgroup-refresh",this.headerCheckbox),this.parent.off("checkboxSelection",this.checkboxSelection),this.parent.off("updateGridActions",this.updateGridActions))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.checkboxSelection=function(e){var t,i=sf.grids.getObject("target",e),r=sf.grids.parentsUntil(i,"e-checkbox-wrapper");if(r&&r.querySelectorAll(".e-treecheckselect").length>0){t=r.querySelector('input[type="checkbox"]');var n=[];n.push(i.closest("tr").rowIndex),this.selectCheckboxes(n),this.triggerChkChangeEvent(t,t.nextElementSibling.classList.contains("e-check"),i.closest("tr"))}else if(r&&r.querySelectorAll(".e-treeselectall").length>0&&this.parent.autoCheckHierarchy){var s=!r.querySelector(".e-frame").classList.contains("e-check")&&!r.querySelector(".e-frame").classList.contains("e-stop");this.headerSelection(s),t=r.querySelector('input[type="checkbox"]'),this.triggerChkChangeEvent(t,s,i.closest("tr"))}},e.prototype.triggerChkChangeEvent=function(e,t,i){var r=this.parent.getCurrentViewRecords()[i.rowIndex],n={checked:t,target:e,rowElement:i,rowData:e.classList.contains("e-treeselectall")?this.parent.getCheckedRecords():r};this.parent.trigger("checkboxChange",n)},e.prototype.getCheckboxcolumnIndex=function(){for(var e,t,i=this.parent.columns,r=0;r<i.length;r++)i[r].showCheckbox&&(e=this.parent.columns[r].uid);for(var n=this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv").length,s=0;s<n;s++){this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv")[s].getAttribute("e-mappinguid")===e&&(t=s)}return t},e.prototype.headerCheckbox=function(){if(this.columnIndex=this.getCheckboxcolumnIndex(),this.columnIndex>-1&&0===this.parent.getHeaderContent().querySelectorAll(".e-treeselectall").length){var e=this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv")[this.columnIndex],t=this.parent.createElement("input",{className:"e-treeselectall",attrs:{type:"checkbox"}});(i=sf.buttons.createCheckBox(this.parent.createElement,!1,{checked:!1,label:" "})).classList.add("e-hierarchycheckbox"),i.insertBefore(t.cloneNode(),i.firstChild),sf.base.isNullOrUndefined(e)||e.insertBefore(i,e.firstChild),this.parent.autoCheckHierarchy&&this.headerSelection()}else if(this.columnIndex>-1&&this.parent.getHeaderContent().querySelectorAll(".e-treeselectall").length>0){var i,r=(i=this.parent.getHeaderContent().querySelectorAll(".e-checkbox-wrapper")[0]).querySelector(".e-frame").classList.contains("e-check");this.parent.autoCheckHierarchy&&r&&this.headerSelection(r)}},e.prototype.renderColumnCheckbox=function(e){var t=this.parent.createElement("input",{className:"e-treecheckselect",attrs:{type:"checkbox"}}),i=e.data;e.cell.classList.add("e-treegridcheckbox"),e.cell.setAttribute("aria-label","checkbox");var r=!sf.base.isNullOrUndefined(i.checkboxState)&&"uncheck"!==i.checkboxState,n=sf.buttons.createCheckBox(this.parent.createElement,!1,{checked:r,label:" "});if(n.classList.add("e-hierarchycheckbox"),this.parent.allowTextWrap&&(n.querySelector(".e-frame").style.width="18px"),"indeterminate"===i.checkboxState){var s=n.querySelectorAll(".e-frame")[0];sf.base.removeClass([s],["e-check","e-stop","e-uncheck"]),n.querySelector(".e-frame").classList.add("e-stop")}return n.insertBefore(t.cloneNode(),n.firstChild),n},e.prototype.columnCheckbox=function(e){var t=this.renderColumnCheckbox(e),i=e.cell.querySelector(".e-treecolumn-container");if(sf.base.isNullOrUndefined(i)){var r=this.parent.createElement("span",{className:"e-treecheckbox"}),n=e.cell.innerHTML;e.cell.innerHTML="",r.innerHTML=n;var s=this.parent.createElement("div",{className:"e-treecheckbox-container"});s.appendChild(t),s.appendChild(r),e.cell.appendChild(s)}else e.cell.querySelector(".e-hierarchycheckbox")||i.insertBefore(t,i.querySelectorAll(".e-treecell")[0])},e.prototype.selectCheckboxes=function(e){for(var t=0;t<e.length;t++){var i=this.parent.getCurrentViewRecords()[e[t]],r=k(this.parent,i.uniqueID),n="uncheck"===(i=r).checkboxState?"check":"uncheck";i.checkboxState=n;for(var s=Object.keys(i),a=0;a<s.length;a++)Object.prototype.hasOwnProperty.call(r,s[a])&&(r[s[a]]=i[s[a]]);this.traverSelection(i,n,!1),this.parent.autoCheckHierarchy&&this.headerSelection()}},e.prototype.traverSelection=function(e,t,i){var r=0;if(this.updateSelectedItems(e,t),!i&&e.parentItem&&this.parent.autoCheckHierarchy&&this.updateParentSelection(e.parentItem),e.childRecords&&this.parent.autoCheckHierarchy){var n=e.childRecords;!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.parent.filterModule.filteredResult.length>0&&this.parent.autoCheckHierarchy&&(n=this.getFilteredChildRecords(n)),r=n.length;for(var s=0;s<r;s++)n[s].isSummaryRow||(n[s].hasChildRecords?this.traverSelection(n[s],t,!0):this.updateSelectedItems(n[s],t))}},e.prototype.getFilteredChildRecords=function(e){var t=this;return e.filter((function(e){return t.parent.filterModule.filteredResult.indexOf(e)>-1}))},e.prototype.updateParentSelection=function(e){var t,i=[],r=k(this.parent,e.uniqueID);r&&r.childRecords&&(i=r.childRecords),!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.parent.filterModule.filteredResult.length>0&&this.parent.autoCheckHierarchy&&(i=this.getFilteredChildRecords(i)),t=i&&i.length;var n=0,s=0;if(!sf.base.isNullOrUndefined(r)){for(var a=0;a<i.length;a++){var o=k(this.parent,i[a].uniqueID);sf.base.isNullOrUndefined(o)||("indeterminate"===o.checkboxState?n++:"check"===o.checkboxState&&s++)}r.checkboxState=n>0||s>0&&s!==t?"indeterminate":0===s&&0===n?"uncheck":"check",this.updateSelectedItems(r,r.checkboxState),r.parentItem&&this.updateParentSelection(r.parentItem)}},e.prototype.headerSelection=function(e){var t,i=this;if(!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.parent.filterModule.filteredResult.length>0){var r=this.parent.filterModule.filteredResult;(0==this.filteredList.length||this.filteredList!=r)&&(this.filteredList=r)}this.filteredList.length>0&&!this.parent.filterSettings.columns.length&&this.filteredList.length&&(this.filteredList=[]);var n=!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.filteredList.length>0?this.filteredList:this.parent.flatData;if(n=C(this.parent)?this.parent.getCurrentViewRecords():n,!sf.base.isNullOrUndefined(e))for(var s=0;s<n.length;s++)if(e){if("check"===n[s].checkboxState)continue;n[s].checkboxState="check",this.updateSelectedItems(n[s],n[s].checkboxState)}else this.selectedItems.indexOf(n[s])>-1&&(n[s].checkboxState="uncheck",this.updateSelectedItems(n[s],n[s].checkboxState),this.parent.autoCheckHierarchy&&this.updateParentSelection(n[s]));!1===e&&this.parent.enableVirtualization&&(this.selectedItems=[],this.selectedIndexes=[],n.filter((function(e){e.checkboxState="uncheck",i.updateSelectedItems(e,e.checkboxState)}))),t=this.selectedItems.length;var a=this.parent.getHeaderContent().querySelectorAll(".e-frame")[0];t>0&&n.length>0?t===n.length||e?(sf.base.removeClass([a],["e-stop"]),a.classList.add("e-check")):(sf.base.removeClass([a],["e-check"]),a.classList.add("e-stop")):sf.base.removeClass([a],["e-check","e-stop"])},e.prototype.updateSelectedItems=function(e,t){var i,r,n=this.parent.getCurrentViewRecords().filter((function(t){return t.uniqueID===e.uniqueID})),s=this.parent.getCurrentViewRecords().indexOf(n[0]),a=k(this.parent,e.uniqueID);if(s>-1){var o=this.parent.getRows()[s],d=void 0;(this.parent.frozenRows||this.parent.getFrozenColumns())&&(d=this.parent.getMovableDataRows()[s]),r=o.querySelectorAll(".e-frame")[0]?o.querySelectorAll(".e-frame")[0]:d.querySelectorAll(".e-frame")[0],sf.base.isNullOrUndefined(r)||sf.base.removeClass([r],["e-check","e-stop","e-uncheck"])}if(i=a,sf.base.isNullOrUndefined(i)&&(i=e),i.checkboxState=t,"check"===t&&sf.base.isNullOrUndefined(e.isSummaryRow))-1!==s&&-1===this.selectedIndexes.indexOf(s)&&this.selectedIndexes.push(s),-1===this.selectedItems.indexOf(i)&&-1!==s&&!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.parent.filterModule.filteredResult.length>0&&this.selectedItems.push(i),-1!==this.selectedItems.indexOf(i)||sf.base.isNullOrUndefined(this.parent.filterModule)||0!==this.parent.filterModule.filteredResult.length||this.selectedItems.push(i),-1===this.selectedItems.indexOf(i)&&sf.base.isNullOrUndefined(this.parent.filterModule)&&this.selectedItems.push(i);else if(("uncheck"===t||"indeterminate"===t)&&sf.base.isNullOrUndefined(e.isSummaryRow)){var l=this.selectedItems.indexOf(i);if(-1!==l&&this.selectedItems.splice(l,1),-1!==this.selectedIndexes.indexOf(s)){var p=this.selectedIndexes.indexOf(s);this.selectedIndexes.splice(p,1)}}var h="indeterminate"===t?"e-stop":"e-"+t;s>-1&&(sf.base.isNullOrUndefined(r)||r.classList.add(h))},e.prototype.updateGridActions=function(e){var t,i,r=this,n=e.requestType;if(S(this.parent)&&this.parent.autoCheckHierarchy)if("sorting"===n||"paging"===n){var s=this.parent.grid.getRows();i=(t=this.parent.getCurrentViewRecords()).length,this.selectedIndexes=[];for(var a=0;a<i;a++)s[a].classList.contains("e-summaryrow")||this.updateSelectedItems(t[a],t[a].checkboxState)}else if("delete"===n||"add"===e.action){var o=[];"delete"===n?o=e.data:o.push(e.data);for(a=0;a<o.length;a++){if("delete"===n){var d=this.parent.flatData.indexOf(o[a]),l=this.selectedIndexes.indexOf(d);this.selectedIndexes.splice(l,1),this.updateSelectedItems(o[a],"uncheck")}sf.base.isNullOrUndefined(o[a].parentItem)||this.updateParentSelection(o[a].parentItem)}}else"add"===e.requestType&&this.parent.autoCheckHierarchy?e.data.checkboxState="uncheck":("filtering"===n||"searching"===n||"refresh"===n&&!C(this.parent))&&(this.selectedItems=[],this.selectedIndexes=[],(t=!sf.base.isNullOrUndefined(this.parent.filterModule)&&this.parent.filterModule.filteredResult.length>0?this.parent.getCurrentViewRecords():this.parent.flatData).forEach((function(e){e.hasChildRecords?r.updateParentSelection(e):r.updateSelectedItems(e,e.checkboxState)})),this.headerSelection())},e.prototype.getCheckedrecords=function(){return this.selectedItems},e.prototype.getCheckedRowIndexes=function(){return this.selectedIndexes},e}(),V=function(){function e(e){this.parent=e,sf.grids.Grid.Inject(sf.grids.Print),this.addEventListener()}return e.prototype.getModuleName=function(){return"print"},e.prototype.addEventListener=function(){this.parent.grid.on("printGrid-Init",this.printTreeGrid,this)},e.prototype.removeEventListener=function(){this.parent.grid.off("printGrid-Init",this.printTreeGrid)},e.prototype.printTreeGrid=function(e){var t=sf.grids.getObject("printgrid",e),i=sf.grids.getObject("element",e);t.addEventListener("queryCellInfo",this.parent.grid.queryCellInfo),t.addEventListener("rowDataBound",this.parent.grid.rowDataBound),t.addEventListener("beforeDataBound",this.parent.grid.beforeDataBound),sf.base.addClass([i],"e-treegrid")},e.prototype.print=function(){this.parent.grid.print()},e.prototype.destroy=function(){this.removeEventListener()},e}(),F=(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),j=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F(t,e),j([sf.base.Property()],t.prototype,"fields",void 0),j([sf.base.Property(!1)],t.prototype,"ignoreCase",void 0),j([sf.base.Property("contains")],t.prototype,"operator",void 0),j([sf.base.Property()],t.prototype,"key",void 0),j([sf.base.Property()],t.prototype,"hierarchyMode",void 0),t}(sf.base.ChildProperty),_=(U=function(e,t){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}U(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),H=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),H([sf.base.Property("Row")],t.prototype,"mode",void 0),H([sf.base.Property("Flow")],t.prototype,"cellSelectionMode",void 0),H([sf.base.Property("Single")],t.prototype,"type",void 0),H([sf.base.Property(!1)],t.prototype,"persistSelection",void 0),H([sf.base.Property("Default")],t.prototype,"checkboxMode",void 0),H([sf.base.Property(!1)],t.prototype,"checkboxOnly",void 0),H([sf.base.Property(!0)],t.prototype,"enableToggle",void 0),t}(sf.base.ChildProperty),Q=function(){function e(e){this.parent=e,this.templateResult=null,this.parent.grid.on("template-result",this.columnTemplateResult,this),this.parent.grid.on("reactTemplateRender",this.reactTemplateRender,this)}return e.prototype.RowModifier=function(e){if(e.data){var t=e.data,i=t.parentItem;if(!sf.base.isNullOrUndefined(t.parentItem)&&!I(this.parent)&&(!this.parent.allowPaging||"Root"===this.parent.pageSettings.pageSizeMode||C(this.parent)&&!P(this.parent)))(this.parent.initialRender&&(!(sf.base.isNullOrUndefined(i[this.parent.expandStateMapping])||i[this.parent.expandStateMapping])||this.parent.enableCollapseAll)||!M(this.parent,e.data,this.parent.grid.getCurrentViewRecords()))&&(e.row.style.display="none");if(C(this.parent)&&!P(this.parent)){var r=this.parent,n=this.parent.getCurrentViewRecords().filter((function(e){return sf.base.getValue(r.idMapping,e)===sf.base.getValue(r.parentIdMapping,t)}));if(n.length>0){var s=n[0].expanded?"table-row":"none";e.row.setAttribute("style","display: "+s+";")}}sf.grids.getObject("isSummaryRow",e.data)&&sf.base.addClass([e.row],"e-summaryrow"),e.row.querySelector(".e-treegridexpand")?e.row.setAttribute("aria-expanded","true"):e.row.querySelector(".e-treegridcollapse")&&e.row.setAttribute("aria-expanded","false"),this.parent.enableCollapseAll&&this.parent.initialRender&&(sf.base.isNullOrUndefined(t.parentItem)||(e.row.style.display="none")),this.parent.trigger("rowDataBound",e)}},e.prototype.cellRender=function(e){if(e.data){var t,i,r=this.parent.grid,n=e.data,s=sf.base.isNullOrUndefined(n.filterLevel)?n.level:n.filterLevel,a=0,o=this.parent.getColumnByUid(e.column.uid),d=n.isSummaryRow,l=this.parent.getFrozenColumns();if(t=sf.base.isNullOrUndefined(n.parentItem)?n.index:n.parentItem.index,r.getColumnIndexByUid(e.column.uid)!==this.parent.treeColumnIndex||"add"!==e.requestType&&"rowDragAndDrop"!==e.requestType&&"delete"!==e.requestType&&!sf.base.isNullOrUndefined(e.cell.querySelector(".e-treecell")))this.templateResult&&(this.templateResult=null);else{for(var p=sf.base.createElement("div",{className:"e-treecolumn-container"}),h=sf.base.createElement("span",{className:"e-icons e-none",styles:"width: 10px; display: inline-block"}),c=0;c<s;c++)a+=10,p.appendChild(h.cloneNode());var u=sf.base.isNullOrUndefined(n.hasFilteredChildRecords)?n.hasChildRecords:n.hasFilteredChildRecords;if(u&&!sf.base.isNullOrUndefined(n.childRecords)&&(u=!(0===n.childRecords.length)),u){sf.base.addClass([e.cell],"e-treerowcell");var g=sf.base.createElement("span",{className:"e-icons"}),f=void 0;f=this.parent.initialRender?n.expanded&&(sf.base.isNullOrUndefined(n[this.parent.expandStateMapping])||n[this.parent.expandStateMapping])&&!this.parent.enableCollapseAll:!(!n.expanded||!M(this.parent,n,this.parent.grid.getCurrentViewRecords())),sf.base.addClass([g],f?"e-treegridexpand":"e-treegridcollapse"),a+=18,p.appendChild(g),h.style.width="7px",a+=7,p.appendChild(h.cloneNode())}else(s||!s&&!n.level)&&(a+=20,p.appendChild(h.cloneNode()),p.appendChild(h.cloneNode()));i=sf.base.createElement("span",{className:"e-treecell"}),this.parent.allowTextWrap&&(i.style.width="Calc(100% - "+a+"px)"),sf.base.addClass([e.cell],"e-gridrowindex"+t+"level"+n.level),this.updateTreeCell(e,i),p.appendChild(i),e.cell.appendChild(p)}if(r.getFrozenLeftColumnsCount()>0||r.getFrozenRightColumnsCount()>0){var y=r.getFrozenRightColumns(),b=r.getFrozenLeftColumns(),m=r.getMovableColumns();(y.length>0&&y[0].field===e.column.field||b.length>0&&b[0].field===e.column.field||m.length>0&&m[0].field===e.column.field)&&sf.base.addClass([e.cell],"e-gridrowindex"+t+"level"+n.level)}else(l>this.parent.treeColumnIndex&&l>0&&r.getColumnIndexByUid(e.column.uid)===l||l<this.parent.treeColumnIndex&&l>0&&(r.getColumnIndexByUid(e.column.uid)===l||r.getColumnIndexByUid(e.column.uid)===l-1)||l===this.parent.treeColumnIndex&&l>0&&r.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex-1)&&sf.base.addClass([e.cell],"e-gridrowindex"+t+"level"+n.level);if(!sf.base.isNullOrUndefined(o)&&o.showCheckbox&&(this.parent.notify("columnCheckbox",e),this.parent.allowTextWrap)){var v=e.cell.querySelectorAll(".e-frame")[0];a+=parseInt(v.style.width,16),a+=10,(i=r.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex?e.cell.querySelector(".e-treecell"):e.cell.querySelector(".e-treecheckbox")).style.width="Calc(100% - "+a+"px)"}if(d){sf.base.addClass([e.cell],"e-summarycell");var w=sf.grids.getObject(e.column.field,e.data);null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell").innerHTML=w:e.cell.innerHTML=w}sf.base.isNullOrUndefined(this.parent.rowTemplate)&&this.parent.trigger("queryCellInfo",e)}},e.prototype.updateTreeCell=function(e,t){var r=sf.base.getValue("columnModel",this.parent)[this.parent.treeColumnIndex],n=e.column.index;sf.base.isNullOrUndefined(r.field)&&e.cell.setAttribute("aria-colindex",n+""),r.field!==e.column.field||sf.base.isNullOrUndefined(r.template)||(e.column.template=r.template,e.column.templateFn=sf.grids.templateCompiler(e.column.template),e.cell.classList.add("e-templatecell"));var s=null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell").innerHTML:e.cell.innerHTML;if("object"===i(e.column.template)&&this.templateResult)sf.grids.appendChildren(t,this.templateResult),this.templateResult=null,e.cell.innerHTML="";else if(e.cell.classList.contains("e-templatecell")){var a=e.cell.children.length,o=this.parent.element.id+e.column.uid;if(r.field!==e.column.field||sf.base.isNullOrUndefined(r.template))for(;0<a;a=e.cell.children.length)t.appendChild(e.cell.children[0]);else{if(this.parent.isReact&&"string"!=typeof e.column.template)e.column.templateFn(e.data,this.parent,"template",o,null,null,t),sf.base.isNullOrUndefined(this.parent.grid.portals)&&(this.parent.grid.portals=this.parent.portals),this.parent.notify("renderReactTemplate",this.parent.portals),this.parent.renderReactTemplates();else{var d=e.column.templateFn(sf.grids.extend({index:""},e.data),this.parent,"template",o,this.parent.isStringTemplate);sf.grids.appendChildren(t,d)}delete e.column.template,delete e.column.templateFn,e.cell.innerHTML=""}}else t.innerHTML=s,e.cell.innerHTML=""},e.prototype.columnTemplateResult=function(e){this.templateResult=e.template},e.prototype.reactTemplateRender=function(e){this.parent.portals=e,this.parent.notify("renderReactTemplate",this.parent.portals),this.parent.renderReactTemplates()},e.prototype.destroy=function(){this.parent.grid.off("template-result",this.columnTemplateResult),this.parent.grid.off("reactTemplateRender",this.reactTemplateRender)},e}(),K=function(){function e(e){this.addedRecords="addedRecords",this.parent=e,this.parentItems=[],this.taskIds=[],this.hierarchyData=[],this.storedIndex=-1,this.sortedData=[],this.isSortAction=!1,this.addEventListener(),this.dataResults={},this.isSelfReference=!sf.base.isNullOrUndefined(this.parent.parentIdMapping)}return e.prototype.addEventListener=function(){this.parent.on("updateRemoteLevel",this.updateParentRemoteData,this),this.parent.grid.on("sorting-begin",this.beginSorting,this),this.parent.on("updateAction",this.updateData,this),this.parent.on("remoteExpand",this.collectExpandingRecs,this),this.parent.on("dataProcessor",this.dataProcessor,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("remoteExpand",this.collectExpandingRecs),this.parent.off("updateRemoteLevel",this.updateParentRemoteData),this.parent.off("updateAction",this.updateData),this.parent.off("dataProcessor",this.dataProcessor),this.parent.grid.off("sorting-begin",this.beginSorting))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.isRemote=function(){return this.parent.dataSource instanceof sf.data.DataManager},e.prototype.convertToFlatData=function(e){var t=this;if(this.parent.flatData=0!==Object.keys(e).length||this.parent.dataSource instanceof sf.data.DataManager?[]:this.parent.dataSource,this.parent.parentData=[],C(this.parent)&&!P(this.parent)&&e instanceof sf.data.DataManager&&!(e instanceof Array)){var i=this.parent.dataSource;if(this.parent.parentIdMapping){if(this.parent.query=sf.base.isNullOrUndefined(this.parent.query)?new sf.data.Query:this.parent.query,this.parent.parentIdMapping){var r=this.parent.query.params.filter((function(e){return"IdMapping"===e.key}));this.parent.initialRender&&!r.length&&(this.parent.query.where(this.parent.parentIdMapping,"equal",null),this.parent.query.addParams("IdMapping",this.parent.idMapping))}if(!this.parent.hasChildMapping){var n=this.parent.query.clone();n.queries=[],(n=n.select([this.parent.parentIdMapping])).isCountRequired=!0,i.executeQuery(n).then((function(e){t.parentItems=sf.data.DataUtil.distinct(e.result,t.parent.parentIdMapping,!1),0===sf.grids.getObject("dataSource.requests",t.parent).filter((function(e){return"OK"!==e.httpRequest.statusText})).length&&(sf.base.setValue("grid.contentModule.isLoaded",!0,t.parent),sf.base.isNullOrUndefined(t.zerothLevelData)||(sf.base.setValue("cancel",!1,t.zerothLevelData),sf.base.getValue("grid.renderModule",t.parent).dataManagerSuccess(t.zerothLevelData),t.zerothLevelData=null),t.parent.grid.hideSpinner())}))}}}else e instanceof Array&&this.convertJSONData(e)},e.prototype.convertJSONData=function(e){if(this.hierarchyData=[],this.taskIds=[],this.parent.idMapping)for(var t=0;t<Object.keys(e).length;t++){var i=e[t];this.hierarchyData.push(sf.base.extend({},i)),sf.base.isNullOrUndefined(i[this.parent.idMapping])||this.taskIds.push(i[this.parent.idMapping])}else this.hierarchyData=e;if(this.isSelfReference){var r=[],n=new sf.data.DataManager(this.hierarchyData).executeLocal((new sf.data.Query).group(this.parent.parentIdMapping));for(t=0;t<n.length;t++){var s=n[t],a=this.taskIds.indexOf(s.key);if(!sf.base.isNullOrUndefined(s.key)&&a>-1){var o=s.items;this.hierarchyData[a][this.parent.childMapping]=o}else r.push.apply(r,s.items)}this.hierarchyData=this.selfReferenceUpdate(r)}if(Object.keys(this.hierarchyData).length)this.createRecords(this.hierarchyData);else{var d=!(this.parent.dataSource instanceof sf.data.DataManager)&&this.parent.isGantt;this.parent.flatData=d?this.parent.dataSource:[]}this.storedIndex=-1},e.prototype.selfReferenceUpdate=function(e){for(var t=[];this.hierarchyData.length>0&&e.length>0;){var i=e.indexOf(this.hierarchyData[0]);-1===i?this.hierarchyData.shift():(t.push(this.hierarchyData.shift()),e.splice(i,1))}return t},e.prototype.updateParentRemoteData=function(e){var t=e.result;if(this.parent.hasChildMapping||this.parentItems.length||this.parent.loadChildOnDemand)if(this.parent.loadChildOnDemand)sf.base.isNullOrUndefined(t)||this.convertToFlatData(t);else for(var i=0;i<t.length;i++)x(this.parent)&&t[i].hasChildRecords&&this.parent.initialRender&&(t[i].expanded=!1),sf.base.isNullOrUndefined(t[i].index)&&(t[i].taskData=sf.base.extend({},t[i]),t[i].uniqueID=sf.grids.getUid(this.parent.element.id+"_data_"),sf.base.setValue("uniqueIDCollection."+t[i].uniqueID,t[i],this.parent),t[i].level=0,t[i].index=Math.ceil(1e3*Math.random()),(t[i][this.parent.hasChildMapping]||-1!==this.parentItems.indexOf(t[i][this.parent.idMapping]))&&(t[i].hasChildRecords=!0),t[i].checkboxState="uncheck");else this.zerothLevelData=e,sf.base.setValue("cancel",!0,e);e.result=this.parent.loadChildOnDemand?this.parent.flatData:t,this.parent.notify("updateResults",e)},e.prototype.collectExpandingRecs=function(e,t){var i,r=this.parent.getRows();if(this.parent.rowTemplate){var n=this.parent.getContentTable().rows;r=[].slice.call(n)}if(e.rows.length>0){t||(e.record.expanded=!0);for(var s=0;s<e.rows.length;s++){if(e.rows[s].style.display="table-row",this.parent.loadChildOnDemand){var a=e.rows[s].getElementsByClassName("e-treegridcollapse")[0];i=this.parent.rowTemplate?this.parent.grid.getCurrentViewRecords()[e.rows[s].rowIndex]:this.parent.grid.getRowObjectFromUID(e.rows[s].getAttribute("data-Uid")).data,!sf.base.isNullOrUndefined(a)&&i.expanded&&(sf.base.addClass([a],"e-treegridexpand"),sf.base.removeClass([a],"e-treegridcollapse"));var o;(o=r.filter((function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))}))).length&&i.expanded&&this.collectExpandingRecs({record:i,rows:o,parentRow:e.parentRow},!0)}var d=e.rows[s].querySelector(".e-detailrowcollapse");sf.base.isNullOrUndefined(d)||this.parent.grid.detailRowModule.expand(d)}}else this.fetchRemoteChildData({record:e.record,rows:e.rows,parentRow:e.parentRow})},e.prototype.fetchRemoteChildData=function(e){var t=this,i={row:e.parentRow,data:e.record},r=this.parent.dataSource,n=this.parent.grid.getDataModule().generateQuery(),s=n.queries.filter((function(e){return"onPage"!==e.fn&&"onWhere"!==e.fn}));n.queries=s,n.isCountRequired=!0,n.where(this.parent.parentIdMapping,"equal",e.record[this.parent.idMapping]),sf.popups.showSpinner(this.parent.element),r.executeQuery(n).then((function(r){var n=t.parent.grid.currentViewData.slice(),s=n.indexOf(e.record);-1===s&&t.parent.grid.getRowsObject().forEach((function(t){t.data.uniqueID===e.record.uniqueID&&(s=t.index)}));var a=sf.grids.getObject("actual.nextLevel",r),o=r.result;e.record.childRecords=o;for(var d=0;d<o.length;d++){o[d].taskData=sf.base.extend({},o[d]),o[d].level=e.record.level+1,o[d].index=Math.ceil(1e3*Math.random());var l=sf.base.extend({},e.record);delete l.childRecords,o[d].parentItem=l,o[d].parentUniqueID=e.record.uniqueID,o[d].uniqueID=sf.grids.getUid(t.parent.element.id+"_data_"),o[d].checkboxState="uncheck",sf.base.setValue("uniqueIDCollection."+o[d].uniqueID,o[d],t.parent),!o[d][t.parent.hasChildMapping]&&-1===t.parentItems.indexOf(o[d][t.parent.idMapping])||a&&!a[d]||(o[d].hasChildRecords=!0,o[d].expanded=!1),n.splice(s+d+1,0,o[d])}if(sf.base.setValue("result",n,r),sf.base.setValue("action","beforecontentrender",r),t.parent.trigger("actionComplete",r),sf.popups.hideSpinner(t.parent.element),t.parent.grid.aggregates.length>0&&!t.parent.enableVirtualization){var p=sf.grids.getObject("query",r);if(sf.base.isNullOrUndefined(p)&&(p=sf.base.getValue("grid.renderModule.data",t.parent).aggregateQuery(new sf.data.Query)),!sf.base.isNullOrUndefined(p)){var h=p.queries.filter((function(e){return"onAggregates"===e.fn}));r.result=t.parent.summaryModule.calculateSummaryValue(h,r.result,!0)}}r.count=t.parent.grid.pageSettings.totalRecordsCount;var c={};t.parent.enableVirtualization&&t.remoteVirtualAction(c);var u={index:s,childData:o};t.parent.enableInfiniteScrolling?t.parent.notify("infinite-remote-expand",u):sf.base.getValue("grid.renderModule",t.parent).dataManagerSuccess(r,c),t.parent.trigger("expanded",i)}))},e.prototype.remoteVirtualAction=function(e){e.requestType="refresh",sf.base.setValue("isExpandCollapse",!0,e);var t=sf.base.getValue("grid.contentModule",this.parent),i=sf.base.getValue("currentInfo",t),r=sf.base.getValue("prevInfo",t);i.loadNext&&this.parent.grid.pageSettings.currentPage===i.nextInfo.page&&(this.parent.grid.pageSettings.currentPage=r.page)},e.prototype.beginSorting=function(){this.isSortAction=!0},e.prototype.createRecords=function(e,t){for(var i=[],r=0,n=Object.keys(e).length;r<n;r++){var s=sf.base.extend({},e[r]);s.taskData=e[r];var a=0;if(this.storedIndex++,Object.prototype.hasOwnProperty.call(s,"index")||(s.index=this.storedIndex),(!sf.base.isNullOrUndefined(s[this.parent.childMapping])||s[this.parent.hasChildMapping]&&x(this.parent))&&(s.hasChildRecords=!0,this.parent.enableCollapseAll||!sf.base.isNullOrUndefined(this.parent.dataStateChange)&&sf.base.isNullOrUndefined(s[this.parent.childMapping])?s.expanded=!1:s.expanded=!!sf.base.isNullOrUndefined(s[this.parent.expandStateMapping])||s[this.parent.expandStateMapping]),Object.prototype.hasOwnProperty.call(s,"index")||(s.index=(s.hasChildRecords,this.storedIndex)),this.isSelfReference&&sf.base.isNullOrUndefined(s[this.parent.parentIdMapping])&&this.parent.parentData.push(s),s.uniqueID=sf.grids.getUid(this.parent.element.id+"_data_"),sf.base.setValue("uniqueIDCollection."+s.uniqueID,s,this.parent),!sf.base.isNullOrUndefined(t)){var o=sf.base.extend({},t);delete o.childRecords,delete o[this.parent.childMapping],this.isSelfReference&&delete o.taskData[this.parent.childMapping],s.parentItem=o,s.parentUniqueID=o.uniqueID,a=t.level+1}if(Object.prototype.hasOwnProperty.call(s,"level")||(s.level=a),s.checkboxState="uncheck",(sf.base.isNullOrUndefined(s[this.parent.parentIdMapping])||s.parentItem)&&this.parent.flatData.push(s),this.isSelfReference||0!==s.level||this.parent.parentData.push(s),!sf.base.isNullOrUndefined(s[this.parent.childMapping]&&s[this.parent.childMapping].length)){var d=this.createRecords(s[this.parent.childMapping],s);s.childRecords=d}i.push(s)}return i},e.prototype.dataProcessor=function(e){var t,i=sf.grids.getObject("isExport",e),r=sf.grids.getObject("expresults",e),n=sf.grids.getObject("exportType",e),s=sf.grids.getObject("isPrinting",e),a=sf.grids.getObject("actionArgs",e),o=sf.grids.getObject("requestType",e),d=sf.grids.getObject("data",e),l=sf.grids.getObject("action",e),p=a,h=this.parent.getPrimaryKeyFieldNames()[0],c=sf.grids.getObject("data",p);sf.base.isNullOrUndefined(p)||sf.base.isNullOrUndefined(p.action)||"add"!==p.action||sf.base.isNullOrUndefined(p.data)||!sf.base.isNullOrUndefined(p.data[h])||(p.data[h]=e.result[p.index][h],c.taskData[h]=e.result[p.index][h]),(!sf.base.isNullOrUndefined(a)&&Object.keys(a).length||"save"===o)&&(o=o||a.requestType,d=d||sf.grids.getObject("data",a),l=l||sf.grids.getObject("action",a),"Batch"===this.parent.editSettings.mode&&(this.batchChanges=this.parent.grid.editModule.getBatchChanges()),this.parent.isLocalData&&this.updateAction(d,l,o));var u,g,f=(t=i&&!sf.base.isNullOrUndefined(r)?r:x(this.parent)?sf.base.getValue("result",this.parent.grid.dataSource):this.parent.grid.dataSource)instanceof sf.data.DataManager?t.dataSource.json:t,y=x(this.parent)?sf.base.getValue("count",this.parent.dataSource):f.length,b=new sf.data.Query,m=sf.grids.getObject("query",e);if(sf.base.isNullOrUndefined(m)||(u=m.queries.filter((function(e){return"onWhere"===e.fn})),g=m.queries.filter((function(e){return"onSearch"===e.fn}))),this.parent.grid.allowFiltering&&this.parent.grid.filterSettings.columns.length||this.parent.grid.searchSettings.key.length>0||!sf.base.isNullOrUndefined(m)&&(u.length||g.length)&&this.parent.isLocalData){sf.base.isNullOrUndefined(m)&&(m=new sf.data.Query,m=sf.base.getValue("grid.renderModule.data",this.parent).filterQuery(m),m=sf.base.getValue("grid.renderModule.data",this.parent).searchQuery(m));var v=m.queries.filter((function(e){return"onWhere"===e.fn})),w=m.queries.filter((function(e){return"onSearch"===e.fn}));b.queries=v.concat(w);var R=new sf.data.DataManager(f).executeLocal(b);if(this.parent.notify("updateFilterRecs",{data:R}),f=this.dataResults.result,this.dataResults.result=null,this.parent.grid.aggregates.length>0){var C=sf.grids.getObject("query",e);if(sf.base.isNullOrUndefined(m)&&(m=sf.base.getValue("grid.renderModule.data",this.parent).aggregateQuery(new sf.data.Query)),!sf.base.isNullOrUndefined(C)){var S=C.queries.filter((function(e){return"onAggregates"===e.fn}));f=this.parent.summaryModule.calculateSummaryValue(S,f,!0)}}}if(this.parent.grid.aggregates.length&&0===this.parent.grid.sortSettings.columns.length&&0===this.parent.grid.filterSettings.columns.length&&!this.parent.grid.searchSettings.key.length){var I=sf.grids.getObject("query",e);sf.base.isNullOrUndefined(I)&&(I=sf.base.getValue("grid.renderModule.data",this.parent).aggregateQuery(new sf.data.Query));S=I.queries.filter((function(e){return"onAggregates"===e.fn}));f=this.parent.summaryModule.calculateSummaryValue(S,this.parent.flatData,!0)}if(this.parent.grid.sortSettings.columns.length>0||this.isSortAction){this.isSortAction=!1;for(var D=this.parent.parentData,M=(C=sf.grids.getObject("query",e),new sf.data.Query),O=this.parent.grid.sortSettings.columns.length-1;O>=0;O--){var E=this.parent.grid.getColumnByField(this.parent.grid.sortSettings.columns[O].field),A=E.sortComparer&&P(this.parent)?E.sortComparer.bind(E):this.parent.grid.sortSettings.columns[O].direction;M.sortBy(this.parent.grid.sortSettings.columns[O].field,A)}var k={modifiedData:new sf.data.DataManager(D).executeLocal(M),filteredData:f,srtQry:M};if(this.parent.notify("createSort",k),f=k.modifiedData,this.dataResults.result=null,this.sortedData=f,this.parent.notify("updateModel",{}),this.parent.grid.aggregates.length>0&&!sf.base.isNullOrUndefined(C)){S=sf.grids.getObject("query",e).queries.filter((function(e){return"onAggregates"===e.fn}));f=this.parent.summaryModule.calculateSummaryValue(S,this.sortedData,!1)}}y=x(this.parent)?sf.base.getValue("count",this.parent.dataSource):f.length;var N=this.paging(f,y,i,s,n,e);f=N.result,y=N.count,e.result=f,e.count=y,this.parent.notify("updateResults",e)},e.prototype.paging=function(e,t,i,r,n,s){if(!this.parent.allowPaging||i&&"CurrentPage"!==n||r&&"CurrentPage"!==this.parent.printMode){if((this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)&&(!i||"CurrentPage"===n)&&"save"!==sf.base.getValue("requestType",s)){var a=this.parent.enableInfiniteScrolling?s:sf.base.getValue("actionArgs",s);this.parent.notify("pagingActions",{result:e,count:t,actionArgs:a}),e=this.dataResults.result,t=this.dataResults.count}}else this.parent.notify("pagingActions",{result:e,count:t}),e=this.dataResults.result,t=x(this.parent)?sf.base.getValue("count",this.parent.dataSource):this.dataResults.count;if((!0===r||s.isPdfExport&&(sf.base.isNullOrUndefined(s.isCollapsedStatePersist)||s.isCollapsedStatePersist))&&"AllPages"===this.parent.printMode){for(var o=[],d=0;d<e.length;d++){M(this.parent,e[d],this.parent.parentData)&&o.push(e[d])}t=(e=o).length}return{result:e,count:t}},e.prototype.updateData=function(e){this.dataResults=e},e.prototype.updateAction=function(e,t,i){"delete"!==i&&"save"!==i||this.parent.notify("crudAction",{value:e,action:t||i}),"batchsave"===i&&"Batch"===this.parent.editSettings.mode&&this.parent.notify("batchSave",{})},e}();(B=e.ToolbarItem||(e.ToolbarItem={}))[B.Add=0]="Add",B[B.Edit=1]="Edit",B[B.Update=2]="Update",B[B.Delete=3]="Delete",B[B.Cancel=4]="Cancel",B[B.Search=5]="Search",B[B.ExpandAll=6]="ExpandAll",B[B.CollapseAll=7]="CollapseAll",B[B.ExcelExport=8]="ExcelExport",B[B.PdfExport=9]="PdfExport",B[B.CsvExport=10]="CsvExport",B[B.Print=11]="Print",B[B.RowIndent=12]="RowIndent",B[B.RowOutdent=13]="RowOutdent",(T=e.ContextMenuItems||(e.ContextMenuItems={}))[T.AutoFit=0]="AutoFit",T[T.AutoFitAll=1]="AutoFitAll",T[T.SortAscending=2]="SortAscending",T[T.SortDescending=3]="SortDescending",T[T.Edit=4]="Edit",T[T.Delete=5]="Delete",T[T.Save=6]="Save",T[T.Cancel=7]="Cancel",T[T.PdfExport=8]="PdfExport",T[T.ExcelExport=9]="ExcelExport",T[T.CsvExport=10]="CsvExport",T[T.FirstPage=11]="FirstPage",T[T.PrevPage=12]="PrevPage",T[T.LastPage=13]="LastPage",T[T.NextPage=14]="NextPage",T[T.AddRow=15]="AddRow";var W,Y,J,X,$=(W=function(e,t){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Z=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),Z([sf.base.Property(12)],t.prototype,"pageSize",void 0),Z([sf.base.Property(8)],t.prototype,"pageCount",void 0),Z([sf.base.Property(1)],t.prototype,"currentPage",void 0),Z([sf.base.Property()],t.prototype,"totalRecordsCount",void 0),Z([sf.base.Property(!1)],t.prototype,"enableQueryString",void 0),Z([sf.base.Property(!1)],t.prototype,"pageSizes",void 0),Z([sf.base.Property(null)],t.prototype,"template",void 0),Z([sf.base.Property("All")],t.prototype,"pageSizeMode",void 0),t}(sf.base.ChildProperty),te=(Y=function(e,t){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ie=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.intl=new sf.base.Internationalization,t.templateFn={},t}return te(t,e),t.prototype.setFormatter=function(e){this.format&&(this.format.skeleton||this.format.format)&&(this.formatFn=this.getFormatFunction(this.format))},t.prototype.getFormatFunction=function(e){return e.type?this.intl.getDateFormat(e):this.intl.getNumberFormat(e)},t.prototype.getFormatter=function(){return this.formatFn},t.prototype.setTemplate=function(e){void 0===e&&(e={}),void 0!==this.footerTemplate&&(this.templateFn[sf.base.getEnumValue(sf.grids.CellType,sf.grids.CellType.Summary)]={fn:sf.base.compile(this.footerTemplate,e),property:"footerTemplate"})},t.prototype.getTemplate=function(e){return this.templateFn[sf.base.getEnumValue(sf.grids.CellType,e)]},t.prototype.setPropertiesSilent=function(e){this.setProperties(e,!0)},ie([sf.base.Property()],t.prototype,"type",void 0),ie([sf.base.Property()],t.prototype,"footerTemplate",void 0),ie([sf.base.Property()],t.prototype,"field",void 0),ie([sf.base.Property()],t.prototype,"format",void 0),ie([sf.base.Property()],t.prototype,"columnName",void 0),ie([sf.base.Property()],t.prototype,"customAggregate",void 0),t}(sf.base.ChildProperty),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Collection([],re)],t.prototype,"columns",void 0),ie([sf.base.Property(!0)],t.prototype,"showChildSummary",void 0),t}(sf.base.ChildProperty),se=(J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ae=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return se(t,e),ae([sf.base.Property(!1)],t.prototype,"allowAdding",void 0),ae([sf.base.Property(!1)],t.prototype,"allowEditing",void 0),ae([sf.base.Property(!1)],t.prototype,"allowDeleting",void 0),ae([sf.base.Property("Cell")],t.prototype,"mode",void 0),ae([sf.base.Property("Top")],t.prototype,"newRowPosition",void 0),ae([sf.base.Property(!0)],t.prototype,"allowEditOnDblClick",void 0),ae([sf.base.Property(!0)],t.prototype,"showConfirmDialog",void 0),ae([sf.base.Property(!1)],t.prototype,"showDeleteConfirmDialog",void 0),ae([sf.base.Property("")],t.prototype,"template",void 0),ae([sf.base.Property({})],t.prototype,"dialog",void 0),ae([sf.base.Property(!1)],t.prototype,"allowNextRowEdit",void 0),t}(sf.base.ChildProperty),de=(X=function(e,t){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}X(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),le=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return de(t,e),le([sf.base.Property()],t.prototype,"field",void 0),le([sf.base.Property()],t.prototype,"direction",void 0),t}(sf.base.ChildProperty),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return de(t,e),le([sf.base.Collection([],pe)],t.prototype,"columns",void 0),le([sf.base.Property(!0)],t.prototype,"allowUnsort",void 0),t}(sf.base.ChildProperty);function ce(e,t,r,n,s,a,o){var d,l,p,h=e.value,c=e.action,u=t.grid.getPrimaryKeyFieldNames()[0],g=t.dataSource instanceof sf.data.DataManager?t.dataSource.dataSource.json:t.dataSource,f=[],y=h,b=!1;if("Batch"===t.editSettings.mode&&(p=t.grid.editModule.getBatchChanges()),"add"===c||"batchsave"===c&&"Batch"===t.editSettings.mode&&p.addedRecords.length){var m=function(e,t,i,r,n,s,a){var o,d=!1,l=i.grid.getCurrentViewRecords();switch(o=A(o=sf.base.extend({},e.value)),i.editSettings.newRowPosition){case"Top":t.unshift(o),d=!0;break;case"Bottom":t.push(o),d=!0;break;case"Above":o=sf.base.isNullOrUndefined(a)?A(o=sf.base.extend({},l[n+1])):A(o=sf.base.extend({},a));break;case"Below":case"Child":if(sf.base.isNullOrUndefined(a)){var p=i.grid.getPrimaryKeyFieldNames()[0],h=l[n];o=A(o=!sf.base.isNullOrUndefined(h)&&h[p]===e.value[p]||-1!==s?sf.base.extend({},h):sf.base.extend({},e.value));i.editModule.internalProperties.taskData=o}else o=A(o=sf.base.extend({},a));-1===s&&(t.unshift(o),d=!0)}return{value:o,isSkip:d}}(e,g,t,0,n,s,o);h=m.value,b=m.isSkip}if(h instanceof Array?f=E(h):f.push(sf.base.extend({},h)),!b&&("add"!==c||"Top"!==t.editSettings.newRowPosition&&"Bottom"!==t.editSettings.newRowPosition))for(var v=0;v<f.length;v++){"object"===i(f[v][u])&&(f[v]=f[v][u]);var w=f[v].taskData?Object.keys(f[v].taskData):Object.keys(f[v]);d=g.length;for(var R=function(){if(g[d][u]===f[v][u]){if("delete"!==c){if("edit"===c){for(l=0;l<w.length;l++)if(Object.prototype.hasOwnProperty.call(g[d],w[l])&&("Cell"!==t.editSettings.mode||!sf.base.isNullOrUndefined(p)&&0===p.changedRecords.length||w[l]===a)){var e=k(t,f[v].uniqueID);g[d][w[l]]=f[v][w[l]],e&&e.taskData&&(e.taskData[w[l]]=e[w[l]]=g[d][w[l]])}}else if("add"===c||"batchsave"===c){var i=void 0;"Child"===t.editSettings.newRowPosition?r?(y.taskData[t.parentIdMapping]=g[d][t.idMapping],g.splice(d+1,0,y.taskData)):(Object.prototype.hasOwnProperty.call(g[d],t.childMapping)||(g[d][t.childMapping]=[]),g[d][t.childMapping].push(y.taskData),ge(u,g[d],c,t,r,y)):"Below"===t.editSettings.newRowPosition?(g.splice(d+1,0,y.taskData),sf.base.isNullOrUndefined(y.parentItem)||ge(u,g[d+1],c,t,r,y)):n?"Above"===t.editSettings.newRowPosition&&(g.splice(d,0,y.taskData),sf.base.isNullOrUndefined(y.parentItem)||ge(u,g[d],c,t,r,y)):(i=0,g.splice(i,0,y.taskData))}return"break"}var s=g[d];if(g.splice(d,1),r){if(!sf.base.isNullOrUndefined(s[t.parentIdMapping]))for(var o=t.flatData.filter((function(e){return e[t.idMapping]===s[t.parentIdMapping]}))[0],h=o?o[t.childMapping]:[],b=h.length-1;b>=0;b--)if(h[b][t.idMapping]===s[t.idMapping]){h.splice(b,1),h.length||(o.hasChildRecords=!1,ge(u,o,c,t,r));break}return"break"}}else sf.base.isNullOrUndefined(g[d][t.childMapping])||ue(g[d][t.childMapping],f[v],c,u,t,r,y,a)&&ge(u,g[d],c,t,r)};d--&&d>=0;){if("break"===R())break}}}function ue(e,t,i,r,n,s,a,o){for(var d=!1,l=e.length;l--&&l>=0;)if(e[l][r]===t[r]||s&&e[l][n.parentIdMapping]===t[n.idMapping]){if("edit"===i){for(var p=Object.keys(t),h=k(n,t.uniqueID),c=0;c<p.length;c++)if(Object.prototype.hasOwnProperty.call(e[l],p[c])&&("Cell"!==n.editSettings.mode||p[c]===o)&&(h[p[c]]=h.taskData[p[c]]=e[l][p[c]]=t[p[c]],"Normal"===n.grid.editSettings.mode&&"Cell"===n.editSettings.mode)){n.grid.editModule.editModule.editRowIndex=t.index,n.grid.editModule.editModule.updateCurrentViewData(t)}break}"add"===i||"batchsave"===i?"Child"===n.editSettings.newRowPosition?s?(a[n.parentIdMapping]=e[l][n.idMapping],e.splice(l+1,0,a),ge(r,e[l],i,n,s,a)):(Object.prototype.hasOwnProperty.call(e[l],n.childMapping)||(e[l][n.childMapping]=[]),e[l][n.childMapping].push(a.taskData),ge(r,e[l],i,n,s,a)):"Above"===n.editSettings.newRowPosition?(e.splice(l,0,a.taskData),sf.base.isNullOrUndefined(a.parentItem)||ge(r,e[l],i,n,s,a)):"Below"===n.editSettings.newRowPosition&&(e.splice(l+1,0,a.taskData),sf.base.isNullOrUndefined(a.parentItem)||ge(r,e[l],i,n,s,a)):(e.splice(l,1),e.length||(d=!0))}else sf.base.isNullOrUndefined(e[l][n.childMapping])||ue(e[l][n.childMapping],t,i,r,n,s,a,o)&&ge(r,e[l],i,n,s);return d}function ge(e,t,i,r,n,s){if("Above"!==r.editSettings.newRowPosition&&"Below"!==r.editSettings.newRowPosition||"add"!==i&&"batchsave"!==i||sf.base.isNullOrUndefined(s.parentItem)){var a,o=r.grid.getCurrentViewRecords();if(o.map((function(i,r){i[e]!==t[e]||(a=r)})),sf.base.isNullOrUndefined(a)||(t=o[a]),r.enableVirtualization&&sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(s)&&(t=sf.base.getValue("uniqueIDCollection."+s.parentUniqueID,r)),n||sf.base.isNullOrUndefined(t.childRecords)||!t.childRecords.length?t.hasChildRecords=!1:t.hasChildRecords=!0,"add"===i||"batchsave"===i){t.expanded=!0,t.hasChildRecords=!0,r.sortSettings.columns.length&&sf.base.isNullOrUndefined(s)&&(s=o.filter((function(e){return e.parentUniqueID===t.uniqueID?e:null})));var d=s?s instanceof Array?s[0]:s:o[a+1];"Below"!==r.editSettings.newRowPosition&&(Object.prototype.hasOwnProperty.call(t,"childRecords")?sf.base.isNullOrUndefined(s)||t[e]===s[e]||t.childRecords.push(s):t.childRecords=[],-1===t.childRecords.indexOf(d)&&t[e]!==s[e]&&t.childRecords.unshift(d),n&&(Object.prototype.hasOwnProperty.call(t,r.childMapping)||(t[r.childMapping]=[]),-1===t[r.childMapping].indexOf(d)&&t[e]!==s[e]&&t[r.childMapping].unshift(d)))}for(var l=r.grid.getPrimaryKeyFieldNames()[0],p=r.grid.dataSource instanceof sf.data.DataManager?r.grid.dataSource.dataSource.json:r.grid.dataSource,h=0;h<p.length;h++)if(p[h][l]===t[l]){p[h]=t;break}r.grid.setRowData(e,t);var c=r.getRowByIndex(a);"Batch"===r.editSettings.mode&&(c=r.getRows()[r.grid.getRowIndexByPrimaryKey(t[e])]);var u=void 0;if((r.frozenRows||r.getFrozenColumns())&&(u=r.getMovableRowByIndex(a)),!r.enableVirtualization&&!sf.base.isNullOrUndefined(c)||!sf.base.isNullOrUndefined(u)){var g=r.treeColumnIndex;r.allowRowDragAndDrop&&r.enableImmutableMode&&(g+=1),r.renderModule.cellRender({data:t,cell:c.cells[g]?c.cells[g]:u.cells[g-r.getFrozenColumns()],column:r.grid.getColumns()[r.treeColumnIndex],requestType:i})}}else{k(r,s.parentItem.uniqueID).childRecords.push(s)}}var fe,ye,be,me,ve,we,Re=(fe=function(e,t){return(fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}fe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ce=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Re(t,e),Ce([sf.base.Property(!1)],t.prototype,"enableCache",void 0),Ce([sf.base.Property(3)],t.prototype,"maxBlocks",void 0),Ce([sf.base.Property(3)],t.prototype,"initialBlocks",void 0),t}(sf.base.ChildProperty),Se=(ye=function(e,t){return(ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ye(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ie=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},De=function(t){function i(e,i){var n=t.call(this,e,i)||this;n.dataResults={},n.uniqueIDCollection={},n.uniqueIDFilterCollection={},n.changedRecords="changedRecords",n.deletedRecords="deletedRecords",n.addedRecords="addedRecords",n.objectEqualityChecker=function(e,t){if(e){for(var i=Object.keys(e),r=!0,n=["Children","childRecords","taskData","uniqueID","parentItem","parentUniqueID","index"],s=0;s<i.length;s++){if(e[i[s]]!==t[i[s]]&&-1===n.indexOf(i[s]))if(!(e[i[s]]instanceof Date&&t[i[s]]instanceof Date)||e[i[s]].getTime()!==t[i[s]].getTime()){r=!1;break}}return r}return!1},r.Inject(L),sf.base.setValue("mergePersistData",n.mergePersistTreeGridData,n);return sf.base.isNullOrUndefined(n.injectedModules.Logger)||sf.grids.Grid.Inject(sf.grids.Logger),n.grid=new sf.grids.Grid,n}var r;return Se(i,t),r=i,i.prototype.excelExport=function(e,t,i,r){return this.excelExportModule.Map(e,t,i,r,!1)},i.prototype.csvExport=function(e,t,i,r){return this.excelExportModule.Map(e,t,i,r,!0)},i.prototype.pdfExport=function(e,t,i,r){return this.pdfExportModule.Map(e,t,i,r)},i.prototype.getModuleName=function(){return"treegrid"},i.prototype.preRender=function(){this.TreeGridLocale(),this.initProperties(),this.defaultLocale={Above:"Above",Below:"Below",Child:"Child",AddRow:"Add Row",ExpandAll:"Expand All",CollapseAll:"Collapse All",RowIndent:"Indent",RowOutdent:"Outdent"},this.l10n=new sf.base.L10n("treegrid",this.defaultLocale,this.locale),this.isSelfReference&&sf.base.isNullOrUndefined(this.childMapping)&&(this.childMapping="Children")},i.prototype.sortByColumn=function(e,t,i){this.sortModule.sortColumn(e,t,i)},i.prototype.clearSorting=function(){this.sortModule&&this.sortModule.clearSorting()},i.prototype.removeSortColumn=function(e){this.sortModule.removeSortColumn(e)},i.prototype.search=function(e){this.grid.search(e)},i.prototype.autoFitColumns=function(e){this.resizeModule.autoFitColumns(e),this.updateColumnModel()},i.prototype.reorderColumns=function(e,t){this.grid.reorderColumns(e,t)},i.prototype.TreeGridLocale=function(){var e,t,i=sf.base.L10n.locale,r={};sf.base.setValue(this.locale,{},r),e=sf.grids.getObject(this.locale,i),t=sf.grids.getObject(this.getModuleName(),e),sf.base.setValue("grid",t,sf.grids.getObject(this.locale,r)),sf.base.L10n.load(r)},i.prototype.print=function(){this.printModule.print()},i.prototype.treeGridkeyActionHandler=function(e){if(this.allowKeyboard){var t=void 0,i=void 0,r=void 0;switch(e.action){case"ctrlDownArrow":this.expandAll();break;case"ctrlUpArrow":this.collapseAll();break;case"ctrlShiftUpArrow":null!=(i=e.target.closest(".e-rowcell").closest("tr"))&&this.expandCollapseRequest(i.querySelector(".e-treegridexpand"));break;case"ctrlShiftDownArrow":null!=(i=e.target.closest(".e-rowcell").closest("tr"))&&this.expandCollapseRequest(i.querySelector(".e-treegridcollapse"));break;case"downArrow":if(!this.enableVirtualization)if(t=e.target.parentElement,null!==(r=this.findnextRowElement(t))){var n=r.rowIndex;this.selectRow(n);var s=e.target.cellIndex,a=r.children[s];sf.base.addClass([a],"e-focused"),sf.base.addClass([a],"e-focus")}else this.clearSelection();break;case"upArrow":if(!this.enableVirtualization)if(t=e.target.parentElement,null!==(r=this.findPreviousRowElement(t))){var o=r.rowIndex;this.selectRow(o);var d=e.target.cellIndex,l=r.children[d];sf.base.addClass([l],"e-focused"),sf.base.addClass([l],"e-focus")}else this.clearSelection()}}},i.prototype.findnextRowElement=function(e){var t=e.nextElementSibling;return null===t||-1===t.className.indexOf("e-summaryrow")&&"none"!==t.style.display||(t=this.findnextRowElement(t)),t},i.prototype.findPreviousRowElement=function(e){var t=e.previousElementSibling;return null===t||-1===t.className.indexOf("e-summaryrow")&&"none"!==t.style.display||(t=this.findPreviousRowElement(t)),t},i.prototype.initProperties=function(){this.defaultLocale={},this.flatData=[],this.parentData=[],this.columnModel=[],this.isExpandAll=!1,this.isCollapseAll=!1,this.keyConfigs={ctrlDownArrow:"ctrl+downarrow",ctrlUpArrow:"ctrl+uparrow",ctrlShiftUpArrow:"ctrl+shift+uparrow",ctrlShiftDownArrow:"ctrl+shift+downarrow",downArrow:"downArrow",upArrow:"upArrow"},this.isLocalData=!(this.dataSource instanceof sf.data.DataManager)||this.dataSource.dataSource.offline||!sf.base.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof sf.data.RemoteSaveAdaptor,this.isSelfReference=!sf.base.isNullOrUndefined(this.parentIdMapping)},i.prototype.wireEvents=function(){sf.base.EventHandler.add(this.grid.element,"click",this.mouseClickHandler,this),sf.base.EventHandler.add(this.element,"touchend",this.mouseClickHandler,this),this.keyboardModule=new sf.base.KeyboardEvents(this.element,{keyAction:this.treeGridkeyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"}),this.allowKeyboard&&(this.element.tabIndex=-1===this.element.tabIndex?0:this.element.tabIndex)},i.prototype.requiredModules=function(){var e=[];return this.grid.splitFrozenCount(this.getGridColumns(this.columns)),this.isDestroyed||(e.push({member:"filter",args:[this,this.filterSettings]}),sf.base.isNullOrUndefined(this.toolbar)||e.push({member:"toolbar",args:[this]}),this.contextMenuItems&&e.push({member:"contextMenu",args:[this]}),this.allowPaging&&e.push({member:"pager",args:[this,this.pageSettings]}),this.allowReordering&&e.push({member:"reorder",args:[this]}),this.allowSorting&&e.push({member:"sort",args:[this]}),this.aggregates.length>0&&e.push({member:"summary",args:[this]}),e.push({member:"resize",args:[this]}),this.allowExcelExport&&e.push({member:"ExcelExport",args:[this]}),(this.frozenColumns||this.frozenRows||this.getFrozenColumns()||this.grid.getFrozenLeftColumnsCount()||this.grid.getFrozenRightColumnsCount())&&e.push({member:"freeze",args:[this]}),this.detailTemplate&&e.push({member:"detailRow",args:[this]}),this.allowPdfExport&&e.push({member:"PdfExport",args:[this]}),this.showColumnMenu&&e.push({member:"columnMenu",args:[this]}),this.showColumnChooser&&e.push({member:"ColumnChooser",args:[this]}),this.extendRequiredModules(e)),e},i.prototype.extendRequiredModules=function(e){this.allowRowDragAndDrop&&e.push({member:"rowDragAndDrop",args:[this]}),(this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing)&&e.push({member:"edit",args:[this]}),this.isCommandColumn(this.columns)&&e.push({member:"commandColumn",args:[this]}),this.allowSelection&&e.push({member:"selection",args:[this]}),this.enableVirtualization&&e.push({member:"virtualScroll",args:[this]}),this.enableInfiniteScrolling&&e.push({member:"infiniteScroll",args:[this]}),e.push({member:"logger",args:[this.grid]})},i.prototype.isCommandColumn=function(e){var t=this;return e.some((function(e){return e.columns?t.isCommandColumn(e.columns):!(!e.commands&&!e.commandsTemplate)}))},i.prototype.unwireEvents=function(){this.grid&&this.grid.element&&sf.base.EventHandler.remove(this.grid.element,"click",this.mouseClickHandler)},i.prototype.log=function(e,t){this.loggerModule&&this.loggerModule.treeLog(e,t,this)},i.prototype.render=function(){var e=this;this.isReact&&(this.grid.isReact=!0,this.grid.portals=[]),sf.popups.createSpinner({target:this.element},this.createElement),this.log(["mapping_fields_missing"]),this.renderModule=new Q(this),this.dataModule=new K(this),this.printModule=new V(this),this.trigger("load"),this.autoGenerateColumns(),this.initialRender=!0,sf.base.isNullOrUndefined(this.dataSource)||this.convertTreeData(this.dataSource),this.loadGrid(),this.element.classList.contains("e-treegrid")&&this.rowDropSettings.targetID&&(this.grid.rowDropSettings.targetID+="_gridcontrol"),this.addListener();var t=sf.base.createElement("div",{id:this.element.id+"_gridcontrol"});sf.base.addClass([this.element],"e-treegrid"),sf.base.isNullOrUndefined(this.height)||"string"!=typeof this.height||-1===this.height.indexOf("%")||(this.element.style.height=this.height),sf.base.isNullOrUndefined(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(this.element.style.width=this.width),this.element.appendChild(t);var i=this.grid.requiredModules;this.grid.requiredModules=function(){var e=[];e=i.apply(this);for(var t=0;t<e.length;t++)"virtualscroll"===e[t].member&&(e[t].member="treeVirtualScroll");return e},this.grid.appendTo(t),this.wireEvents(),this.renderComplete();var r=this.grid.destroyTemplate;this.grid.destroyTemplate=function(t,i){r.apply(e.grid);e.isReact&&sf.base.isNullOrUndefined(e.portals)||e.clearTemplate(t,i)}},i.prototype.afterGridRender=function(){sf.base.isNullOrUndefined(this.grid.clipboardModule)||this.grid.clipboardModule.destroy(),this.clipboardModule=this.grid.clipboardModule=new R(this)},i.prototype.convertTreeData=function(e){var t=this;if(x(this)&&(e=sf.base.getValue("result",e)),e instanceof Array&&e.length>0&&Object.prototype.hasOwnProperty.call(e[0],"level"))this.flatData=e,this.flatData.filter((function(e){sf.base.setValue("uniqueIDCollection."+e.uniqueID,e,t),0===e.level&&t.parentData.push(e)}));else if(x(this)){var i=sf.base.getValue("result",this.dataSource);this.dataModule.convertToFlatData(i)}else this.dataModule.convertToFlatData(e)},i.prototype.bindGridProperties=function(){this.bindedDataSource(),this.grid.enableRtl=this.enableRtl,this.grid.allowKeyboard=this.allowKeyboard,this.grid.columns=this.getGridColumns(this.columns),this.grid.allowExcelExport=this.allowExcelExport,this.grid.allowPdfExport=this.allowPdfExport,this.grid.query=this.query,this.grid.columnQueryMode=this.columnQueryMode,this.grid.allowPaging=this.allowPaging,this.grid.pageSettings=sf.grids.getActualProperties(this.pageSettings),this.grid.pagerTemplate=this.pagerTemplate,this.grid.showColumnMenu=this.showColumnMenu,this.grid.allowSorting=this.allowSorting,this.grid.allowFiltering=this.allowFiltering,this.grid.enableVirtualization=this.enableVirtualization,this.grid.enableInfiniteScrolling=this.enableInfiniteScrolling,this.grid.infiniteScrollSettings=this.infiniteScrollSettings,this.grid.width=this.width,this.grid.height=this.height,this.grid.enableAltRow=this.enableAltRow,this.grid.allowReordering=this.allowReordering,this.grid.allowTextWrap=this.allowTextWrap,this.grid.allowResizing=this.allowResizing,this.grid.enableHover=this.enableHover,this.grid.enableAutoFill=this.enableAutoFill,this.grid.enableImmutableMode=this.enableImmutableMode,this.grid.allowRowDragAndDrop=this.allowRowDragAndDrop,this.grid.rowDropSettings=sf.grids.getActualProperties(this.rowDropSettings),this.grid.rowHeight=this.rowHeight,this.grid.gridLines=this.gridLines,this.grid.allowSelection=this.allowSelection,this.grid.toolbar=sf.grids.getActualProperties(this.getGridToolbar()),this.grid.toolbarTemplate=this.toolbarTemplate,this.grid.showColumnChooser=this.showColumnChooser,this.grid.filterSettings=sf.grids.getActualProperties(this.filterSettings),this.grid.selectionSettings=sf.grids.getActualProperties(this.selectionSettings),this.grid.sortSettings=sf.grids.getActualProperties(this.sortSettings),this.grid.searchSettings=sf.grids.getActualProperties(this.searchSettings),this.grid.aggregates=sf.grids.getActualProperties(this.aggregates),this.grid.textWrapSettings=sf.grids.getActualProperties(this.textWrapSettings),this.grid.printMode=sf.grids.getActualProperties(this.printMode),this.grid.locale=sf.grids.getActualProperties(this.locale),this.grid.selectedRowIndex=this.selectedRowIndex,this.grid.contextMenuItems=sf.grids.getActualProperties(this.getContextMenu()),this.grid.columnMenuItems=sf.grids.getActualProperties(this.columnMenuItems),this.grid.editSettings=this.getGridEditSettings(),this.grid.rowTemplate=sf.grids.getActualProperties(this.rowTemplate),this.grid.detailTemplate=sf.grids.getActualProperties(this.detailTemplate),this.grid.frozenRows=this.frozenRows,this.grid.frozenColumns=this.frozenColumns,this.grid.clipMode=sf.grids.getActualProperties(this.clipMode);this.grid.templateDotnetInstance=this.templateDotnetInstance;this.grid.isJsComponent=!0},i.prototype.triggerEvents=function(e){this.trigger(sf.grids.getObject("name",e),e)},i.prototype.bindGridEvents=function(){var e=this;this.grid.rowSelecting=function(t){sf.base.isNullOrUndefined(t.target)||!(t.target.classList.contains("e-treegridexpand")||t.target.classList.contains("e-treegridcollapse")||t.target.classList.contains("e-summarycell"))?e.trigger("rowSelecting",t):t.cancel=!0},this.grid.rowSelected=function(t){e.selectedRowIndex=e.grid.selectedRowIndex,e.notify("rowSelected",t),e.trigger("rowSelected",t)},this.grid.rowDeselected=function(t){e.selectedRowIndex=e.grid.selectedRowIndex,e.trigger("rowDeselected",t)},this.grid.resizeStop=function(t){e.updateColumnModel(),e.trigger("resizeStop",t)},this.grid.excelQueryCellInfo=function(t){e.notify("excelCellInfo",t),t=e.dataResults},this.grid.pdfQueryCellInfo=function(t){e.notify("pdfCellInfo",t),t=e.dataResults},this.grid.checkBoxChange=function(t){e.trigger("checkboxChange",t)},this.grid.pdfExportComplete=this.triggerEvents.bind(this),this.grid.excelExportComplete=this.triggerEvents.bind(this),this.grid.excelHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.pdfHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.dataSourceChanged=this.triggerEvents.bind(this),this.grid.recordDoubleClick=this.triggerEvents.bind(this),this.grid.rowDeselecting=this.triggerEvents.bind(this),this.grid.cellDeselected=this.triggerEvents.bind(this),this.grid.cellDeselecting=this.triggerEvents.bind(this),this.grid.columnMenuOpen=this.triggerEvents.bind(this),this.grid.columnMenuClick=this.triggerEvents.bind(this),this.grid.cellSelected=this.triggerEvents.bind(this),this.grid.headerCellInfo=this.triggerEvents.bind(this),this.grid.resizeStart=this.triggerEvents.bind(this),this.grid.resizing=this.triggerEvents.bind(this),this.grid.columnDrag=this.triggerEvents.bind(this),this.grid.columnDragStart=this.triggerEvents.bind(this),this.grid.columnDrop=this.triggerEvents.bind(this),this.grid.beforePrint=this.triggerEvents.bind(this),this.grid.beforeCopy=this.triggerEvents.bind(this),this.grid.beforePaste=function(t){for(var i=e.getRows();i[t.rowIndex].classList.contains("e-summaryrow");)t.rowIndex++;e.trigger("beforePaste",t)},this.grid.load=function(){if(e.grid.on("initial-end",e.afterGridRender,e),!sf.base.isNullOrUndefined(e.loggerModule)){e.loggerModule=e.grid.loggerModule=new m(e.grid)}},this.grid.printComplete=this.triggerEvents.bind(this),this.grid.actionFailure=this.triggerEvents.bind(this),this.extendedGridDataBoundEvent(),this.extendedGridEvents(),this.extendedGridActionEvents(),this.extendedGridEditEvents(),this.bindGridDragEvents(),this.bindCallBackEvents()},i.prototype.lastRowBorder=function(e,t){for(var i=0;i<e.cells.length;i++)t?sf.base.addClass([e.cells[i]],"e-lastrowcell"):sf.base.removeClass([e.cells[i]],"e-lastrowcell")},i.prototype.isPixelHeight=function(){return"auto"!==this.height&&-1===this.height.toString().indexOf("%")},i.prototype.extendedGridDataBoundEvent=function(){var e=this;this.grid.dataBound=function(t){if(e.updateRowTemplate(),e.updateColumnModel(),e.updateAltRow(e.getRows()),e.notify("dataBoundArg",t),C(e)&&!P(e)&&!e.hasChildMapping){var i=sf.grids.getObject("dataSource.requests",e).filter((function(e){return"OK"!==e.httpRequest.statusText})).length;sf.base.setValue("grid.contentModule.isLoaded",!(i>0),e)}if(e.isPixelHeight()&&e.initialRender)for(var r=e.getContentTable().rows,n=[].slice.call(r),s=n.length-1;s>0;s--)if(!N(n[s])){n[s].nextElementSibling&&e.lastRowBorder(n[s],!0);break}e.trigger("dataBound",t),e.initialRender=!1};var t=this;this.grid.beforeDataBound=function(e){var i=sf.grids.getObject("action",e);if((C(t)&&!P(t)||x(this))&&"edit"!==i)t.notify("updateRemoteLevel",e),e=t.dataResults;else if(0===t.flatData.length&&P(t)&&t.dataSource instanceof sf.data.DataManager){var r=t.dataSource;t.dataModule.convertToFlatData(r.dataSource.json),e.result=t.grid.dataSource.dataSource.json=t.flatData}if(C(t)||x(this)||sf.base.isNullOrUndefined(t.dataSource)||(this.isPrinting&&sf.base.setValue("isPrinting",!0,e),t.notify("dataProcessor",e)),sf.base.extend(e,t.dataResults),t.enableImmutableMode&&(e.result=e.result.slice()),t.initialRender&&(this.contentModule.objectEqualityChecker=t.objectEqualityChecker),!this.isPrinting){var n=new sf.data.Deferred;return t.trigger("beforeDataBound",e,(function(e){n.resolve(e)})),n}},this.grid.log=function(t,i){e.loggerModule&&e.loggerModule.log(t,i)}},i.prototype.bindCallBackEvents=function(){var e=this;this.grid.toolbarClick=function(t){if(!(t.item.id===e.grid.element.id+"_excelexport"&&!1===e.allowExcelExport||t.item.id===e.grid.element.id+"_pdfexport"&&!1===e.allowPdfExport||t.item.id===e.grid.element.id+"_csvexport"&&!1===e.allowExcelExport)){var i=new sf.data.Deferred;return e.trigger("toolbarClick",t,(function(r){r.cancel||e.notify("toolbarClick",t),i.resolve(r)})),i}},this.grid.cellSelecting=function(t){var i=new sf.data.Deferred;return e.trigger(sf.grids.getObject("name",t),t,(function(e){i.resolve(e)})),i},this.grid.beginEdit=function(t){if(sf.base.isNullOrUndefined(t.row)||!t.row.classList.contains("e-summaryrow")){var i=new sf.data.Deferred;return e.trigger("beginEdit",t,(function(e){i.resolve(e)})),i}t.cancel=!0}},i.prototype.extendedGridEditEvents=function(){var e=this;this.grid.dataStateChange=function(t){e.isExpandRefresh?(e.isExpandRefresh=!1,e.grid.dataSource={result:e.flatData,count:sf.base.getValue("count",e.grid.dataSource)}):e.trigger("dataStateChange",t)},this.grid.cellSave=function(t){if(e.grid.isContextMenuOpen()){var i=e.grid.contextMenuModule.contextMenu.element.getElementsByClassName("e-selected")[0];(sf.base.isNullOrUndefined(i)||i.id!==e.element.id+"_gridcontrol_cmenu_Save")&&(t.cancel=!0)}var r=new sf.data.Deferred;return e.trigger("cellSave",t,(function(t){t.cancel||e.notify("cellSave",t),r.resolve(t)})),r},this.grid.cellSaved=function(t){e.trigger("cellSaved",t),e.notify("cellSaved",t)},this.grid.cellEdit=function(t){var i=new sf.data.Deferred;return t.promise=i,e.notify("cellEdit",t),i},this.grid.batchAdd=function(t){e.trigger("batchAdd",t),e.notify("batchAdd",t)},this.grid.beforeBatchSave=function(t){e.trigger("beforeBatchSave",t),e.notify("beforeBatchSave",t)},this.grid.beforeBatchAdd=function(t){e.trigger("beforeBatchAdd",t),e.notify("beforeBatchAdd",t)},this.grid.batchDelete=function(t){e.trigger("batchDelete",t),e.notify("batchDelete",t)},this.grid.beforeBatchDelete=function(t){e.trigger("beforeBatchDelete",t),e.notify("beforeBatchDelete",t)},this.grid.batchCancel=function(t){"Cell"!==e.editSettings.mode&&e.trigger("batchCancel",t),e.notify("batchCancel",t)}},i.prototype.updateRowTemplate=function(){this.treeColumnRowTemplate()},i.prototype.bindedDataSource=function(){if(this.dataSource&&x(this)){var e=this.flatData,t=sf.base.getValue("count",this.dataSource);this.grid.dataSource={result:e,count:t}}else this.grid.dataSource=this.dataSource instanceof sf.data.DataManager?new sf.data.DataManager(this.dataSource.dataSource,this.dataSource.defaultQuery,this.dataSource.adaptor):this.flatData;if(this.dataSource instanceof sf.data.DataManager&&(this.dataSource.dataSource.offline||this.dataSource.ready)){this.grid.dataSource.dataSource.json=E(this.dataSource.dataSource.json),this.grid.dataSource.ready=this.dataSource.ready;var i=this;sf.base.isNullOrUndefined(this.grid.dataSource.ready)||this.grid.dataSource.ready.then((function(e){var t=i.grid.dataSource;t.dataSource.offline=!0,t.isDataAvailable=!0,t.dataSource.json=e.result,t.adaptor=new sf.data.JsonAdaptor}))}},i.prototype.extendedGridActionEvents=function(){var e=this;this.grid.actionBegin=function(t){"sorting"===t.requestType&&t.target&&t.target.parentElement&&t.target.parentElement.classList.contains("e-hierarchycheckbox")&&(t.cancel=!0),"reorder"===sf.grids.getObject("requestType",t)&&e.notify("getColumnIndex",{}),e.notify("actionBegin",{editAction:t}),C(e)||sf.base.isNullOrUndefined(e.filterModule)||x(e)||0!==e.grid.filterSettings.columns.length&&0!==e.grid.searchSettings.key.length||(e.notify("clearFilters",{flatData:e.grid.dataSource}),e.grid.setProperties({dataSource:e.dataResults.result},!0));var i=new sf.data.Deferred;return e.trigger("actionBegin",t,(function(t){t.cancel||e.notify("beginEdit",t),i.resolve(t)})),i},this.grid.actionComplete=function(t){e.notify("actioncomplete",t),e.updateColumnModel(),e.updateTreeGridModel(),"reorder"===t.requestType&&e.notify("setColumnIndex",{}),e.notify("actionComplete",{editAction:t}),"add"===t.requestType&&"Top"!==e.editSettings.newRowPosition&&"Bottom"!==e.editSettings.newRowPosition&&e.notify("beginAdd",t),"batchsave"===t.requestType&&e.notify("batchSave",t),e.notify("updateGridActions",t),"save"===t.requestType&&e.aggregates.map((function(e){return 1==e.showChildSummary})).length&&e.grid.refresh(),e.trigger("actionComplete",t)}},i.prototype.extendedGridEvents=function(){var e=this,t=this;this.grid.recordDoubleClick=function(t){e.trigger("recordDoubleClick",t),e.notify("recordDoubleClick",t)},this.grid.detailDataBound=function(t){e.notify("detaildataBound",t),e.trigger("detailDataBound",t)},this.grid.rowDataBound=function(e){sf.base.isNullOrUndefined(this.isPrinting)?sf.base.setValue("isPrinting",!1,e):sf.base.setValue("isPrinting",this.isPrinting,e),t.renderModule.RowModifier(e)},this.grid.queryCellInfo=function(e){sf.base.isNullOrUndefined(this.isPrinting)?sf.base.setValue("isPrinting",!1,e):sf.base.setValue("isPrinting",this.isPrinting,e),t.renderModule.cellRender(e)},this.grid.contextMenuClick=function(t){e.notify("contextMenuClick",t),e.trigger("contextMenuClick",t)},this.grid.contextMenuOpen=function(t){e.notify("contextMenuOpen",t),e.trigger("contextMenuOpen",t)},this.grid.queryCellInfo=function(t){e.renderModule.cellRender(t)}},i.prototype.bindGridDragEvents=function(){var e=this;this.grid.rowDragStartHelper=function(t){e.trigger("rowDragStartHelper",t)},this.grid.rowDragStart=function(t){e.trigger("rowDragStart",t)},this.grid.rowDrag=function(t){e.grid.isEdit?t.cancel=!0:(e.notify("row-draging",t),e.trigger("rowDrag",t))},this.grid.rowDrop=function(t){e.grid.isEdit||e.notify("row-dropped",t),t.cancel=!0}},i.prototype.loadGrid=function(){this.bindGridProperties(),this.bindGridEvents(),sf.base.setValue("registeredTemplate",this.registeredTemplate,this.grid);sf.base.setValue("viewContainerRef",this.viewContainerRef,this.grid)},i.prototype.autoGenerateColumns=function(){if(!this.columns.length&&!this.dataModule.isRemote()&&Object.keys(this.dataSource).length){this.columns=[];for(var e=this.dataSource[0],t=Object.keys(e),i=0;i<t.length;i++)-1===[this.childMapping,this.parentIdMapping].indexOf(t[i])&&this.columns.push(t[i])}},i.prototype.getGridEditSettings=function(){var e={};switch(e.allowAdding=this.editSettings.allowAdding,e.allowEditing=this.editSettings.allowEditing,e.allowDeleting=this.editSettings.allowDeleting,e.newRowPosition="Bottom"===this.editSettings.newRowPosition?"Bottom":"Top",e.allowEditOnDblClick=this.editSettings.allowEditOnDblClick,e.showConfirmDialog=this.editSettings.showConfirmDialog,e.template=this.editSettings.template,e.showDeleteConfirmDialog=this.editSettings.showDeleteConfirmDialog,e.allowNextRowEdit=this.editSettings.allowNextRowEdit,e.guid=this.editSettings.guid,e.dialog=this.editSettings.dialog,this.editSettings.mode){case"Dialog":case"Batch":e.mode=this.editSettings.mode;break;case"Row":e.mode="Normal";break;case"Cell":e.mode="Normal",e.showConfirmDialog=!1}return e},i.prototype.getContextMenu=function(){if(this.contextMenuItems){for(var t=[],i=0;i<this.contextMenuItems.length;i++)switch(this.contextMenuItems[i]){case"AddRow":case e.ContextMenuItems.AddRow:t.push({text:this.l10n.getConstant("AddRow"),target:".e-content",id:this.element.id+"_gridcontrol_cmenu_AddRow",items:[{text:this.l10n.getConstant("Above"),id:"Above"},{text:this.l10n.getConstant("Below"),id:"Below"},{text:this.l10n.getConstant("Child"),id:"Child"}]});break;default:t.push(this.contextMenuItems[i])}return t}return null},i.prototype.getGridToolbar=function(){if(this.toolbar){for(var t=[],i=void 0,r=0;r<this.toolbar.length;r++)switch(this.toolbar[r]){case"Search":case e.ToolbarItem.Search:t.push("Search");break;case"Print":case e.ToolbarItem.Print:t.push("Print");break;case"ExpandAll":case e.ToolbarItem.ExpandAll:i=this.l10n.getConstant("ExpandAll"),t.push({text:i,tooltipText:i,prefixIcon:"e-expand",id:this.element.id+"_gridcontrol_expandall"});break;case"CollapseAll":case e.ToolbarItem.CollapseAll:i=this.l10n.getConstant("CollapseAll"),t.push({text:i,tooltipText:i,prefixIcon:"e-collapse",id:this.element.id+"_gridcontrol_collapseall"});break;case"Indent":case e.ToolbarItem.RowIndent:i=this.l10n.getConstant("RowIndent"),t.push({text:i,tooltipText:i,prefixIcon:"e-indent",id:this.element.id+"_gridcontrol_indent"});break;case"Outdent":case e.ToolbarItem.RowOutdent:i=this.l10n.getConstant("RowOutdent"),t.push({text:i,tooltipText:i,prefixIcon:"e-outdent",id:this.element.id+"_gridcontrol_outdent"});break;default:t.push(this.toolbar[r])}return t}return null},i.prototype.getGridColumns=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=0);var r,n,s=e;t&&(this.columnModel=[]),i=0===i?-1:i;for(var o=[],d=0;d<s.length;d++){i+=1;var l=this.grid.getColumnByUid(s[d].uid);if(n=l||{},r={},"string"==typeof this.columns[d])n.field=r.field=this.columns[d];else for(var p=0,h=Object.keys(s[d]);p<h.length;p++){var c=h[p];i===this.treeColumnIndex&&"template"===c?r[c]=s[d][c]:"columns"!==c||sf.base.isNullOrUndefined(s[d][c])?n[c]=r[c]=s[d][c]:(n[c]=this.getGridColumns(s[d][c],!1,i),r[c]=s[d][c])}r.columns||this.columnModel.push(new a(r)),o.push(n)}return o},i.prototype.onPropertyChanged=function(e){for(var t=!1,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];switch(n){case"columns":this.grid.columns=this.getGridColumns(this.columns);break;case"treeColumnIndex":this.grid.refreshColumns();break;case"allowPaging":this.grid.allowPaging=this.allowPaging;break;case"pageSettings":this.grid.pageSettings=sf.grids.getActualProperties(this.pageSettings),t=!0;break;case"enableVirtualization":this.grid.enableVirtualization=this.enableVirtualization;break;case"toolbar":this.grid.toolbar=this.getGridToolbar();break;case"allowSelection":this.grid.allowSelection=this.allowSelection;break;case"selectionSettings":this.grid.selectionSettings=sf.grids.getActualProperties(this.selectionSettings);break;case"allowSorting":this.grid.allowSorting=this.allowSorting;break;case"allowMultiSorting":this.grid.allowMultiSorting=this.allowMultiSorting;break;case"sortSettings":this.grid.sortSettings=sf.grids.getActualProperties(this.sortSettings);break;case"searchSettings":this.grid.searchSettings=sf.grids.getActualProperties(this.searchSettings);break;case"allowFiltering":this.grid.allowFiltering=this.allowFiltering;break;case"filterSettings":this.initialRender||(this.grid.filterSettings=sf.grids.getActualProperties(this.filterSettings));break;case"showColumnMenu":this.grid.showColumnMenu=this.showColumnMenu;break;case"allowRowDragAndDrop":this.grid.allowRowDragAndDrop=this.allowRowDragAndDrop;break;case"aggregates":this.grid.aggregates=sf.grids.getActualProperties(this.aggregates);break;case"enableInfiniteScrolling":this.grid.enableInfiniteScrolling=this.enableInfiniteScrolling;break;case"dataSource":if(this.isLocalData=!(this.dataSource instanceof sf.data.DataManager)||!sf.base.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof sf.data.RemoteSaveAdaptor,this.convertTreeData(this.dataSource),this.isLocalData){if(x(this)){var s=sf.base.getValue("count",this.dataSource);this.grid.dataSource={result:this.flatData,count:s}}else{var a=this.dataSource;this.grid.dataSource=a instanceof sf.data.DataManager?new sf.data.DataManager(a.dataSource,a.defaultQuery,a.adaptor):this.flatData}this.enableVirtualization&&(this.grid.contentModule.isDataSourceChanged=!0)}else this.bindedDataSource(),this.enableVirtualization&&(this.grid.contentModule.removeEventListener(),this.grid.contentModule.eventListener("on"),this.grid.contentModule.renderTable());break;case"query":this.grid.query=this.query;break;case"enableCollapseAll":e[n]?this.collapseAll():this.expandAll();break;case"expandStateMapping":this.grid.refresh();break;case"gridLines":this.grid.gridLines=this.gridLines;break;case"rowTemplate":this.grid.rowTemplate=sf.grids.getActualProperties(this.rowTemplate);break;case"frozenRows":this.grid.frozenRows=this.frozenRows;break;case"frozenColumns":this.grid.frozenColumns=this.frozenColumns;break;case"rowHeight":this.grid.rowHeight=this.rowHeight;break;case"height":sf.base.isNullOrUndefined(this.height)||"string"!=typeof this.height||-1===this.height.indexOf("%")||(this.element.style.height=this.height),this.grid.height=this.height;break;case"width":sf.base.isNullOrUndefined(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(this.element.style.width=this.width),this.grid.width=this.width;break;case"locale":this.grid.locale=this.locale;break;case"selectedRowIndex":this.grid.selectedRowIndex=this.selectedRowIndex;break;case"enableAltRow":this.grid.enableAltRow=this.enableAltRow;break;case"enableHover":this.grid.enableHover=this.enableHover;break;case"enableAutoFill":this.grid.enableAutoFill=this.enableAutoFill;break;case"enableImmutableMode":this.grid.enableImmutableMode=this.enableImmutableMode;break;case"allowExcelExport":this.grid.allowExcelExport=this.allowExcelExport;break;case"allowPdfExport":this.grid.allowPdfExport=this.allowPdfExport;break;case"enableRtl":this.grid.enableRtl=this.enableRtl;break;case"allowReordering":this.grid.allowReordering=this.allowReordering;break;case"allowResizing":this.grid.allowResizing=this.allowResizing;break;case"textWrapSettings":this.grid.textWrapSettings=sf.grids.getActualProperties(this.textWrapSettings);break;case"allowTextWrap":this.grid.allowTextWrap=sf.grids.getActualProperties(this.allowTextWrap),this.grid.refresh();break;case"contextMenuItems":this.grid.contextMenuItems=this.getContextMenu();break;case"showColumnChooser":this.grid.showColumnChooser=this.showColumnChooser;break;case"detailTemplate":this.grid.detailTemplate=sf.grids.getActualProperties(this.detailTemplate);break;case"columnMenuItems":this.grid.columnMenuItems=sf.grids.getActualProperties(this.columnMenuItems);break;case"editSettings":this.grid.isEdit&&"Normal"===this.grid.editSettings.mode&&e[n].mode&&("Cell"===e[n].mode||"Row"===e[n].mode)&&this.grid.closeEdit(),this.grid.editSettings=this.getGridEditSettings()}t&&this.grid.refresh()}},i.prototype.destroy=function(){var e=this.element;if(e){var i=!(!e.querySelector(".e-gridheader")||!e.querySelector(".e-gridcontent"));i&&this.unwireEvents(),this.removeListener(),i&&t.prototype.destroy.call(this),this.grid&&this.grid.destroy(),this.dataModule&&this.dataModule.destroy();for(var r=["dataModule","sortModule","renderModule","filterModule","printModule","clipboardModule","excelExportModule","pdfExportModule","toolbarModule","summaryModule","reorderModule","resizeModule","pagerModule","keyboardModule","columnMenuModule","contextMenuModule","editModule","virtualScrollModule","selectionModule","detailRow","rowDragAndDropModule","freezeModule"],n=0;n<r.length;n++)this[r[n]]&&(this[r[n]]=null);this.element.innerHTML="",this.grid=null}},i.prototype.dataBind=function(){sf.base.isNullOrUndefined(this.grid)||(t.prototype.dataBind.call(this),this.grid.dataBind())},i.prototype.getPersistData=function(){for(var e=["pageSettings","sortSettings","filterSettings","columns","searchSettings","selectedRowIndex"],t={pageSettings:["template","pageSizes","pageSizeMode","enableQueryString","totalRecordsCount","pageCount"],filterSettings:["type","mode","showFilterBarStatus","immediateModeDelay","ignoreAccent","hierarchyMode"],searchSettings:["fields","operator","ignoreCase"],sortSettings:[],columns:[],selectedRowIndex:[]},i=0;i<e.length;i++)for(var r=this[e[i]],n=0,s=t[e[i]];n<s.length;n++){delete r[s[n]]}return this.ignoreInArrays(["filter","edit","filterBarTemplate","headerTemplate","template","commandTemplate","commands","dataSource"],this.columns),this.addOnPersist(e)},i.prototype.ignoreInArrays=function(e,t){for(var i=0;i<t.length;i++)t[i].columns?(this.ignoreInColumn(e,t[i]),this.ignoreInArrays(e,t[i].columns)):this.ignoreInColumn(e,t[i])},i.prototype.ignoreInColumn=function(e,t){for(var i=0;i<e.length;i++)delete t[e[i]],t.filter={}},i.prototype.mouseClickHandler=function(e){if(sf.base.isNullOrUndefined(e.touches)){var t=e.target;!t.classList.contains("e-treegridexpand")&&!t.classList.contains("e-treegridcollapse")||this.isEditCollapse||this.grid.isEdit||this.expandCollapseRequest(t),this.isEditCollapse=!1,this.notify("checkboxSelection",{target:t})}},i.prototype.getRows=function(){return this.grid.getRows()},i.prototype.getPager=function(){return this.grid.getPager()},i.prototype.addRecord=function(e,t,i){if(this.editModule){this.editModule.isAddedRowByMethod=!0,this.editModule.addRecord(e,t,i)}},i.prototype.closeEdit=function(){this.grid.editModule&&this.grid.editModule.closeEdit()},i.prototype.saveCell=function(){this.grid.editModule&&this.grid.editModule.saveCell()},i.prototype.updateCell=function(e,t,i){this.grid.editModule&&this.grid.editModule.updateCell(e,t,i)},i.prototype.updateRow=function(e,t){if(this.grid.editModule)if(sf.base.isNullOrUndefined(e))this.grid.editModule.updateRow(e,t);else{var i=this.grid.getCurrentViewRecords()[e];sf.base.extend(i,t),this.grid.editModule.updateRow(e,i)}},i.prototype.deleteRecord=function(e,t){this.grid.editModule&&this.grid.editModule.deleteRecord(e,t)},i.prototype.startEdit=function(e){this.grid.editModule&&this.grid.editModule.startEdit(e)},i.prototype.editCell=function(e,t){this.editModule&&this.editModule.editCell(e,t)},i.prototype.enableToolbarItems=function(e,t){this.grid.toolbarModule&&this.grid.toolbarModule.enableItems(e,t)},i.prototype.endEdit=function(){this.grid.editModule&&this.grid.editModule.endEdit()},i.prototype.openColumnChooser=function(e,t){this.columnChooserModule&&this.columnChooserModule.openColumnChooser(e,t)},i.prototype.deleteRow=function(e){this.grid.editModule&&this.grid.editModule.deleteRow(e)},i.prototype.getPrimaryKeyFieldNames=function(){return this.grid.getPrimaryKeyFieldNames()},i.prototype.setCellValue=function(e,t,i){this.grid.setCellValue(e,t,i);var r=this.grid.getRowIndexByPrimaryKey(e),n=this.getCurrentViewRecords()[r];sf.base.isNullOrUndefined(n)||ce({value:n,action:"edit"},this,this.isSelfReference,n.index,this.grid.selectedRowIndex,t)},i.prototype.setRowData=function(e,t){var i,r=this.getCurrentViewRecords(),n=this.grid.getPrimaryKeyFieldNames()[0],s={};r.some((function(t){return t[n]===e&&(s=t,!0)})),i=s.level,t.level=i,t.index=s.index,t.childRecords=s.childRecords,t.taskData=s.taskData,t.uniqueID=s.uniqueID,t.parentItem=s.parentItem,t.checkboxState=s.checkboxState,t.hasChildRecords=s.hasChildRecords,t.parentUniqueID=s.parentUniqueID,t.expanded=s.expanded,this.grid.setRowData(e,t)},i.prototype.goToPage=function(e){this.grid.pagerModule&&this.grid.pagerModule.goToPage(e)},i.prototype.updateExternalMessage=function(e){this.pagerModule&&this.grid.pagerModule.updateExternalMessage(e)},i.prototype.getCellFromIndex=function(e,t){return this.grid.getCellFromIndex(e,t)},i.prototype.getColumnByField=function(e){return sf.grids.iterateArrayOrObject(this.columnModel,(function(t){if(t.field===e)return t}))[0]},i.prototype.getColumnByUid=function(e){var t=this.initialRender?this.grid.columns:this.columns;return sf.grids.iterateArrayOrObject(t,(function(t){if(t.uid===e)return t}))[0]},i.prototype.getColumnFieldNames=function(){return this.grid.getColumnFieldNames()},i.prototype.getFooterContent=function(){return this.grid.getFooterContent()},i.prototype.getFooterContentTable=function(){return this.grid.getFooterContentTable()},i.prototype.showColumns=function(e,t){this.grid.showColumns(e,t),this.updateColumnModel()},i.prototype.hideColumns=function(e,t){this.grid.hideColumns(e,t),this.updateColumnModel()},i.prototype.getColumnHeaderByField=function(e){return this.grid.getColumnHeaderByField(e)},i.prototype.getColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},i.prototype.getColumnHeaderByUid=function(e){return this.grid.getColumnHeaderByUid(e)},i.prototype.getColumnIndexByField=function(e){return this.grid.getColumnIndexByField(e)},i.prototype.getColumnIndexByUid=function(e){return this.grid.getColumnIndexByUid(e)},i.prototype.getColumns=function(e){return this.updateColumnModel(this.grid.getColumns(e)),this.columnModel},i.prototype.updateColumnModel=function(e){var t,i,r=sf.base.isNullOrUndefined(e)?this.grid.getColumns():e;-1!==this.treeColumnIndex&&this.columnModel[this.treeColumnIndex]&&!sf.base.isNullOrUndefined(this.columnModel[this.treeColumnIndex].template)&&(t=this.columnModel[this.treeColumnIndex].template,i=this.columnModel[this.treeColumnIndex].field),this.columnModel=[];for(var n,s=!1,o=0;o<r.length;o++){n={};for(var d=0,l=Object.keys(r[o]);d<l.length;d++){var p=l[d];n[p]=r[o][p]}this.columnModel.push(new a(n)),i!==this.columnModel[o].field||sf.base.isNullOrUndefined(t)||""===t||(this.columnModel[o].template=t)}return this.deepMerge=["columns"],this.grid.columns.length!==this.columnModel.length&&(s=!0),s||this.setProperties({columns:this.columnModel},!0),this.deepMerge=void 0,this.columnModel},i.prototype.getContent=function(){return this.grid.getContent()},i.prototype.mergePersistTreeGridData=function(){this.grid.mergePersistGridData.apply(this)},i.prototype.mergeColumns=function(e,t){this.grid.mergeColumns.apply(this,[e,t])},i.prototype.updateTreeGridModel=function(){this.setProperties({filterSettings:sf.grids.getObject("properties",this.grid.filterSettings)},!0),this.setProperties({pageSettings:sf.grids.getObject("properties",this.grid.pageSettings)},!0),this.setProperties({searchSettings:sf.grids.getObject("properties",this.grid.searchSettings)},!0),this.setProperties({sortSettings:sf.grids.getObject("properties",this.grid.sortSettings)},!0)},i.prototype.getContentTable=function(){return this.grid.getContentTable()},i.prototype.getDataRows=function(){for(var e=[],t=this.grid.getDataRows(),i=0,r=t.length;i<r;i++)t[i].classList.contains("e-summaryrow")||e.push(t[i]);return e},i.prototype.getCurrentViewRecords=function(){return this.grid.currentViewData},i.prototype.getBatchChanges=function(){return this.grid.editModule.getBatchChanges()},i.prototype.getHeaderContent=function(){return this.grid.getHeaderContent()},i.prototype.getHeaderTable=function(){return this.grid.getHeaderTable()},i.prototype.getRowByIndex=function(e){return this.grid.getRowByIndex(e)},i.prototype.getRowInfo=function(e){return this.grid.getRowInfo(e)},i.prototype.getUidByColumnField=function(e){return this.grid.getUidByColumnField(e)},i.prototype.getVisibleColumns=function(){for(var e=[],t=0,i=this.columnModel;t<i.length;t++){var r=i[t];r.visible&&e.push(r)}return e},i.prototype.showSpinner=function(){sf.popups.showSpinner(this.element)},i.prototype.hideSpinner=function(){sf.popups.hideSpinner(this.element)},i.prototype.refresh=function(){this.uniqueIDCollection={},this.convertTreeData(this.dataSource),x(this)||(this.grid.dataSource=this.dataSource instanceof sf.data.DataManager?new sf.data.DataManager(this.dataSource.dataSource,this.dataSource.defaultQuery,this.dataSource.adaptor):this.flatData),this.grid.refresh()},i.prototype.getCheckedRecords=function(){return this.selectionModule.getCheckedrecords()},i.prototype.getVisibleRecords=function(){var e=[],t=this.getCurrentViewRecords();if(this.allowPaging)e=t;else for(var i=0;i<t.length;i++)e.push(t[i]),t[i].expanded||(i+=O(t[i]).length);return e},i.prototype.getCheckedRowIndexes=function(){return this.selectionModule.getCheckedRowIndexes()},i.prototype.selectCheckboxes=function(e){this.selectionModule.selectCheckboxes(e)},i.prototype.refreshColumns=function(e){sf.base.isNullOrUndefined(e)||e?(this.grid.columns=this.getGridColumns(this.columns),this.grid.refreshColumns()):this.grid.setProperties({columns:this.getGridColumns(this.columns)},!0)},i.prototype.refreshHeader=function(){this.grid.refreshHeader()},i.prototype.expandCollapseRequest=function(e){if("Batch"===this.editSettings.mode){if(this.getBatchChanges()[this.changedRecords].length||this.getBatchChanges()[this.deletedRecords].length||this.getBatchChanges()[this.addedRecords].length){var t=this.grid.editModule.dialogObj;return this.grid.editModule.showDialog("CancelEdit",t),void(this.targetElement=e)}}if(this.rowTemplate){var i=e.closest(".e-treerowcell").parentElement,r=this.getCurrentViewRecords()[i.rowIndex];e.classList.contains("e-treegridexpand")?this.collapseRow(i,r):this.expandRow(i,r)}else{r=(i=this.grid.getRowInfo(e)).rowData;this.enableImmutableMode&&(r=this.getCurrentViewRecords()[i.rowIndex]),e.classList.contains("e-treegridexpand")?this.collapseRow(i.row,r):this.expandRow(i.row,r)}},i.prototype.expandRow=function(e,t){var i=this;t=this.getCollapseExpandRecords(e,t),!sf.base.isNullOrUndefined(e)&&e.cells[0].classList.contains("e-lastrowcell")&&this.lastRowBorder(e,!1);var r={data:t,row:e,cancel:!1};this.trigger("expanding",r,(function(r){if(!r.cancel){i.expandCollapse("expand",e,t);if((!C(i)||P(i))&&(!x(i)||!sf.base.isNullOrUndefined(t.Children))){var n={data:t,row:e};i.setHeightForFrozenContent(),i.trigger("expanded",n)}}}))},i.prototype.setHeightForFrozenContent=function(){var e=this.grid.getFrozenLeftColumnsCount()>0||this.grid.getFrozenRightColumnsCount()>0;(this.grid.getFrozenColumns()>0||e)&&this.grid.contentModule.refreshScrollOffset()},i.prototype.getCollapseExpandRecords=function(e,t){return this.allowPaging&&"All"===this.pageSettings.pageSizeMode&&this.isExpandAll&&sf.base.isNullOrUndefined(t)&&!C(this)?t=this.flatData.filter((function(e){return e.hasChildRecords})):sf.base.isNullOrUndefined(t)&&(t=this.grid.getCurrentViewRecords()[e.rowIndex]),t},i.prototype.collapseRow=function(e,t){var i=this,r={data:t=this.getCollapseExpandRecords(e,t),row:e,cancel:!1};this.trigger("collapsing",r,(function(r){if(!r.cancel){i.expandCollapse("collapse",e,t);var n={data:t,row:e};if(!C(i))if(i.setHeightForFrozenContent(),i.trigger("collapsed",n),i.enableInfiniteScrolling)i.grid.getContent().firstElementChild.scrollHeight-i.grid.getContent().firstElementChild.scrollTop<i.grid.getRowHeight()+ +i.height&&i.grid.getContent().firstElementChild.scrollBy(0,i.grid.getRowHeight())}}))},i.prototype.expandAtLevel=function(e){if((this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)&&!C(this)){var t=this.grid.dataSource.filter((function(t){return t.hasChildRecords&&t.level===e&&(t.expanded=!0),t.hasChildRecords&&t.level===e}));this.expandRow(null,t)}else{t=this.getRecordDetails(e);for(var i=sf.grids.getObject("rows",t),r=sf.grids.getObject("records",t),n=0;n<r.length;n++){var s=this.flatData[r[n].parentItem.index].index;!1===this.flatData[s].expanded&&(r.push(this.flatData[s]),this.flatData[s].expanded=!0),this.expandRow(i[n],r[n])}}},i.prototype.getRecordDetails=function(e){var t=this.getRows().filter((function(t){return-1!==t.className.indexOf("level"+e)&&(t.querySelector(".e-treegridcollapse")||t.querySelector(".e-treegridexpand"))}));return{records:this.getCurrentViewRecords().filter((function(t){return t.level===e&&t.hasChildRecords})),rows:t}},i.prototype.collapseAtLevel=function(e){if((this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)&&!C(this)){var t=this.grid.dataSource.filter((function(t){return t.hasChildRecords&&t.level===e&&(t.expanded=!1),t.hasChildRecords&&t.level===e}));this.collapseRow(null,t)}else for(var i=this.getRecordDetails(e),r=sf.grids.getObject("rows",i),n=sf.grids.getObject("records",i),s=0;s<n.length;s++)this.collapseRow(r[s],n[s]);if(!this.grid.contentModule.isDataSourceChanged&&this.enableVirtualization&&this.getRows()&&this.parentData.length===this.getRows().length){this.grid.contentModule.startIndex=-1,this.grid.contentModule.endIndex=-1}},i.prototype.expandAll=function(){this.expandCollapseAll("expand")},i.prototype.collapseAll=function(){this.expandCollapseAll("collapse")},i.prototype.expandCollapseAll=function(e){var t=this.getRows().filter((function(t){return t.querySelector(".e-treegrid"+("expand"===e?"collapse":"expand"))}));if(!t.length&&this.getRows().length&&t.push(this.getRows()[0]),this.isExpandAll=!0,this.isCollapseAll=!0,(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)&&!C(this)){if(this.flatData.filter((function(t){t.hasChildRecords&&(t.expanded="collapse"!==e)})),t.length)"collapse"===e?this.collapseRow(t[0]):this.expandRow(t[0]);else if(this.allowPaging){var i=this.enableCollapseAll;this.setProperties({enableCollapseAll:!0},!0),this.grid.pagerModule.goToPage(1),this.setProperties({enableCollapseAll:i},!0)}}else for(var r=0;r<t.length;r++)"collapse"===e?this.collapseRow(t[r]):this.expandRow(t[r]);this.isExpandAll=!1,this.isCollapseAll=!1},i.prototype.expandCollapse=function(e,t,i,r){var n,s={row:t,data:i,childData:[],requestType:e},a=this.getCurrentViewRecords().filter((function(e){return e.parentUniqueID===i.uniqueID}));!C(this)&&"expand"===e&&this.isSelfReference&&x(this)&&!a.length&&this.updateChildOnDemand(s);var o=this.getRows();if(this.rowTemplate){var d=this.getContentTable().rows;o=[].slice.call(d)}if(sf.base.isNullOrUndefined(t)?t=o[this.getCurrentViewRecords().indexOf(i)]:+t.getAttribute("aria-rowindex"),sf.base.isNullOrUndefined(t)||t.setAttribute("aria-expanded","expand"===e?"true":"false"),!(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)||C(this)||x(this)){var l=void 0;if("expand"===e){if(l="table-row",r||(i.expanded=!0,this.uniqueIDCollection[i.uniqueID].expanded=i.expanded),sf.base.isNullOrUndefined(t)||(n=t.getElementsByClassName("e-treegridcollapse")[0]),r&&!sf.base.isNullOrUndefined(i[this.expandStateMapping])&&i[this.expandStateMapping]&&sf.base.isNullOrUndefined(n)&&(n=t.getElementsByClassName("e-treegridexpand")[0]),sf.base.isNullOrUndefined(n))return;n.classList.contains("e-treegridexpand")||sf.base.addClass([n],"e-treegridexpand"),sf.base.removeClass([n],"e-treegridcollapse")}else{if(l="none",r&&!x(this)||(i.expanded=!1,this.uniqueIDCollection[i.uniqueID].expanded=i.expanded),sf.base.isNullOrUndefined(t)||(n=t.getElementsByClassName("e-treegridexpand")[0]),r&&!sf.base.isNullOrUndefined(i[this.expandStateMapping])&&!i[this.expandStateMapping]&&sf.base.isNullOrUndefined(n)&&(n=t.getElementsByClassName("e-treegridcollapse")[0]),sf.base.isNullOrUndefined(n))return;n.classList.contains("e-treegridcollapse")||sf.base.addClass([n],"e-treegridcollapse"),sf.base.removeClass([n],"e-treegridexpand")}var p=o.filter((function(e){return e.classList.contains("e-griddetailrowindex"+i.index+"level"+(i.level+1))}));if(C(this)&&!P(this)?this.remoteExpand(e,t,i):x(this)&&!a.length&&"collapse"!==e||this.localExpand(e,t,i),this.isPixelHeight()&&!t.cells[0].classList.contains("e-lastrowcell"))for(var h=this.getRows(),c=(d=this.getContentTable().rows,(h=[].slice.call(d)).length-1);c>0;c--)if(!N(h[c])){var u=this.getContentTable().scrollHeight,g=this.getContent().clientHeight;this.lastRowBorder(h[c],u<=g);break}this.notify("rowExpandCollapse",{detailrows:p,action:l,record:i,row:t}),this.updateAltRow(o)}else this.notify("localPagedExpandCollapse",{action:e,row:t,record:i})},i.prototype.updateChildOnDemand=function(e){var t=this,i=new sf.data.Deferred;e.childDataBind=i.resolve;var r=e.data;this.trigger("dataStateChange",e),i.promise.then((function(){if(e.childData.length){for(var i=t.flatData,n=0,s=0;s<i.length;s++)if(i[s].taskData===r.taskData){n=s;break}var a=sf.base.getValue("result",t.dataSource),o=E(e.childData),d=r[t.childMapping]&&r[t.childMapping].length>o.length?r[t.childMapping].length:o.length;for(s=0;s<d;s++)r[t.childMapping]&&a.filter((function(e,i){e[t.parentIdMapping]===r[t.idMapping]&&a.splice(i,1)})),o[s]?(o[s].level=r.level+1,o[s].index=Math.ceil(1e3*Math.random()),o[s].parentItem=sf.base.extend({},r),o[s].taskData=sf.base.extend({},o[s]),delete o[s].parentItem.childRecords,delete o[s].taskData.parentItem,o[s].parentUniqueID=r.uniqueID,o[s].uniqueID=sf.grids.getUid(t.element.id+"_data_"),sf.base.setValue("uniqueIDCollection."+o[s].uniqueID,o[s],t),(!sf.base.isNullOrUndefined(o[s][t.childMapping])||o[s][t.hasChildMapping]&&x(t))&&(o[s].hasChildRecords=!0),i.splice(n+1+s,r[t.childMapping]&&r[t.childMapping][s]?1:0,o[s])):i.splice(n+1+s,1);i[n][t.childMapping]=o,i[n].childRecords=o,i[n].expanded=!0,sf.base.setValue("uniqueIDCollection."+i[n].uniqueID,i[n],t);for(var l=0;l<e.childData.length;l++)a.push(e.childData[l])}t.isExpandRefresh=!0,t.grid.refresh(),t.setHeightForFrozenContent(),t.trigger("expanded",e)}))},i.prototype.remoteExpand=function(e,t,i){var r=this.getRows();if(this.rowTemplate){var n=this.getContentTable().rows;r=[].slice.call(n)}var s,a={data:i,row:t};if(s=r.filter((function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))})),"expand"===e){this.notify("remoteExpand",{record:i,rows:s,parentRow:t});var o={row:t,data:i};s.length>0&&(this.setHeightForFrozenContent(),this.trigger("expanded",o))}else this.collapseRemoteChild({record:i,rows:s}),this.setHeightForFrozenContent(),this.trigger("collapsed",a)},i.prototype.localExpand=function(e,t,i){var r,n,s,a=this.getCurrentViewRecords().filter((function(e){return e.parentUniqueID===i.uniqueID}));this.isPixelHeight()&&t.cells[0].classList.contains("e-lastrowcell")&&this.lastRowBorder(t,!1);var o=this.getRows();if(this.rowTemplate){var d=this.getContentTable().rows;o=[].slice.call(d)}var l="expand"===e?"table-row":"none",p=this.getPrimaryKeyFieldNames()[0];if(this.enableImmutableMode&&!this.allowPaging){r=[];for(var h=0;h<a.length;h++){var c=this.grid.getRowIndexByPrimaryKey(a[h][p]);r.push(this.getRows()[c])}}else r=o.filter((function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))}));(this.frozenRows||this.frozenColumns||this.getFrozenColumns())&&(n=this.getMovableRows().filter((function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))}))),(this.grid.getFrozenLeftColumnsCount()>0||this.grid.getFrozenRightColumnsCount()>0)&&(s=this.getFrozenRightRows().filter((function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))})));for(h=0;h<r.length;h++)sf.base.isNullOrUndefined(r[h])||(r[h].style.display=l),sf.base.isNullOrUndefined(n)||(n[h].style.display=l),sf.base.isNullOrUndefined(s)||(s[h].style.display=l),this.notify("childRowExpand",{row:r[h]}),sf.base.isNullOrUndefined(a[h].childRecords)||"expand"===e&&!sf.base.isNullOrUndefined(a[h].expanded)&&!a[h].expanded||(this.expandCollapse(e,r[h],a[h],!0),this.frozenColumns<=this.treeColumnIndex&&!sf.base.isNullOrUndefined(n)&&this.expandCollapse(e,n[h],a[h],!0))},i.prototype.updateAltRow=function(e){if(this.enableAltRow&&!this.rowTemplate)for(var t=0,i=0;e&&i<e.length;i++){var r=e[i];"none"!==r.style.display&&(r.classList.contains("e-altrow")&&sf.base.removeClass([r],"e-altrow"),t%2==0||r.classList.contains("e-summaryrow")||r.classList.contains("e-detailrow")||sf.base.addClass([r],"e-altrow"),r.classList.contains("e-summaryrow")||r.classList.contains("e-detailrow")||t++)}},i.prototype.treeColumnRowTemplate=function(){if(this.rowTemplate){var e=this.getContentTable().rows;e=[].slice.call(e);for(var t=0;t<e.length;t++){var i=this.grid.getContentTable().rows[t].cells[this.treeColumnIndex],r=e[t],n={data:this.grid.getRowsObject()[t].data,row:r,cell:i,column:this.getColumns()[this.treeColumnIndex]};this.renderModule.cellRender(n)}}},i.prototype.collapseRemoteChild=function(e,t){t||(e.record.expanded=!1);var i,r,n=e.rows,s=[],a=[],o=this.getFrozenLeftColumnsCount()>0||this.getFrozenRightColumnsCount()>0;o&&(s=this.getMovableRows().filter((function(t){return t.querySelector(".e-gridrowindex"+e.record.index+"level"+(e.record.level+1))})),a=this.getFrozenRightRows().filter((function(t){return t.querySelector(".e-gridrowindex"+e.record.index+"level"+(e.record.level+1))})));for(var d=0;d<n.length;d++){n[d].style.display="none",i=n[d];var l=n[d].querySelector(".e-detailrowexpand");if(sf.base.isNullOrUndefined(l)||this.grid.detailRowModule.collapse(l),o&&(s[d].style.display="none",a[d].style.display="none",n[d].querySelector(".e-treecolumn-container .e-treegridexpand")||(s[d].querySelector(".e-treecolumn-container .e-treegridexpand")?i=s[d]:a[d].querySelector(".e-treecolumn-container .e-treegridexpand")&&(i=a[d]))),i.querySelector(".e-treecolumn-container .e-treegridexpand")){var p=i.querySelector(".e-treecolumn-container .e-treegridexpand");r=this.rowTemplate?this.grid.getCurrentViewRecords()[n[d].rowIndex]:this.grid.getRowObjectFromUID(n[d].getAttribute("data-Uid")).data,!sf.base.isNullOrUndefined(p)&&r.expanded&&(sf.base.removeClass([p],"e-treegridexpand"),sf.base.addClass([p],"e-treegridcollapse"));for(var h=[],c=this.getRows(),u=0;u<c.length;u++)c[u].querySelector(".e-gridrowindex"+r.index+"level"+(r.level+1))&&h.push(c[u]);h.length&&r.expanded&&this.collapseRemoteChild({record:r,rows:h},!0)}}},i.prototype.addListener=function(){this.on("updateResults",this.updateResultModel,this),this.grid.on("initial-end",this.afterGridRender,this)},i.prototype.updateResultModel=function(e){this.dataResults=e},i.prototype.removeListener=function(){this.isDestroyed||(this.off("updateResults",this.updateResultModel),this.grid.off("initial-end",this.afterGridRender))},i.prototype.filterByColumn=function(e,t,i,r,n,s,a,o){this.grid.filterByColumn(e,t,i,r,n,s,a,o)},i.prototype.clearFiltering=function(){this.grid.clearFiltering()},i.prototype.removeFilteredColsByField=function(e,t){this.grid.removeFilteredColsByField(e,t)},i.prototype.selectRow=function(e,t){this.grid.selectRow(e,t)},i.prototype.selectRows=function(e){this.grid.selectRows(e)},i.prototype.clearSelection=function(){this.grid.clearSelection()},i.prototype.copy=function(e){this.clipboardModule.copy(e)},i.prototype.paste=function(e,t,i){this.clipboardModule.paste(e,t,i)},i.prototype.selectCell=function(e,t){this.grid.selectCell(e,t)},i.prototype.getSelectedRows=function(){return this.grid.getSelectedRows()},i.prototype.getMovableCellFromIndex=function(e,t){return this.grid.getMovableCellFromIndex(e,t)},i.prototype.getMovableDataRows=function(){return this.grid.getMovableDataRows()},i.prototype.getMovableRowByIndex=function(e){return this.grid.getMovableRowByIndex(e)},i.prototype.getMovableRows=function(){return this.grid.getMovableRows()},i.prototype.getFrozenRightRowByIndex=function(e){return this.grid.getFrozenRightRowByIndex(e)},i.prototype.getFrozenRightRows=function(){return this.grid.getFrozenRightRows()},i.prototype.getFrozenRightDataRows=function(){return this.grid.getFrozenRightDataRows()},i.prototype.getFrozenRightCellFromIndex=function(e,t){return this.grid.getFrozenRightCellFromIndex(e,t)},i.prototype.getFrozenLeftColumnHeaderByIndex=function(e){return this.grid.getFrozenLeftColumnHeaderByIndex(e)},i.prototype.getFrozenRightColumnHeaderByIndex=function(e){return this.grid.getFrozenRightColumnHeaderByIndex(e)},i.prototype.getMovableColumnHeaderByIndex=function(e){return this.grid.getMovableColumnHeaderByIndex(e)},i.prototype.getMovableColumnsCount=function(){return this.grid.getMovableColumnsCount()},i.prototype.getFrozenLeftColumnsCount=function(){return this.grid.getFrozenLeftColumnsCount()},i.prototype.getFrozenRightColumnsCount=function(){return this.grid.getFrozenRightColumnsCount()},i.prototype.getFrozenLeftColumns=function(){return this.updateColumnModel(this.grid.getFrozenLeftColumns()),this.columnModel},i.prototype.getFrozenRightColumns=function(){return this.updateColumnModel(this.grid.getFrozenRightColumns()),this.columnModel},i.prototype.getVisibleMovableCount=function(){return this.grid.getVisibleMovableCount()},i.prototype.getVisibleFrozenRightCount=function(){return this.grid.getVisibleFrozenRightCount()},i.prototype.getVisibleFrozenLeftCount=function(){return this.grid.getVisibleFrozenLeftCount()},i.prototype.getMovableColumns=function(){return this.updateColumnModel(this.grid.getMovableColumns()),this.columnModel},i.prototype.getFrozenColumns=function(){return this.getFrozenCount(this.columns,0)+this.frozenColumns},i.prototype.getFrozenCount=function(e,t){for(var i=0,r=e.length;i<r;i++)e[i].columns?t=this.getFrozenCount(e[i].columns,t):e[i].isFrozen&&t++;return t},i.prototype.getSelectedRowIndexes=function(){return this.grid.getSelectedRowIndexes()},i.prototype.getSelectedRowCellIndexes=function(){return this.grid.getSelectedRowCellIndexes()},i.prototype.getSelectedRecords=function(){return this.grid.getSelectedRecords()},i.prototype.getDataModule=function(){return{baseModule:this.grid.getDataModule(),treeModule:this.dataModule}},i.prototype.reorderRows=function(e,t,i){this.rowDragAndDropModule.reorderRows(e,t,i)},Ie([sf.base.Property(0)],i.prototype,"frozenRows",void 0),Ie([sf.base.Property(0)],i.prototype,"frozenColumns",void 0),Ie([sf.base.Property("Ellipsis")],i.prototype,"clipMode",void 0),Ie([sf.base.Property([])],i.prototype,"columns",void 0),Ie([sf.base.Property(null)],i.prototype,"childMapping",void 0),Ie([sf.base.Property(null)],i.prototype,"hasChildMapping",void 0),Ie([sf.base.Property(0)],i.prototype,"treeColumnIndex",void 0),Ie([sf.base.Property(null)],i.prototype,"idMapping",void 0),Ie([sf.base.Property(null)],i.prototype,"parentIdMapping",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableCollapseAll",void 0),Ie([sf.base.Property(null)],i.prototype,"expandStateMapping",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowRowDragAndDrop",void 0),Ie([sf.base.Property([])],i.prototype,"dataSource",void 0),Ie([sf.base.Property()],i.prototype,"query",void 0),Ie([sf.base.Property()],i.prototype,"cloneQuery",void 0),Ie([sf.base.Property("AllPages")],i.prototype,"printMode",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowPaging",void 0),Ie([sf.base.Property(!1)],i.prototype,"loadChildOnDemand",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowTextWrap",void 0),Ie([sf.base.Complex({},u)],i.prototype,"textWrapSettings",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowReordering",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowResizing",void 0),Ie([sf.base.Property(!1)],i.prototype,"autoCheckHierarchy",void 0),Ie([sf.base.Complex({},ee)],i.prototype,"pageSettings",void 0),Ie([sf.base.Complex({},sf.grids.RowDropSettings)],i.prototype,"rowDropSettings",void 0),Ie([sf.base.Property()],i.prototype,"pagerTemplate",void 0),Ie([sf.base.Property(!1)],i.prototype,"showColumnMenu",void 0),Ie([sf.base.Property(!1)],i.prototype,"showColumnChooser",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowSorting",void 0),Ie([sf.base.Property(!0)],i.prototype,"allowMultiSorting",void 0),Ie([sf.base.Complex({},he)],i.prototype,"sortSettings",void 0),Ie([sf.base.Collection([],ne)],i.prototype,"aggregates",void 0),Ie([sf.base.Complex({},oe)],i.prototype,"editSettings",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowFiltering",void 0),Ie([sf.base.Property()],i.prototype,"detailTemplate",void 0),Ie([sf.base.Complex({},p)],i.prototype,"filterSettings",void 0),Ie([sf.base.Complex({},z)],i.prototype,"searchSettings",void 0),Ie([sf.base.Property()],i.prototype,"toolbar",void 0),Ie([sf.base.Property()],i.prototype,"toolbarTemplate",void 0),Ie([sf.base.Property("Default")],i.prototype,"gridLines",void 0),Ie([sf.base.Property()],i.prototype,"contextMenuItems",void 0),Ie([sf.base.Property()],i.prototype,"columnMenuItems",void 0),Ie([sf.base.Property()],i.prototype,"rowTemplate",void 0),Ie([sf.base.Property("Parent")],i.prototype,"copyHierarchyMode",void 0),Ie([sf.base.Property(null)],i.prototype,"rowHeight",void 0),Ie([sf.base.Property(!0)],i.prototype,"enableAltRow",void 0),Ie([sf.base.Property(!0)],i.prototype,"allowKeyboard",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableHover",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableAutoFill",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableImmutableMode",void 0),Ie([sf.base.Property("auto")],i.prototype,"height",void 0),Ie([sf.base.Property("auto")],i.prototype,"width",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableVirtualization",void 0),Ie([sf.base.Property(!1)],i.prototype,"enableInfiniteScrolling",void 0),Ie([sf.base.Complex({},xe)],i.prototype,"infiniteScrollSettings",void 0),Ie([sf.base.Property("All")],i.prototype,"columnQueryMode",void 0),Ie([sf.base.Event()],i.prototype,"created",void 0),Ie([sf.base.Event()],i.prototype,"load",void 0),Ie([sf.base.Event()],i.prototype,"expanding",void 0),Ie([sf.base.Event()],i.prototype,"expanded",void 0),Ie([sf.base.Event()],i.prototype,"collapsing",void 0),Ie([sf.base.Event()],i.prototype,"collapsed",void 0),Ie([sf.base.Event()],i.prototype,"cellSave",void 0),Ie([sf.base.Event()],i.prototype,"cellSaved",void 0),Ie([sf.base.Event()],i.prototype,"actionBegin",void 0),Ie([sf.base.Event()],i.prototype,"actionComplete",void 0),Ie([sf.base.Event()],i.prototype,"beginEdit",void 0),Ie([sf.base.Event()],i.prototype,"batchAdd",void 0),Ie([sf.base.Event()],i.prototype,"batchDelete",void 0),Ie([sf.base.Event()],i.prototype,"batchCancel",void 0),Ie([sf.base.Event()],i.prototype,"beforeBatchAdd",void 0),Ie([sf.base.Event()],i.prototype,"beforeBatchDelete",void 0),Ie([sf.base.Event()],i.prototype,"beforeBatchSave",void 0),Ie([sf.base.Event()],i.prototype,"cellEdit",void 0),Ie([sf.base.Event()],i.prototype,"actionFailure",void 0),Ie([sf.base.Event()],i.prototype,"dataBound",void 0),Ie([sf.base.Event()],i.prototype,"dataSourceChanged",void 0),Ie([sf.base.Event()],i.prototype,"dataStateChange",void 0),Ie([sf.base.Event()],i.prototype,"recordDoubleClick",void 0),Ie([sf.base.Event()],i.prototype,"rowDataBound",void 0),Ie([sf.base.Event()],i.prototype,"detailDataBound",void 0),Ie([sf.base.Event()],i.prototype,"queryCellInfo",void 0),Ie([sf.base.Property(!0)],i.prototype,"allowSelection",void 0),Ie([sf.base.Event()],i.prototype,"rowSelecting",void 0),Ie([sf.base.Event()],i.prototype,"rowSelected",void 0),Ie([sf.base.Event()],i.prototype,"rowDeselecting",void 0),Ie([sf.base.Event()],i.prototype,"rowDeselected",void 0),Ie([sf.base.Event()],i.prototype,"headerCellInfo",void 0),Ie([sf.base.Event()],i.prototype,"cellSelecting",void 0),Ie([sf.base.Event()],i.prototype,"columnMenuOpen",void 0),Ie([sf.base.Event()],i.prototype,"columnMenuClick",void 0),Ie([sf.base.Event()],i.prototype,"cellSelected",void 0),Ie([sf.base.Event()],i.prototype,"cellDeselecting",void 0),Ie([sf.base.Event()],i.prototype,"cellDeselected",void 0),Ie([sf.base.Event()],i.prototype,"resizeStart",void 0),Ie([sf.base.Event()],i.prototype,"resizing",void 0),Ie([sf.base.Event()],i.prototype,"resizeStop",void 0),Ie([sf.base.Event()],i.prototype,"columnDragStart",void 0),Ie([sf.base.Event()],i.prototype,"columnDrag",void 0),Ie([sf.base.Event()],i.prototype,"columnDrop",void 0),Ie([sf.base.Event()],i.prototype,"checkboxChange",void 0),Ie([sf.base.Event()],i.prototype,"printComplete",void 0),Ie([sf.base.Event()],i.prototype,"beforePrint",void 0),Ie([sf.base.Event()],i.prototype,"toolbarClick",void 0),Ie([sf.base.Event()],i.prototype,"beforeDataBound",void 0),Ie([sf.base.Event()],i.prototype,"contextMenuOpen",void 0),Ie([sf.base.Event()],i.prototype,"contextMenuClick",void 0),Ie([sf.base.Event()],i.prototype,"beforeCopy",void 0),Ie([sf.base.Event()],i.prototype,"beforePaste",void 0),Ie([sf.base.Event()],i.prototype,"rowDrag",void 0),Ie([sf.base.Event()],i.prototype,"rowDragStart",void 0),Ie([sf.base.Event()],i.prototype,"rowDragStartHelper",void 0),Ie([sf.base.Event()],i.prototype,"rowDrop",void 0),Ie([sf.base.Property(-1)],i.prototype,"selectedRowIndex",void 0),Ie([sf.base.Complex({},G)],i.prototype,"selectionSettings",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowExcelExport",void 0),Ie([sf.base.Property(!1)],i.prototype,"allowPdfExport",void 0),Ie([sf.base.Event()],i.prototype,"pdfQueryCellInfo",void 0),Ie([sf.base.Event()],i.prototype,"pdfHeaderQueryCellInfo",void 0),Ie([sf.base.Event()],i.prototype,"excelQueryCellInfo",void 0),Ie([sf.base.Event()],i.prototype,"excelHeaderQueryCellInfo",void 0),Ie([sf.base.Event()],i.prototype,"beforeExcelExport",void 0),Ie([sf.base.Event()],i.prototype,"excelExportComplete",void 0),Ie([sf.base.Event()],i.prototype,"beforePdfExport",void 0),Ie([sf.base.Event()],i.prototype,"pdfExportComplete",void 0),i=r=Ie([sf.base.NotifyPropertyChanges],i)}(sf.base.Component),Me=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Reorder),this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"reorder"},e.prototype.addEventListener=function(){this.parent.on("getColumnIndex",this.getTreeColumn,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("getColumnIndex",this.getTreeColumn)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getTreeColumn=function(){for(var e,t=this.parent.columnModel[this.parent.treeColumnIndex],i=this.parent.getColumns(),r=0;r<i.length;r++){if(sf.grids.getObject("field",t)===sf.grids.getObject("field",i[r])){e=r;break}}this.parent.setProperties({treeColumnIndex:e},!0)},e}(),Oe=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Resize),this.parent=e}return e.prototype.autoFitColumns=function(e){this.parent.grid.autoFitColumns(e)},e.prototype.getModuleName=function(){return"resize"},e.prototype.destroy=function(){this.parent.isDestroyed||this.parent.grid.resizeModule.destroy()},e}(),Pe=function(){function e(e){this.canDrop=!0,this.isDraggedWithChild=!1,this.isaddtoBottom=!1,sf.grids.Grid.Inject(sf.grids.RowDD),this.parent=e,this.addEventListener()}return e.prototype.getChildrecordsByParentID=function(e){return(this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource).filter((function(t){return t.uniqueID===e}))},e.prototype.addEventListener=function(){this.parent.on("row-draging",this.Rowdraging,this),this.parent.on("row-dropped",this.rowDropped,this),this.parent.on("rows-add",this.rowsAdded,this),this.parent.on("rows-remove",this.rowsRemoved,this)},e.prototype.reorderRows=function(e,t,i){var r=this.parent;if(e[0]!==t&&-1!==["above","below","child"].indexOf(i)){"above"===i&&(this.dropPosition="topSegment"),"below"===i&&(this.dropPosition="bottomSegment"),"child"===i&&(this.dropPosition="middleSegment");for(var n=[],s=0;s<e.length;s++)n[s]=this.parent.getCurrentViewRecords()[e[s]];var a={data:n,dropIndex:t};if(x(this.parent)||this.dropRows(a,!0),r.isLocalData&&(r.flatData=this.orderToIndex(r.flatData)),this.parent.grid.refresh(),this.parent.enableImmutableMode&&"middleSegment"===this.dropPosition){var o=this.parent.treeColumnIndex+1,d=this.parent.getRows()[e[0]],l=a.data[0],p=[],h=[];p.push(l),h.push(d);var c=k(this.parent,a.data[0].parentUniqueID),u=this.parent.getRows()[t];p.push(c),h.push(u);for(s=0;s<p.length;s++)this.parent.renderModule.cellRender({data:p[s],cell:h[s].cells[o],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex],requestType:"rowDragAndDrop"})}}},e.prototype.orderToIndex=function(e){for(var t=function(t){if(e[t].index=t,!sf.base.isNullOrUndefined(e[t].parentItem)){var i=e.filter((function(i){return i.uniqueID===e[t].parentUniqueID}))[0];e[t].parentItem.index=i.index}},i=0;i<e.length;i++)t(i);return e},e.prototype.rowsAdded=function(e){for(var t,i=e.records,r=e.records.length-1;r>-1;r--)if((t=i[r]).parentUniqueID){var n=i.filter((function(e){return e.uniqueID===t.parentUniqueID}));if(n.length){var s=n[0].childRecords.indexOf(t),a=n[0];-1!==s&&(sf.base.isNullOrUndefined(this.parent.idMapping)&&(a.childRecords.splice(s,1),a.childRecords.length||(a.hasChildRecords=!1,a.hasFilteredChildRecords=!1)),this.isDraggedWithChild=!0)}}if(sf.base.isNullOrUndefined(this.parent.dataSource)||!this.parent.dataSource.length){var o,d=this.parent,l=e.records;for(r=e.records.length-1;r>-1;r--){o=l[r],!r&&o.hasChildRecords&&(o.taskData[this.parent.parentIdMapping]=null);if(sf.base.isNullOrUndefined(d.parentIdMapping)||(d.childMapping=null),sf.base.isNullOrUndefined(o.taskData)||sf.base.isNullOrUndefined(d.childMapping)||Object.prototype.hasOwnProperty.call(o.taskData,d.childMapping)||(o.taskData[d.childMapping]=[]),Object.prototype.hasOwnProperty.call(o,d.childMapping)&&o[d.childMapping].length&&!this.isDraggedWithChild&&!sf.base.isNullOrUndefined(d.parentIdMapping))for(var p=o[d.childMapping],h=0;h<p.length;h++)-1===l.indexOf(p[h])&&(l.splice(h,0,p[h]),p[h].taskData=sf.base.extend({},p[h]),r+=1);Object.prototype.hasOwnProperty.call(o,d.parentIdMapping)&&null!=o[d.parentIdMapping]&&!this.isDraggedWithChild&&(o.taskData[d.parentIdMapping]=null,delete o.parentItem,delete o.parentUniqueID),sf.base.isNullOrUndefined(d.dataSource)&&(d.dataSource=[]),d.dataSource.splice(0,0,o.taskData)}d.setProperties({dataSource:d.dataSource},!1)}else{for(r=0;r<i.length;r++)sf.base.setValue("uniqueIDCollection."+i[r].uniqueID,i[r],this.parent);var c={data:e.records,dropIndex:e.toIndex};this.parent.dataSource instanceof sf.data.DataManager?(this.treeGridData=this.parent.dataSource.dataSource.json,this.treeData=this.parent.dataSource.dataSource.json):(this.treeGridData=this.parent.grid.dataSource,this.treeData=this.parent.dataSource),sf.base.isNullOrUndefined(this.dropPosition)&&(this.dropPosition="bottomSegment",c.dropIndex=this.parent.getCurrentViewRecords().length>1?this.parent.getCurrentViewRecords().length-1:c.dropIndex,c.data=c.data.map((function(e){return e.hasChildRecords&&sf.base.isNullOrUndefined(e.parentItem)?(e.level=0,e):(delete e.parentItem,delete e.parentUniqueID,e.level=0,e)}))),this.dropRows(c)}},e.prototype.rowsRemoved=function(e){for(var t=0;t<e.records.length;t++)this.draggedRecord=e.records[t],(this.draggedRecord.hasChildRecords||this.draggedRecord.parentItem&&-1!==this.parent.grid.dataSource.indexOf(this.getChildrecordsByParentID(this.draggedRecord.parentUniqueID)[0])||0===this.draggedRecord.level)&&this.deleteDragRow()},e.prototype.refreshGridDataSource=function(){var e,t,i=this.draggedRecord,r=this.droppedRecord,n=this.parent;if(!(e=this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?n.dataSource.dataSource.json:n.dataSource)||sf.base.isNullOrUndefined(r)||r.parentItem||sf.base.isNullOrUndefined(r.taskData)){if(!this.parent.parentIdMapping&&!sf.base.isNullOrUndefined(r)&&r.parentItem&&("topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition)){var s=this.getChildrecordsByParentID(r.parentUniqueID)[0].childRecords;for(a=0;a<s.length;a++)r.parentItem.taskData[this.parent.childMapping][a]=s[a].taskData}}else{for(var a=0;a<Object.keys(e).length;a++)e[a][this.parent.childMapping]===r.taskData[this.parent.childMapping]&&(t=a);"topSegment"===this.dropPosition?this.parent.idMapping||e.splice(t,0,i.taskData):"bottomSegment"===this.dropPosition&&(this.parent.idMapping||e.splice(t+1,0,i.taskData))}this.parent.parentIdMapping&&(i.parentItem?"topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition?(i[this.parent.parentIdMapping]=r[this.parent.parentIdMapping],i.taskData[this.parent.parentIdMapping]=r[this.parent.parentIdMapping]):(i[this.parent.parentIdMapping]=r[this.parent.idMapping],i.taskData[this.parent.parentIdMapping]=r[this.parent.idMapping]):(i.taskData[this.parent.parentIdMapping]=null,i[this.parent.parentIdMapping]=null))},e.prototype.removeFirstrowBorder=function(e){var t="bottomSegment"===this.dropPosition;this.parent.element.getElementsByClassName("e-firstrow-border").length>0&&e&&(0!==e.rowIndex||t)&&this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove()},e.prototype.removeLastrowBorder=function(e){var t=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow")),i=e&&!t&&this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length-1).getAttribute("data-uid")!==e.getAttribute("data-uid"),r=i||"topSegment"===this.dropPosition;this.parent.element.getElementsByClassName("e-lastrow-border").length>0&&e&&(i||r)&&this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove()},e.prototype.updateIcon=function(e,t,i){var r=i.target?sf.base.closest(i.target,"tr"):null;this.dropPosition=void 0;var n=0;this.removeFirstrowBorder(r),this.removeLastrowBorder(r);for(var s=0;s<i.rows.length;s++)(sf.base.isNullOrUndefined(r)||r.getAttribute("data-uid")!==i.rows[s].getAttribute("data-uid"))&&sf.grids.parentsUntil(i.target,"e-gridcontent")||(this.dropPosition="Invalid",this.addErrorElem());var a,o=this.parent,d=o.toolbar&&o.toolbar.length?document.getElementById(o.element.id+"_gridcontrol_toolbarItems").offsetHeight:0,l=this.getOffset(o.element),p=o.getHeaderContent().offsetHeight+l.top+d,h=o.getContent().firstElementChild.scrollTop;sf.base.isNullOrUndefined(r)||(n=r.offsetTop-h);var c=((a=n+p+0)+e[0].offsetHeight-a)/3,u=a+c,g=u+c,f=g+c,y=sf.grids.getObject("originalEvent.event",i),b=sf.grids.getObject("originalEvent.event",i),m="mousemove"==y.type?y.pageY:sf.base.isNullOrUndefined(b)||sf.base.isNullOrUndefined(b.changedTouches)?null:b.changedTouches[0].pageY,v=m<=u,w=m>u&&m<=g,R=m>g&&m<=f;if(v||w||R){if(v&&"Invalid"!==this.dropPosition&&(this.removeChildBorder(),this.dropPosition="topSegment",this.removetopOrBottomBorder(),this.addFirstrowBorder(r),this.removeErrorElem(),this.removeLastrowBorder(r),this.topOrBottomBorder(i.target)),w&&"Invalid"!==this.dropPosition){this.removetopOrBottomBorder();var C,x=sf.base.closest(i.target,"tr");(C=[].slice.call(x.querySelectorAll(".e-rowcell,.e-rowdragdrop,.e-detailrowcollapse"))).length>0&&this.addRemoveClasses(C,!0,"e-childborder"),this.addLastRowborder(r),this.addFirstrowBorder(r),this.dropPosition="middleSegment"}R&&"Invalid"!==this.dropPosition&&(this.removeErrorElem(),this.removetopOrBottomBorder(),this.removeChildBorder(),this.dropPosition="bottomSegment",this.addLastRowborder(r),this.removeFirstrowBorder(r),this.topOrBottomBorder(i.target))}return this.dropPosition},e.prototype.removeChildBorder=function(){var e;(e=[].slice.call(this.parent.element.querySelectorAll(".e-childborder"))).length>0&&this.addRemoveClasses(e,!1,"e-childborder")},e.prototype.addFirstrowBorder=function(e){var t=this.parent.element,i=this.parent;if(e&&0===e.rowIndex&&!e.classList.contains("e-emptyrow")){var r=this.parent.createElement("div",{className:"e-firstrow-border"}),n=this.parent.getHeaderContent(),s=0;i.toolbar&&(s=i.toolbarModule.getToolbar().offsetHeight);var a=!sf.base.isNullOrUndefined(this.parent.rowDropSettings.targetID);a&&(r.style.top=this.parent.grid.element.getElementsByClassName("e-gridheader")[0].offsetHeight+s+"px"),r.style.width=a?t.offsetWidth+"px":t.offsetWidth-this.getScrollWidth()+"px",n.querySelectorAll(".e-firstrow-border").length||n.appendChild(r)}},e.prototype.addLastRowborder=function(e){var t=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow"));if(e&&!t&&this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length-1).getAttribute("data-uid")===e.getAttribute("data-uid")){var i=this.parent.createElement("div",{className:"e-lastrow-border"}),r=this.parent.getContent();i.style.width=this.parent.element.offsetWidth-this.getScrollWidth()+"px",r.querySelectorAll(".e-lastrow-border").length||(r.classList.add("e-treegrid-relative"),r.appendChild(i),i.style.bottom=this.getScrollWidth()+"px")}},e.prototype.getScrollWidth=function(){var e=this.parent.getContent().firstElementChild;return e.scrollWidth>e.offsetWidth?sf.grids.Scroll.getScrollBarWidth():0},e.prototype.addErrorElem=function(){var e=document.getElementsByClassName("e-cloneproperties")[0];if(!e.querySelectorAll(".e-errorelem").length&&!this.parent.rowDropSettings.targetID){var t=document.createElement("div");sf.base.classList(t,["e-errorcontainer"],[]),sf.base.classList(t,["e-icons","e-errorelem"],[]);var i=e.querySelector(".errorValue"),r=e.querySelector(".e-rowcell").innerHTML;i&&(r=i.innerHTML,i.parentNode.removeChild(i)),e.querySelector(".e-rowcell").innerHTML="";var n=document.createElement("span");n.className="errorValue",n.style.paddingLeft="16px",n.innerHTML=r,e.querySelector(".e-rowcell").appendChild(t),e.querySelector(".e-rowcell").appendChild(n)}},e.prototype.removeErrorElem=function(){var e=document.querySelector(".e-errorelem");e&&e.remove()},e.prototype.topOrBottomBorder=function(e){var t,i=sf.base.closest(e,"tr");(t=i?[].slice.call(i.querySelectorAll(".e-rowcell,.e-rowdragdrop,.e-detailrowcollapse")):[]).length&&("topSegment"===this.dropPosition&&(this.addRemoveClasses(t,!0,"e-droptop"),this.parent.element.getElementsByClassName("e-lastrow-dragborder").length>0&&this.parent.element.getElementsByClassName("e-lastrow-dragborder")[0].remove()),"bottomSegment"===this.dropPosition&&this.addRemoveClasses(t,!0,"e-dropbottom"))},e.prototype.removetopOrBottomBorder=function(){var e;(e=[].slice.call(this.parent.element.querySelectorAll(".e-dropbottom, .e-droptop"))).length&&(this.addRemoveClasses(e,!1,"e-dropbottom"),this.addRemoveClasses(e,!1,"e-droptop"))},e.prototype.addRemoveClasses=function(e,t,i){for(var r=0,n=e.length;r<n;r++)t?e[r].classList.add(i):e[r].classList.remove(i)},e.prototype.getOffset=function(e){var t=e.getBoundingClientRect(),i=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||i.scrollTop,s=window.pageXOffset||r.scrollLeft||i.scrollLeft,a=r.clientTop||i.clientTop||0,o=r.clientLeft||i.clientLeft||0,d=t.top+n-a,l=t.left+s-o;return{top:Math.round(d),left:Math.round(l)}},e.prototype.Rowdraging=function(e){var t=this.parent,i=this.parent.element.querySelector(".e-cloneproperties");i.style.cursor="";var r,n=e.target?sf.base.closest(e.target,"tr"):null,s=n?n.rowIndex:-1,a=[],o=t.getCurrentViewRecords()[s];(this.removeErrorElem(),this.canDrop=!0,e.data[0]?a=e.data:a.push(e.data),-1!==s?this.ensuredropPosition(a,o):(this.canDrop=!1,this.addErrorElem()),!t.rowDropSettings.targetID&&this.canDrop&&t.rowDragAndDropModule.updateIcon(e.rows,s,e),t.rowDropSettings.targetID)&&((r=sf.grids.parentsUntil(e.target,"e-treegrid"))&&r.id===this.parent.rowDropSettings.targetID&&r.ej2_instances[0].rowDragAndDropModule.updateIcon(e.rows,s,e));e.target&&sf.base.closest(e.target,"#"+t.rowDropSettings.targetID)&&((r=sf.grids.parentsUntil(e.target,"e-treegrid"))||(i.style.cursor="default"))},e.prototype.rowDropped=function(e){var t=this.parent;if(t.rowDropSettings.targetID?(e.target&&sf.base.closest(e.target,"#"+t.rowDropSettings.targetID)||sf.grids.parentsUntil(e.target,"e-treegrid")&&sf.grids.parentsUntil(e.target,"e-treegrid").id===t.rowDropSettings.targetID)&&(sf.base.setValue("dropPosition",this.dropPosition,e),t.trigger("rowDrop",e),!e.cancel&&t.rowDropSettings.targetID&&(this.dragDropGrid(e),t.isLocalData&&(t.flatData=this.orderToIndex(t.flatData)))):sf.grids.parentsUntil(e.target,"e-content")&&(this.parent.element.querySelector(".e-errorelem")&&(this.dropPosition="Invalid"),sf.base.setValue("dropPosition",this.dropPosition,e),e.dropIndex=e.dropIndex===e.fromIndex?this.getTargetIdx(e.target.parentElement):e.dropIndex,t.trigger("rowDrop",e),e.cancel||(x(this.parent)||this.dropRows(e),t.isLocalData&&(t.flatData=this.orderToIndex(t.flatData)),t.grid.refresh(),sf.base.isNullOrUndefined(t.getHeaderContent().querySelector(".e-firstrow-border"))||t.getHeaderContent().querySelector(".e-firstrow-border").remove())),this.removetopOrBottomBorder(),this.removeChildBorder(),sf.base.isNullOrUndefined(this.parent.element.getElementsByClassName("e-firstrow-border")[0])?sf.base.isNullOrUndefined(this.parent.element.getElementsByClassName("e-lastrow-border")[0])||this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove():this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove(),this.parent.enableImmutableMode&&!this.parent.allowPaging&&!sf.base.isNullOrUndefined(e.data[0].parentItem)){var i=this.parent.treeColumnIndex;i+=1;var r=this.parent.getPrimaryKeyFieldNames()[0],n=this.parent.grid.getRowIndexByPrimaryKey(e.data[0][r]),s=this.parent.getRows()[n],a=e.data[0];if("middleSegment"===this.dropPosition){var o=[],d=[];o.push(a),d.push(s);a=k(this.parent,e.data[0].parentUniqueID),n=this.parent.grid.getRowIndexByPrimaryKey(a[r]);var l=this.parent.getRows()[n];o.push(a),d.push(l);for(var p=0;p<o.length;p++)this.parent.renderModule.cellRender({data:o[p],cell:d[p].cells[i],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex],requestType:"rowDragAndDrop"});var h=l.getElementsByClassName("e-treegridcollapse")[0];sf.base.isNullOrUndefined(h)||(sf.base.removeClass([h],"e-treegridcollapse"),sf.base.addClass([h],"e-treegridexpand"))}else this.parent.renderModule.cellRender({data:a,cell:s.cells[i],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex],requestType:"rowDragAndDrop"})}},e.prototype.dragDropGrid=function(e){var t,i=this.parent,r=sf.base.closest(e.target,"tr"),n=isNaN(this.getTargetIdx(r))?0:this.getTargetIdx(r),s=sf.grids.parentsUntil(e.target,"e-treegrid");if(s&&s.id===this.parent.rowDropSettings.targetID&&!C(this.parent)&&!x(this.parent)){t=s.ej2_instances[0];for(var a=i.getSelectedRecords(),o=[],d=0;d<a.length;d++)o[d]=a[d].index;var l=t.dataSource;if(null!=this.parent.idMapping&&(sf.base.isNullOrUndefined(this.dropPosition)||"bottomSegment"===this.dropPosition||"Invalid"===this.dropPosition)&&!l.length){var p=[];for(d=0;d<a.length;d++)if(a[d].hasChildRecords){p.push(a[d]);for(var h=O(a[d]),c=0;c<h.length;c++)p.push(h[c])}p.length&&(a=p)}i.notify("rows-remove",{indexes:o,records:a}),t.notify("rows-add",{toIndex:n,records:a});var u=t.rowDragAndDropModule.treeGridData;if(!sf.base.isNullOrUndefined(u))for(d=0;d<u.length;d++)if(u[d].index=d,!sf.base.isNullOrUndefined(u[d].parentItem)){var g=sf.base.getValue("uniqueIDCollection."+u[d].parentUniqueID+".index",t);u[d].parentItem.index=g}i.grid.refresh(),t.grid.refresh(),t.grid.dataSource.length>1&&(t.grid.refresh(),sf.base.isNullOrUndefined(t.getHeaderContent().querySelector(".e-firstrow-border"))||t.getHeaderContent().querySelector(".e-firstrow-border").remove(),sf.base.isNullOrUndefined(t.getContent().querySelector(".e-lastrow-border"))||t.getContent().querySelector(".e-lastrow-border").remove())}x(this.parent)&&(t=s.ej2_instances[0],i.grid.refresh(),t.grid.refresh())},e.prototype.getTargetIdx=function(e){return e?parseInt(e.getAttribute("aria-rowindex"),10):0},e.prototype.getParentData=function(e){var t=e.parentItem;if("bottomSegment"===this.dropPosition){var i=this.parent.getSelectedRecords()[0];this.droppedRecord=k(this.parent,i.parentItem.uniqueID)}"middleSegment"===this.dropPosition&&(this.parent.getSelectedRecords()[0].level===t.level?this.droppedRecord=k(this.parent,t.uniqueID):this.getParentData(t))},e.prototype.dropRows=function(e,t){if("Invalid"!==this.dropPosition&&!C(this.parent)){var i=this.parent,r=void 0,n=void 0;if(sf.base.isNullOrUndefined(e.dropIndex)){var s=i.getSelectedRowIndexes()[0]-1,a=i.getCurrentViewRecords()[s];this.getParentData(a)}else e.dropIndex=e.dropIndex===e.fromIndex?this.getTargetIdx(e.target.parentElement):e.dropIndex,this.droppedRecord=i.getCurrentViewRecords()[e.dropIndex];var o=[];n=this.droppedRecord,e.data[0]?o=e.data:o.push(e.data);var d=0,l=this.parent.rowDropSettings.targetID;this.isMultipleGrid=l,l?this.isaddtoBottom=l&&this.isDraggedWithChild:this.ensuredropPosition(o,n);var p=o.length;sf.base.isNullOrUndefined(this.parent.idMapping)||o.reverse();for(var h=0;h<p;h++){if(r=o[h],this.draggedRecord=r,"Invalid"!==this.dropPosition){if(i.rowDropSettings.targetID&&!t||this.deleteDragRow(),this.draggedRecord===this.droppedRecord){var c=this.getTargetIdx(e.target.offsetParent.parentElement);isNaN(c)&&(c=this.getTargetIdx(e.target.parentElement)),e.dropIndex=c,n=this.droppedRecord=this.parent.getCurrentViewRecords()[e.dropIndex]}var u=this.treeGridData.indexOf(n);if(this.dropAtTop(u),"bottomSegment"===this.dropPosition){if(n.hasChildRecords?(d=this.getChildCount(n,0),this.parent.parentIdMapping&&this.treeData.splice(u+d+1,0,this.draggedRecord.taskData),this.treeGridData.splice(u+d+1,0,this.draggedRecord)):(this.parent.parentIdMapping&&this.treeData.splice(u+1,0,this.draggedRecord.taskData),this.treeGridData.splice(u+1,0,this.draggedRecord)),sf.base.isNullOrUndefined(n.parentItem)&&(delete r.parentItem,r.level=0,this.parent.parentIdMapping&&(r[this.parent.parentIdMapping]=null)),n.parentItem){var g=this.getChildrecordsByParentID(n.parentUniqueID)[0].childRecords,f=g.indexOf(n)+1;g.splice(f,0,r),r.parentItem=n.parentItem,r.parentUniqueID=n.parentUniqueID,this.parent.parentIdMapping&&(r[this.parent.parentIdMapping]=n[this.parent.parentIdMapping],r.parentItem=n.parentItem,r.level=n.level)}if(r.hasChildRecords){this.updateChildRecordLevel(r,1),this.updateChildRecord(r,u+d+1)}}this.dropMiddle(u)}if(sf.base.isNullOrUndefined(r.parentItem)){var y=i.parentData,b=y.indexOf(this.droppedRecord);"bottomSegment"===this.dropPosition?y.splice(b+1,0,r):"topSegment"===this.dropPosition&&y.splice(b,0,r)}i.rowDragAndDropModule.refreshGridDataSource()}}},e.prototype.dropMiddle=function(e){var t=this.parent,i=O(this.droppedRecord),r=sf.base.isNullOrUndefined(i)||0===i.length?e+1:i.length+e+1;"middleSegment"===this.dropPosition&&(t.parentIdMapping?(this.treeData.splice(r,0,this.draggedRecord.taskData),this.treeGridData.splice(r,0,this.draggedRecord)):this.treeGridData.splice(r,0,this.draggedRecord),this.recordLevel(),this.draggedRecord.hasChildRecords&&this.updateChildRecord(this.draggedRecord,r))},e.prototype.dropAtTop=function(e){var t=this.parent;if("topSegment"===this.dropPosition){if(t.parentIdMapping&&this.treeData.splice(e,0,this.draggedRecord.taskData),this.draggedRecord.parentItem=this.treeGridData[e].parentItem,this.draggedRecord.parentUniqueID=this.treeGridData[e].parentUniqueID,this.draggedRecord.level=this.treeGridData[e].level,this.treeGridData.splice(e,0,this.draggedRecord),this.draggedRecord.hasChildRecords){this.updateChildRecord(this.draggedRecord,e),this.updateChildRecordLevel(this.draggedRecord,1)}if(this.droppedRecord.parentItem){var i=this.getChildrecordsByParentID(this.droppedRecord.parentUniqueID)[0].childRecords,r=i.indexOf(this.droppedRecord);i.splice(r,0,this.draggedRecord)}}},e.prototype.recordLevel=function(){var e=this.parent,t=this.draggedRecord,i=this.droppedRecord,r=e.childMapping;if(i.hasChildRecords||(i.hasChildRecords=!0,i.hasFilteredChildRecords=!0,(sf.base.isNullOrUndefined(i.childRecords)||0===i.childRecords.length)&&(i.childRecords=[],!e.parentIdMapping&&sf.base.isNullOrUndefined(i.taskData[r])&&(i.taskData[r]=[]))),"middleSegment"===this.dropPosition){var n=sf.base.extend({},i);if(delete n.childRecords,t.parentItem=n,t.parentUniqueID=i.uniqueID,i.childRecords.splice(i.childRecords.length,0,t),sf.base.isNullOrUndefined(t)||e.parentIdMapping||sf.base.isNullOrUndefined(i.taskData[r])||i.taskData[e.childMapping].splice(i.childRecords.length,0,t.taskData),t.hasChildRecords){t.level=i.level+1,this.updateChildRecordLevel(t,1)}else t.level=i.level+1;i.expanded=!0}},e.prototype.deleteDragRow=function(){this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?(this.treeGridData=this.parent.grid.dataSource.dataSource.json,this.treeData=this.parent.dataSource.dataSource.json):(this.treeGridData=this.parent.grid.dataSource,this.treeData=this.parent.dataSource);var e=k(this.parent,this.draggedRecord.uniqueID);!sf.base.isNullOrUndefined(e.childRecords)&&e.childRecords.length&&(e.hasChildRecords=!0),this.removeRecords(e)},e.prototype.updateChildRecord=function(e,t){var i,r,n=this.parent;if(!e.hasChildRecords)return 0;r=e.childRecords.length;for(var s=0;s<r;s++)i=e.childRecords[s],t++,n.flatData.splice(t,0,i),sf.base.setValue("uniqueIDCollection."+i.uniqueID,i,this.parent),n.parentIdMapping&&this.treeData.splice(t,0,i.taskData),i.hasChildRecords&&(t=this.updateChildRecord(i,t));return t},e.prototype.updateChildRecordLevel=function(e,t){var i,r;if(t++,!e.hasChildRecords)return 0;i=e.childRecords.length;for(var n=0;n<i;n++){r=e.childRecords[n];var s=void 0;e.parentItem&&(s=k(this.parent,e.parentItem.uniqueID)),sf.base.isNullOrUndefined(s)&&!sf.base.isNullOrUndefined(e.parentItem)&&(s=e.parentItem),r.level=e.parentItem?s.level+t:e.level+1,r.hasChildRecords&&(t--,t=this.updateChildRecordLevel(r,t))}return t},e.prototype.removeRecords=function(e){var t,i=this.parent;t=this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource;var r=e,n=!sf.base.isNullOrUndefined(i.parentIdMapping),s=this.getChildrecordsByParentID(r.parentUniqueID)[0];if(r){if(r.parentItem){var a=s?s.childRecords:[],o=0;a&&a.length>0&&(o=a.indexOf(r),s.childRecords.splice(o,1),this.parent.parentIdMapping||ce({value:r,action:"delete"},this.parent,n,r.index,r.index))}if(i.parentIdMapping){r.hasChildRecords&&r.childRecords.length>0&&this.removeChildItem(r);for(var d=void 0,l=void 0,p=t,h=0;h<p.length;h++)p[h][this.parent.idMapping]===r.taskData[this.parent.idMapping]&&(d=h);for(h=0;h<this.treeGridData.length;h++)this.treeGridData[h][this.parent.idMapping]===r.taskData[this.parent.idMapping]&&(l=h);-1===d||sf.base.isNullOrUndefined(d)||t.splice(d,1),-1===l||sf.base.isNullOrUndefined(l)||this.treeGridData.splice(l,1)}var c=this.treeGridData.indexOf(r);if(!i.parentIdMapping){var u=this.parent.parentData.indexOf(r);-1!==u&&(i.parentData.splice(u,1),t.splice(u,1))}if(-1===c&&!i.parentIdMapping)for(var g=i.getPrimaryKeyFieldNames()[0],f=0;f<this.treeGridData.length;f++)this.treeGridData[f][g]===r[g]&&(c=f);if(!i.parentIdMapping){var y=this.getChildCount(r,0);this.treeGridData.splice(c,y+1)}r.parentItem&&s&&s.childRecords&&!s.childRecords.length&&(s.expanded=!1,s.hasChildRecords=!1,s.hasFilteredChildRecords=!1)}},e.prototype.removeChildItem=function(e){var t,i,r,n;n=this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource;for(var s=0;s<e.childRecords.length;s++){t=e.childRecords[s],!sf.base.isNullOrUndefined(t.childRecords)&&t.childRecords.length&&(t.hasChildRecords=!0);var a=void 0;a=this.parent.dataSource instanceof sf.data.DataManager&&P(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource;for(var o=0;o<a.length;o++)a[o][this.parent.idMapping]===t.taskData[this.parent.idMapping]&&(i=o);for(var d=0;d<this.treeGridData.length;d++)if(this.treeGridData[d][this.parent.idMapping]===t.taskData[this.parent.idMapping]){r=d;break}-1===i||sf.base.isNullOrUndefined(i)||n.splice(i,1),-1===r||sf.base.isNullOrUndefined(r)||this.treeGridData.splice(r,1),t.hasChildRecords&&this.removeChildItem(t)}},e.prototype.getChildCount=function(e,t){var i;if(!e.hasChildRecords)return 0;for(var r=0;r<e.childRecords.length;r++)t++,(i=e.childRecords[r]).hasChildRecords&&(t=this.getChildCount(i,t));return t},e.prototype.ensuredropPosition=function(e,t){var i=this;e.filter((function(e){if(e.hasChildRecords&&!sf.base.isNullOrUndefined(e.childRecords)){if(-1!==e.childRecords.indexOf(t))return i.dropPosition="Invalid",i.addErrorElem(),void(i.canDrop=!1);i.ensuredropPosition(e.childRecords,t)}}))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("row-draging",this.Rowdraging),this.parent.off("row-dropped",this.rowDropped),this.parent.off("rows-add",this.rowsAdded),this.parent.off("rows-remove",this.rowsRemoved))},e.prototype.getModuleName=function(){return"rowDragAndDrop"},e}(),Ee=(be=function(e,t){return(be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}be(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ae=function(e,t,r,n){var s,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ee(t,e),Ae([sf.base.Property()],t.prototype,"targetID",void 0),t}(sf.base.ChildProperty),Ne=(me=function(e,t){return(me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}me(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),qe=function(e){function t(t){var i=e.call(this,t)||this;return i.addEventListener(),i}return Ne(t,e),t.prototype.addEventListener=function(){this.parent.on("data-listener",this.getDatas,this)},t.prototype.getDatas=function(e){this.visualData=e.data},t.prototype.generateRows=function(t,i){if(this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||x(this.parent))return e.prototype.generateRows.call(this,t,i);sf.base.isNullOrUndefined(i.requestType)||"collapseAll"!==i.requestType.toString()||(i.requestType="refresh");for(var r=e.prototype.generateRows.call(this,t,i),n=0;n<r.length;n++)r[n].index=this.visualData.indexOf(r[n].data);return r},t.prototype.checkAndResetCache=function(e){var t=["paging","refresh","sorting","filtering","searching","reorder","save","delete"].some((function(t){return e===t}));if(this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||x(this.parent)){var i=this.model.currentPage;t?(this.cache={},this.data={},this.groups={}):"virtualscroll"===e&&this.cache[i]&&this.cache[i].length>this.parent.contentModule.getBlockSize()&&delete this.cache[i]}else(t||"virtualscroll"===e)&&(this.cache={},this.data={},this.groups={});return t},t}(sf.grids.VirtualRowModelGenerator),Ue=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Filter),this.parent=e,this.isHierarchyFilter=!1,this.filteredResult=[],this.flatFilteredData=[],this.filteredParentRecs=[],this.addEventListener()}return e.prototype.getModuleName=function(){return"filter"},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.addEventListener=function(){this.parent.on("updateFilterRecs",this.updatedFilteredRecord,this),this.parent.on("clearFilters",this.clearFilterLevel,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateFilterRecs",this.updatedFilteredRecord),this.parent.off("clearFilters",this.clearFilterLevel))},e.prototype.updatedFilteredRecord=function(e){sf.base.setValue("uniqueIDFilterCollection",{},this.parent),this.flatFilteredData=e.data,this.filteredParentRecs=[],this.filteredResult=[],this.isHierarchyFilter=!1;for(var t=0;t<this.flatFilteredData.length;t++){var i=this.flatFilteredData[t];this.addParentRecord(i);var r=""===this.parent.grid.searchSettings.key?this.parent.filterSettings.hierarchyMode:this.parent.searchSettings.hierarchyMode;"Child"!==r&&"None"!==r||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key||(this.isHierarchyFilter=!0);var n=sf.grids.getObject("childRecords",i);!sf.base.isNullOrUndefined(n)&&n.length&&sf.base.setValue("hasFilteredChildRecords",this.checkChildExsist(i),i);var s=sf.grids.getObject("parentItem",i);if(!sf.base.isNullOrUndefined(s)){var a=k(this.parent,i.parentItem.uniqueID,!0);sf.base.setValue("hasFilteredChildRecords",!0,a),a&&a.parentItem&&this.updateParentFilteredRecord(a)}}this.flatFilteredData.length>0&&this.isHierarchyFilter&&this.updateFilterLevel(),this.parent.notify("updateAction",{result:this.filteredResult})},e.prototype.updateParentFilteredRecord=function(e){var t=k(this.parent,e.parentItem.uniqueID,!0),i=sf.base.getValue("uniqueIDFilterCollection",this.parent);t&&Object.prototype.hasOwnProperty.call(i,t.uniqueID)&&sf.base.setValue("hasFilteredChildRecords",!0,t),t&&t.parentItem&&this.updateParentFilteredRecord(t)},e.prototype.addParentRecord=function(e){var t=k(this.parent,e.parentUniqueID);if("None"!==(""===this.parent.grid.searchSettings.key?this.parent.filterSettings.hierarchyMode:this.parent.searchSettings.hierarchyMode)||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key){if(!sf.base.isNullOrUndefined(t))("Child"!==(""===this.parent.grid.searchSettings.key?this.parent.filterSettings.hierarchyMode:this.parent.searchSettings.hierarchyMode)||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key||-1!==this.flatFilteredData.indexOf(t))&&this.addParentRecord(t);-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),sf.base.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent))}else if(sf.base.isNullOrUndefined(t)){if(-1!==this.flatFilteredData.indexOf(e))return void(-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),sf.base.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent),e.hasFilteredChildRecords=!0))}else this.addParentRecord(t),-1!==this.flatFilteredData.indexOf(t)||-1!==this.filteredResult.indexOf(t)?-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),sf.base.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent)):-1===this.filteredResult.indexOf(e)&&-1!==this.flatFilteredData.indexOf(e)&&(this.filteredResult.push(e),sf.base.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent))},e.prototype.checkChildExsist=function(e){for(var t=sf.grids.getObject("childRecords",e),i=!1,r=0;r<t.length;r++){var n=t[r].childRecords,s=""===this.parent.grid.searchSettings.key?this.parent.filterSettings.hierarchyMode:this.parent.searchSettings.hierarchyMode;if(!("Child"!==s&&"Both"!==s||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key)){var a=sf.base.getValue("uniqueIDFilterCollection",this.parent);Object.prototype.hasOwnProperty.call(a,t[r].uniqueID)||(this.filteredResult.push(t[r]),sf.base.setValue("uniqueIDFilterCollection."+t[r].uniqueID,t[r],this.parent),i=!0)}if("None"===s&&(0!==this.parent.grid.filterSettings.columns.length||""!==this.parent.grid.searchSettings.key)&&-1!==this.flatFilteredData.indexOf(t[r])){i=!0;break}!sf.base.isNullOrUndefined(n)&&n.length&&(i=this.checkChildExsist(t[r])),"Child"!==s&&"Both"!==s||!t.length||(i=!0)}return i},e.prototype.updateFilterLevel=function(){for(var e=this.filteredResult,t=this.filteredResult.length,i=0;i<t;i++){var r=k(this.parent,e[i].parentUniqueID);if(-1!==e.indexOf(r)){var n=k(this.parent,e[i].parentUniqueID,!0);e[i].filterLevel=n.filterLevel+1}else e[i].filterLevel=0,this.filteredParentRecs.push(e[i])}},e.prototype.clearFilterLevel=function(e){for(var t,i=0,r=e.flatData,n=r.length;i<n;i++){var s=(t=r[i]).filterLevel;!s&&0!==s&&sf.base.isNullOrUndefined(t.hasFilteredChildRecords)||(t.hasFilteredChildRecords=null,t.filterLevel=null)}this.filteredResult=[],this.parent.notify("updateResults",{result:r,count:r.length})},e}(),Be=function(){function e(e){this.isCollapsedStatePersist=!1,sf.grids.Grid.Inject(sf.grids.ExcelExport),this.parent=e,this.dataResults={},this.addEventListener()}return e.prototype.getModuleName=function(){return"ExcelExport"},e.prototype.addEventListener=function(){this.parent.on("updateResults",this.updateExcelResultModel,this),this.parent.on("excelCellInfo",this.excelQueryCellInfo,this),this.parent.grid.on("export-RowDataBound",this.exportRowDataBound,this),this.parent.grid.on("finalPageSetup",this.finalPageSetup,this)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateResults",this.updateExcelResultModel),this.parent.off("excelCellInfo",this.excelQueryCellInfo),this.parent.grid.off("export-RowDataBound",this.exportRowDataBound),this.parent.grid.off("finalPageSetup",this.finalPageSetup))},e.prototype.updateExcelResultModel=function(e){this.dataResults=e},e.prototype.Map=function(e,t,i,r,n){var s=this,a=this.parent.dataSource,o=Object();return sf.base.setValue("isCsv",n,o),sf.base.setValue("cancel",!1,o),sf.base.isNullOrUndefined(e)||(this.isCollapsedStatePersist=e.isCollapsedStatePersist),new Promise((function(d){var l=!s.isLocal()||a instanceof sf.data.DataManager?s.parent.dataSource:new sf.data.DataManager(a),p=new sf.data.Query;if(s.isLocal()||(p=s.generateQuery(p),sf.base.setValue("query",p,o)),s.parent.trigger("beforeExcelExport",sf.base.extend(o,e)),sf.grids.getObject("cancel",o))return null;l.executeQuery(p).then((function(o){var l=null;return sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.dataSource)||(l=e.dataSource),e=s.manipulateExportProperties(e,a,o),s.parent.grid.excelExportModule.Map(s.parent.grid,e,t,i,n,r).then((function(t){null!=l?e.dataSource=l:delete e.dataSource,d(t)}))}))}))},e.prototype.generateQuery=function(e,t){return!sf.base.isNullOrUndefined(t)&&"CurrentPage"===t.exportType&&this.parent.allowPaging&&(t.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=sf.grids.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},e.prototype.manipulateExportProperties=function(e,t,i){var r=Object();if(sf.base.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),r),sf.base.setValue("isExport",!0,r),sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.exportType)||sf.base.setValue("exportType",e.exportType,r),this.isLocal()||(this.parent.parentData=[],this.parent.dataModule.convertToFlatData(sf.grids.getObject("result",i)),sf.base.setValue("expresults",this.parent.flatData,r)),this.parent.notify("dataProcessor",r),r=this.dataResults,t=sf.base.isNullOrUndefined(r.result)?this.parent.flatData.slice(0):r.result,this.isLocal()||(this.parent.flatData=[]),e&&e.dataSource&&this.isLocal()){var n=this.parent.flatData,s=e.dataSource instanceof sf.data.DataManager?e.dataSource.dataSource.json:e.dataSource;this.parent.dataModule.convertToFlatData(s),t=this.parent.flatData,this.parent.flatData=n}return(e=sf.base.isNullOrUndefined(e)?Object():e).dataSource=new sf.data.DataManager({json:t}),e},e.prototype.excelQueryCellInfo=function(e){if(this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex){var t={},i=e.data,r=sf.base.isNullOrUndefined(i.filterLevel)?i.level:i.filterLevel;t.indent=r,e.style=t}this.parent.notify("updateResults",e),this.parent.trigger("excelQueryCellInfo",e)},e.prototype.exportRowDataBound=function(e){if("excel"===e.type){var t=e.rowObj.data,i=this.parent.grid.filterSettings.columns.length;if(t.parentItem&&k(this.parent,t.parentItem.uniqueID,Boolean(i))){var r=e.excelRows.length,n=t.level,s=!1,a=!1,o=M(this.parent,t,this.parent.parentData);!this.isCollapsedStatePersist||o&&this.parent.isLocalData||(s=!0,a=!t.expanded),e.excelRows[r-1].grouping={outlineLevel:n,isCollapsed:a,isHidden:s}}}},e.prototype.finalPageSetup=function(e){for(var t=0;t<e.worksheets.length;t++)e.worksheets[t].rows&&(e.worksheets[t].pageSetup={isSummaryRowBelow:!1})},e.prototype.isLocal=function(){return!C(this.parent)&&P(this.parent)},e}(),Te=function(){function e(e){sf.grids.Grid.Inject(sf.grids.PdfExport),this.parent=e,this.dataResults={},this.addEventListener()}return e.prototype.getModuleName=function(){return"PdfExport"},e.prototype.addEventListener=function(){this.parent.on("pdfCellInfo",this.pdfQueryCellInfo,this),this.parent.on("updateResults",this.updatePdfResultModel,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("pdfCellInfo",this.pdfQueryCellInfo),this.parent.off("updateResults",this.updatePdfResultModel))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.updatePdfResultModel=function(e){this.dataResults=e},e.prototype.Map=function(e,t,i,r){var n=this,s=this.parent.dataSource,a=Object(),o=!C(this.parent)&&P(this.parent);return sf.base.setValue("cancel",!1,a),new Promise((function(d){var l=!o||s instanceof sf.data.DataManager?n.parent.dataSource:new sf.data.DataManager(s),p=new sf.data.Query;if(o||(p=n.generateQuery(p),sf.base.setValue("query",p,a)),n.parent.trigger("beforePdfExport",sf.base.extend(a,e)),sf.grids.getObject("cancel",a))return null;l.executeQuery(p).then((function(a){var o=null;return sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.dataSource)||(o=e.dataSource),e=n.manipulatePdfProperties(e,s,a),n.parent.grid.pdfExportModule.Map(n.parent.grid,e,t,i,r).then((function(t){null!=o?e.dataSource=o:delete e.dataSource,d(t)}))}))}))},e.prototype.generateQuery=function(e,t){return!sf.base.isNullOrUndefined(t)&&"CurrentPage"===t.exportType&&this.parent.allowPaging&&(t.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=sf.grids.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},e.prototype.manipulatePdfProperties=function(e,t,i){var r={},n=!C(this.parent)&&P(this.parent);if(sf.base.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),r),sf.base.setValue("isExport",!0,r),sf.base.setValue("isPdfExport",!0,r),sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.isCollapsedStatePersist)||sf.base.setValue("isCollapsedStatePersist",e.isCollapsedStatePersist,r),sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.exportType)||sf.base.setValue("exportType",e.exportType,r),n||(this.parent.parentData=[],this.parent.dataModule.convertToFlatData(sf.base.getValue("result",i)),sf.base.setValue("expresults",this.parent.flatData,r)),this.parent.notify("dataProcessor",r),r=this.dataResults,t=sf.base.isNullOrUndefined(r.result)?this.parent.flatData.slice(0):r.result,n||(this.parent.flatData=[]),e&&e.dataSource&&n){var s=this.parent.flatData,a=e.dataSource instanceof sf.data.DataManager?e.dataSource.dataSource.json:e.dataSource;this.parent.dataModule.convertToFlatData(a),t=this.parent.flatData,this.parent.flatData=s}return(e=sf.base.isNullOrUndefined(e)?{}:e).dataSource=new sf.data.DataManager({json:t}),e},e.prototype.pdfQueryCellInfo=function(e){if(this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex){var t={},i=sf.grids.getObject("data",e),r=sf.base.isNullOrUndefined(i.filterLevel)?i.level:i.filterLevel;t.paragraphIndent=3*r,e.style=t}this.parent.notify("updateResults",e),this.parent.trigger("pdfQueryCellInfo",e)},e}(),Le=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Page),this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("localPagedExpandCollapse",this.collapseExpandPagedchilds,this),this.parent.on("pagingActions",this.pageAction,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("localPagedExpandCollapse",this.collapseExpandPagedchilds),this.parent.off("pagingActions",this.pageAction))},e.prototype.getModuleName=function(){return"pager"},e.prototype.refresh=function(){this.parent.grid.pagerModule.refresh()},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.goToPage=function(e){this.parent.grid.pagerModule.goToPage(e)},e.prototype.updateExternalMessage=function(e){this.parent.grid.pagerModule.updateExternalMessage(e)},e.prototype.collapseExpandPagedchilds=function(e){if(e.record.expanded="collapse"!==e.action,this.parent.enableImmutableMode){var t=this.parent.getPrimaryKeyFieldNames()[0],i=this.parent.flatData.filter((function(i){return i[t]===e.record[t]}));i.length&&(i[0].expanded=e.record.expanded)}var r={result:this.parent.flatData,row:e.row,action:e.action,record:e.record,count:this.parent.flatData.length};if(sf.base.getValue("grid.renderModule",this.parent).dataManagerSuccess(r),this.parent.enableImmutableMode){var n=void 0;"collapse"===r.action?(n=r.row.getElementsByClassName("e-treegridexpand")[0],sf.base.isNullOrUndefined(n)||(sf.base.removeClass([n],"e-treegridexpand"),sf.base.addClass([n],"e-treegridcollapse"))):"expand"===r.action&&(n=r.row.getElementsByClassName("e-treegridcollapse")[0],sf.base.isNullOrUndefined(n)||(sf.base.removeClass([n],"e-treegridcollapse"),sf.base.addClass([n],"e-treegridexpand")))}},e.prototype.pageRoot=function(e,t,i){for(var r=sf.base.isNullOrUndefined(i)?[]:i,n=function(i){r.push(t[i]);var n=[];t[i].hasChildRecords&&(n=e.filter((function(e){return t[i].uniqueID===e.parentUniqueID})),r=s.pageRoot(e,n,r))},s=this,a=0;a<t.length;a++)n(a);return r},e.prototype.pageAction=function(e){var t=this,i=new sf.data.DataManager(e.result);if("Root"===this.parent.pageSettings.pageSizeMode){var r=[],n=this.parent.grid.filterSettings.columns.length>0&&("Child"===this.parent.filterSettings.hierarchyMode||"None"===this.parent.filterSettings.hierarchyMode)?"filterLevel":"level",s=(new sf.data.Query).where(n,"equal",0);r=i.executeLocal(s),e.count=r.length;var a=(c=this.parent.grid.pageSettings.pageSize)*((u=this.parent.grid.pageSettings.currentPage)-1);s=s.skip(a).take(c),r=i.executeLocal(s);var o=this.pageRoot(e.result,r);e.result=o}else{var d=new sf.data.DataManager(e.result),l=new sf.data.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),p=d.executeLocal((new sf.data.Query).where(l)),h=void 0;h=!I(this.parent)||this.parent.searchSettings.key===this.parent.grid.searchSettings.key&&this.parent.filterSettings.columns.length===this.parent.grid.filterSettings.columns.length?p.filter((function(e){return M(t.parent,e,p)})):p,e.count=h.length;s=new sf.data.Query;var c=this.parent.grid.pageSettings.pageSize,u=this.parent.grid.pageSettings.currentPage;h.length<u*c&&(u=(u=Math.floor(h.length/c)+(h.length%c?1:0))||1,this.parent.grid.setProperties({pageSettings:{currentPage:u}},!0));a=c*(u-1);s=s.skip(a).take(c),d.dataSource.json=h,e.result=d.executeLocal(s)}this.parent.notify("updateAction",e)},e}(),Ve=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Toolbar),this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"toolbar"},e.prototype.addEventListener=function(){this.parent.on("rowSelected",this.refreshToolbar,this),this.parent.on("toolbarClick",this.toolbarClickHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("rowSelected",this.refreshToolbar),this.parent.off("toolbarClick",this.toolbarClickHandler))},e.prototype.refreshToolbar=function(e){var t=this.parent;0===e.row.rowIndex||t.getSelectedRecords().length>1?this.enableItems([t.element.id+"_gridcontrol_indent",t.element.id+"_gridcontrol_outdent"],!1):sf.base.isNullOrUndefined(t.getCurrentViewRecords()[e.row.rowIndex])||(!sf.base.isNullOrUndefined(t.getCurrentViewRecords()[e.row.rowIndex])&&t.getCurrentViewRecords()[e.row.rowIndex].level>t.getCurrentViewRecords()[e.row.rowIndex-1].level?this.enableItems([t.element.id+"_gridcontrol_indent"],!1):this.enableItems([t.element.id+"_gridcontrol_indent"],!0),t.getCurrentViewRecords()[e.row.rowIndex].level===t.getCurrentViewRecords()[e.row.rowIndex-1].level&&this.enableItems([t.element.id+"_gridcontrol_indent"],!0),0===t.getCurrentViewRecords()[e.row.rowIndex].level&&this.enableItems([t.element.id+"_gridcontrol_outdent"],!1),0!==t.getCurrentViewRecords()[e.row.rowIndex].level&&this.enableItems([t.element.id+"_gridcontrol_outdent"],!0)),0!==e.row.rowIndex||sf.base.isNullOrUndefined(e.data.parentItem)||this.enableItems([t.element.id+"_gridcontrol_outdent"],!0)},e.prototype.toolbarClickHandler=function(e){var t=this.parent;if("Cell"===this.parent.editSettings.mode&&"Batch"===this.parent.grid.editSettings.mode&&e.item.id===this.parent.grid.element.id+"_update"&&(e.cancel=!0,this.parent.grid.editModule.saveCell()),e.item.id===this.parent.grid.element.id+"_expandall"&&this.parent.expandAll(),e.item.id===this.parent.grid.element.id+"_collapseall"&&this.parent.collapseAll(),e.item.id===t.grid.element.id+"_indent"&&t.getSelectedRecords().length){var i=t.getCurrentViewRecords()[t.getSelectedRowIndexes()[0]-1],r=void 0;if(i.level>t.getSelectedRecords()[0].level)for(var n=0;n<t.getCurrentViewRecords().length;n++)t.getCurrentViewRecords()[n].taskData===i.parentItem.taskData&&(r=n);else r=t.getSelectedRowIndexes()[0]-1;t.reorderRows([t.getSelectedRowIndexes()[0]],r,"child")}if(e.item.id===t.grid.element.id+"_outdent"&&t.getSelectedRecords().length){var s=t.getSelectedRowIndexes()[0],a=(r=void 0,t.getSelectedRecords()[0].parentItem);for(n=0;n<t.getCurrentViewRecords().length;n++)t.getCurrentViewRecords()[n].taskData===a.taskData&&(r=n);t.reorderRows([s],r,"below")}},e.prototype.getToolbar=function(){return this.parent.grid.toolbarModule.getToolbar()},e.prototype.enableItems=function(e,t){this.parent.grid.toolbarModule.enableItems(e,t)},e.prototype.destroy=function(){this.removeEventListener()},e}(),Fe=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Aggregate),this.parent=e,this.flatChildRecords=[],this.summaryQuery=[]}return e.prototype.getModuleName=function(){return"summary"},e.prototype.removeEventListener=function(){this.parent.isDestroyed},e.prototype.calculateSummaryValue=function(e,t,i){var r;this.summaryQuery=e;for(var n=[],s=0,a=Object.keys(t).length;s<a;s++){sf.grids.getObject("isSummaryRow",t[s])||n.push(t[s])}var o,d=D(n),l=n.slice(),p=Object.keys(this.parent.aggregates).length,h=Object.keys(d).length,c=this.parent.getColumns();if(this.parent.aggregates.filter((function(e){return e.showChildSummary})).length){var u=0;for(a=h;u<a;u++)if(r=d[u],o=this.getChildRecordsLength(r,l)){for(var g=function(e,t){var n,s=void 0;s={};for(var a=0;a<c.length;a++){s[sf.base.isNullOrUndefined(sf.grids.getObject("field",c[a]))?c[a]:sf.grids.getObject("field",c[a])]=null}if(s=f.createSummaryItem(s,f.parent.aggregates[e-1]),!f.parent.aggregates[e-1].showChildSummary)return"continue";l.map((function(e,t){e.uniqueID!==r.uniqueID||(n=t)}));var d=n+o+e,p=sf.base.extend({},r);delete p.childRecords,delete p[f.parent.childMapping],sf.base.setValue("parentItem",p,s);var h=sf.grids.getObject("level",p);if(sf.base.setValue("level",h+1,s),sf.base.setValue("isSummaryRow",!0,s),sf.base.setValue("parentUniqueID",p.uniqueID,s),i){var u=sf.grids.getObject("childRecords",r);u.length&&u.push(s)}l.splice(d,0,s)},f=this,y=1,b=p;y<=b;y++)g(y);this.flatChildRecords=[]}}else{for(var m={},v=0,w=c.length;v<w;v++){m[sf.base.isNullOrUndefined(sf.grids.getObject("field",c[v]))?c[v]:sf.grids.getObject("field",c[v])]=null}y=1;for(var R=p;y<=R;y++)this.createSummaryItem(m,this.parent.aggregates[y-1])}return l},e.prototype.getChildRecordsLength=function(e,t){for(var i,r=0,n=Object.keys(t).length;r<n;r++){if(i=t[r],e===(sf.base.isNullOrUndefined(i.parentItem)?null:t.filter((function(e){return e.uniqueID===i.parentItem.uniqueID}))[0])){if(this.flatChildRecords.push(i),!sf.grids.getObject("hasChildRecords",i))continue;this.getChildRecordsLength(i,t)}}return this.flatChildRecords.length},e.prototype.createSummaryItem=function(e,t){for(var i=0,r=Object.keys(t.columns).length;i<r;i++)for(var n=sf.base.isNullOrUndefined(t.columns[i].columnName)?t.columns[i].field:t.columns[i].columnName,s=0,a=Object.keys(e);s<a.length;s++){var o=a[s];if(o===n)if(this.flatChildRecords.length)e[o]=this.getSummaryValues(t.columns[i],this.flatChildRecords);else if(this.parent.isLocalData){var d=this.parent.dataSource instanceof sf.data.DataManager?this.parent.dataSource.dataSource.json:this.parent.flatData;e[o]=this.getSummaryValues(t.columns[i],d)}}return e},e.prototype.getSummaryValues=function(e,t){var i=new sf.data.Query,r={},n={},s=sf.base.isNullOrUndefined(e.field)?void 0:this.parent.getColumnByField(e.field).type;e.setPropertiesSilent({format:this.getFormatFromType(e.format,s)}),e.setFormatter(this.parent.grid.locale);var a=e.getFormatter()||function(e){return e};e.setTemplate(n);var o=e.getTemplate(2);i.queries=this.summaryQuery,i.requiresCount();var d,l=new sf.data.DataManager(t).executeLocal(i),p=e.type;p=[e.type];for(var h=0;h<p.length;h++){d=p[h];var c=e.field+" - "+p[h].toLowerCase(),u="Custom"!==p[h]?sf.grids.getObject("aggregates",l):sf.grids.calculateAggregate(p[h],l,e,this.parent),g=e.columnName,f="Custom"!==p[h]?u[c]:u;r[g]=r[g]||{},r[g][c]=f,r[g][p[h]]=sf.base.isNullOrUndefined(u)?" ":a(f)}n.format=e.getFormatter();var y=sf.base.createElement("td",{className:"e-summary"});if(this.parent.isReact){o.fn(r[e.columnName],this.parent,o.property,"",null,null,y),this.parent.renderReactTemplates()}else sf.grids.appendChildren(y,o.fn(r[e.columnName],this.parent,o.property));var b=r[e.columnName][d];return-1===y.innerHTML.indexOf(b)?y.innerHTML+b:y.innerHTML},e.prototype.getFormatFromType=function(e,t){if(sf.base.isNullOrUndefined(t)||"string"!=typeof e)return e;var i;switch(t){case"number":i={format:e};break;case"datetime":i={type:"dateTime",skeleton:e};break;case"date":i={type:t,skeleton:e}}return i},e.prototype.destroy=function(){this.removeEventListener()},e}(),je=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Sort),this.parent=e,this.taskIds=[],this.flatSortedData=[],this.storedIndex=-1,this.isSelfReference=!sf.base.isNullOrUndefined(this.parent.parentIdMapping),this.addEventListener()}return e.prototype.getModuleName=function(){return"sort"},e.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this),this.parent.on("createSort",this.createdSortedRecords,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateModel",this.updateModel),this.parent.off("createSort",this.createdSortedRecords))},e.prototype.createdSortedRecords=function(e){var t=e.modifiedData,i=e.srtQry;this.iterateSort(t,i),this.storedIndex=-1,e.modifiedData=this.flatSortedData,this.flatSortedData=[]},e.prototype.iterateSort=function(e,t){for(var i=0;i<e.length;i++)if((this.parent.grid.filterSettings.columns.length>0||""!==this.parent.grid.searchSettings.key)&&sf.base.isNullOrUndefined(k(this.parent,e[i].uniqueID,!0))||(this.storedIndex++,this.flatSortedData[this.storedIndex]=e[i]),e[i].hasChildRecords){var r=new sf.data.DataManager(e[i].childRecords).executeLocal(t);this.iterateSort(r,t)}},e.prototype.sortColumn=function(e,t,i){this.parent.grid.sortColumn(e,t,i)},e.prototype.removeSortColumn=function(e){this.parent.grid.removeSortColumn(e)},e.prototype.updateModel=function(){this.parent.setProperties({sortSettings:sf.grids.getActualProperties(this.parent.grid.sortSettings)},!0)},e.prototype.clearSorting=function(){this.parent.grid.clearSorting(),this.updateModel()},e.prototype.destroy=function(){this.removeEventListener()},e}(),ze=function(){function e(e){sf.grids.Grid.Inject(sf.grids.ColumnMenu),this.parent=e}return e.prototype.getColumnMenu=function(){return this.parent.grid.columnMenuModule.getColumnMenu()},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"columnMenu"},e}(),_e=function(){function e(e){sf.grids.Grid.Inject(sf.grids.ContextMenu),this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("contextMenuOpen",this.contextMenuOpen,this),this.parent.on("contextMenuClick",this.contextMenuClick,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("contextMenuOpen",this.contextMenuOpen),this.parent.off("contextMenuClick",this.contextMenuClick))},e.prototype.contextMenuOpen=function(e){var t=sf.base.select("#"+this.parent.element.id+"_gridcontrol_cmenu_AddRow",e.element),i=sf.base.select("#"+this.parent.element.id+"_gridcontrol_cmenu_Edit",e.element);t&&(!1===this.parent.grid.editSettings.allowAdding?t.style.display="none":t.style.display="block"),"Cell"!==this.parent.editSettings.mode&&"Batch"!==this.parent.editSettings.mode||sf.base.isNullOrUndefined(i)||i.classList.contains("e-menu-hide")||(i.style.display="none")},e.prototype.contextMenuClick=function(e){"Above"!==e.item.id&&"Below"!==e.item.id&&"Child"!==e.item.id||(this.parent.notify("savePreviousRowPosition",e),this.parent.setProperties({editSettings:{newRowPosition:e.item.id}},!0),this.parent.addRecord())},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getContextMenu=function(){return this.parent.grid.contextMenuModule.getContextMenu()},e}(),He=function(){function e(e){this.batchChildCount=0,this.addedRecords="addedRecords",this.deletedRecords="deletedRecords",this.batchAddedRecords=[],this.batchDeletedRecords=[],this.batchAddRowRecord=[],this.parent=e,this.isSelfReference=!sf.base.isNullOrUndefined(e.parentIdMapping),this.batchRecords=[],this.currentViewRecords=[],this.isAdd=!1,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("cellSaved",this.cellSaved,this),this.parent.on("batchAdd",this.batchAdd,this),this.parent.on("beforeBatchAdd",this.beforeBatchAdd,this),this.parent.on("batchSave",this.batchSave,this),this.parent.on("beforeBatchDelete",this.beforeBatchDelete,this),this.parent.on("beforeBatchSave",this.beforeBatchSave,this),this.parent.on("batchPageAction",this.batchPageAction,this),this.parent.on("batchCancelAction",this.batchCancelAction,this),this.parent.grid.on("immutable-batch-cancel",this.immutableBatchAction,this),this.parent.grid.on("next-cell-index",this.nextCellIndex,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("cellSaved",this.cellSaved),this.parent.off("batchAdd",this.batchAdd),this.parent.off("batchSave",this.batchSave),this.parent.off("beforeBatchAdd",this.beforeBatchAdd),this.parent.off("beforeBatchDelete",this.beforeBatchDelete),this.parent.off("beforeBatchSave",this.beforeBatchSave),this.parent.off("batchPageAction",this.batchPageAction),this.parent.off("batchCancelAction",this.batchCancelAction),this.parent.grid.off("immutable-batch-cancel",this.immutableBatchAction),this.parent.grid.off("next-cell-index",this.nextCellIndex))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getBatchRecords=function(){return this.batchRecords},e.prototype.getAddRowIndex=function(){return this.addRowIndex},e.prototype.getSelectedIndex=function(){return this.selectedIndex},e.prototype.getBatchChildCount=function(){return this.batchChildCount},e.prototype.batchPageAction=function(){var e,t=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,i=this.parent.grid.getPrimaryKeyFieldNames()[0];if(!sf.base.isNullOrUndefined(this.batchAddedRecords)&&this.batchAddedRecords.length)for(var r=0;r<this.batchAddedRecords.length;r++)e=t.map((function(e){return e[i]})).indexOf(this.batchAddedRecords[r][i]),t.splice(e,1);this.batchAddedRecords=this.batchRecords=this.batchAddRowRecord=this.batchDeletedRecords=this.currentViewRecords=[]},e.prototype.cellSaved=function(e){var t=e.cell.cellIndex,i=this.parent.frozenColumns||this.parent.getFrozenColumns();(i&&e.columnObject.index>i&&(t+=i),this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0)?this.parent.getFrozenLeftColumnsCount()+t==this.parent.treeColumnIndex&&this.parent.renderModule.cellRender({data:e.rowData,cell:e.cell,column:this.parent.grid.getColumnByIndex(e.cell.cellIndex)}):t===this.parent.treeColumnIndex&&this.parent.renderModule.cellRender({data:e.rowData,cell:e.cell,column:this.parent.grid.getColumnByIndex(e.cell.cellIndex)});if(this.isAdd&&"Batch"===this.parent.editSettings.mode&&"Bottom"!==this.parent.editSettings.newRowPosition){var r=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,n=void 0,s=this.parent.grid.getPrimaryKeyFieldNames()[0],a=void 0,o=void 0,d=this.selectedIndex>-1?this.batchRecords[this.addRowIndex].parentItem:null,l=void 0,p=void 0,h=void 0,c="Top"===this.parent.editSettings.newRowPosition||-1===this.selectedIndex?0:"Above"===this.parent.editSettings.newRowPosition?this.addRowIndex:this.addRowIndex+1;if(c=this.getActualRowObjectIndex(c),this.newBatchRowAdded){if(this.batchRecords.length&&(l=this.batchRecords[this.addRowIndex][this.parent.idMapping],h=this.batchRecords[this.addRowIndex][this.parent.parentIdMapping],this.batchRecords[this.addRowIndex].parentItem&&(p=this.batchRecords[this.addRowIndex].parentItem.uniqueID)),this.batchAddedRecords=E(this.batchAddedRecords),this.batchAddRowRecord=E(this.batchAddRowRecord),this.batchAddRowRecord.push(this.batchRecords[this.addRowIndex]),(n=this.parent.grid.getRowsObject()[c].changes).uniqueID=sf.grids.getUid(this.parent.element.id+"_data_"),sf.base.setValue("uniqueIDCollection."+n.uniqueID,n,this.parent),!Object.prototype.hasOwnProperty.call(n,"level")){if(this.batchIndex=-1===this.selectedIndex?0:this.batchIndex,"Child"===this.parent.editSettings.newRowPosition){if(n.primaryParent=d,this.selectedIndex>-1){n.parentItem=sf.base.extend({},this.batchRecords[this.addRowIndex]),n.parentUniqueID=n.parentItem.uniqueID,delete n.parentItem.childRecords,delete n.parentItem[this.parent.childMapping],n.level=n.parentItem.level+1,n.index=this.batchIndex;var u=O(this.batchRecords[this.addRowIndex]).length,g=O(this.batchRecords[this.addRowIndex])[u-1];g=sf.base.isNullOrUndefined(g)?this.batchRecords[this.addRowIndex]:g,a=r.map((function(e){return e[s]})).indexOf(g[s]),this.isSelfReference&&(n[this.parent.parentIdMapping]=l),ge(s,n.parentItem,"add",this.parent,this.isSelfReference,n)}}else if(("Above"===this.parent.editSettings.newRowPosition||"Below"===this.parent.editSettings.newRowPosition)&&!sf.base.isNullOrUndefined(this.batchRecords[this.addRowIndex])){if(n.level=this.batchRecords[this.addRowIndex].level,n.level&&this.selectedIndex>-1&&(n.parentItem=d,n.parentUniqueID=p,delete n.parentItem.childRecords,delete n.parentItem[this.parent.childMapping]),n.index="Below"===this.parent.editSettings.newRowPosition?this.batchIndex:this.batchIndex-1,"Below"===this.parent.editSettings.newRowPosition&&this.selectedIndex>-1){u=O(this.batchRecords[this.addRowIndex]).length,g=O(this.batchRecords[this.addRowIndex])[u-1];g=sf.base.isNullOrUndefined(g)?this.batchRecords[this.addRowIndex]:g,a=r.map((function(e){return e[s]})).indexOf(g[s])}if("Above"===this.parent.editSettings.newRowPosition&&this.selectedIndex>-1){g=this.batchRecords[this.addRowIndex];a=r.map((function(e){return e[s]})).indexOf(g[s])}this.isSelfReference&&(n[this.parent.parentIdMapping]=h)}n.index=-1===n.index?0:n.index,n.hasChildRecords=!1,n.childRecords=[],this.batchRecords.splice(n.index,0,n),this.currentViewRecords.splice(n.index,0,n),o=a||n.index,"Above"!==this.parent.editSettings.newRowPosition&&(o=0===n.index?o:o+1),r.splice(o,0,n),this.batchAddedRecords.push(n)}this.parent.grid.getRowsObject()[c].data=n,this.newBatchRowAdded=!1}(this.parent.frozenColumns||this.parent.getFrozenColumns()&&"add"===this.parent.grid.getRowsObject()[c].edit)&&sf.base.merge(this.currentViewRecords[c],this.parent.grid.getRowsObject()[c].changes)}},e.prototype.beforeBatchAdd=function(e){if("Cell"===this.parent.editSettings.mode&&this.parent.editModule.isTabLastRow)return e.cancel=!0,void(this.parent.editModule.isTabLastRow=!1);this.selectedIndex=this.parent.grid.selectedRowIndex,this.addRowIndex=this.parent.grid.selectedRowIndex>-1?this.parent.grid.selectedRowIndex:0,this.addRowRecord=this.parent.getSelectedRecords()[0]},e.prototype.batchAdd=function(e){if("Bottom"!==this.parent.editSettings.newRowPosition){this.isAdd=!0,this.newBatchRowAdded=!0;var t=0;if(this.batchRecords.length||(this.batchAddedRecords=[],this.batchRecords=E(this.parent.grid.getCurrentViewRecords()),this.currentViewRecords=E(this.parent.grid.getCurrentViewRecords())),"Top"!==this.parent.editSettings.newRowPosition){var i=this.parent.grid.getCurrentViewRecords();"Batch"===this.parent.editSettings.mode&&(this.parent.getBatchChanges()[this.addedRecords].length>1||this.parent.getBatchChanges()[this.deletedRecords].length)&&(i=this.batchRecords),this.updateChildCount(i),this.parent.notify("beginAdd",{}),this.batchChildCount=0}this.updateRowIndex();var r=sf.base.getValue("focusModule",this.parent.grid),n=this.parent.getContentTable();this.parent.getBatchChanges()[this.deletedRecords].length&&"Above"===this.parent.editSettings.newRowPosition?(t=e.row.rowIndex,r.getContent().matrix.matrix=this.matrix):t=n.getElementsByClassName("e-batchrow")[0].rowIndex,r.getContent().matrix.current=[t,r.getContent().matrix.current[1]]}},e.prototype.beforeBatchDelete=function(){this.batchRecords.length||(this.batchRecords=E(this.parent.grid.getCurrentViewRecords()),this.currentViewRecords=E(this.parent.grid.getCurrentViewRecords()));var e=sf.base.getValue("focusModule",this.parent.grid);this.matrix=e.getContent().matrix.matrix;var t,i=[],r=this.parent.grid.getPrimaryKeyFieldNames()[0],n=this.parent.grid.getSelectedRecords()[this.parent.grid.getSelectedRecords().length-1],s=O(n),a=this.parent.getSelectedRows()[0].getAttribute("data-uid"),o=parseInt(this.parent.grid.getRowElementByUID(a).getAttribute("aria-rowindex"),10);if(s.length)for(var d=o+s.length,l=o+1;l<=d;l++)i.push(this.parent.grid.getDataRows()[l]),(this.parent.frozenRows||this.parent.frozenColumns||this.parent.getFrozenColumns())&&i.push(this.parent.grid.getMovableRows()[l]);if(!sf.base.isNullOrUndefined(n.parentItem)){var p=k(this.parent,n.parentItem.uniqueID);if(!sf.base.isNullOrUndefined(p)&&p.hasChildRecords){var h=p.childRecords.indexOf(n);p.childRecords.splice(h,1)}this.batchDeletedRecords=E(this.batchDeletedRecords),this.batchDeletedRecords.push(n)}s.push(n),t=s;for(l=0;l<t.length;l++){var c=this.batchRecords.map((function(e){return e[r]})).indexOf(t[l][r]);-1!==c&&this.batchRecords.splice(c,1)}for(l=0;l<i.length;l++)sf.base.isNullOrUndefined(i[l])||this.parent.grid.selectionModule.selectedRecords.push(i[l])},e.prototype.updateRowIndex=function(){for(var e=this.parent.grid.getDataRows(),t=0;t<e.length;t++)e[t].setAttribute("aria-rowindex",t.toString());var i=this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0;if(this.parent.frozenRows||this.parent.getFrozenColumns()||this.parent.frozenColumns||i){var r=this.parent.grid.getMovableDataRows(),n=this.parent.grid.getFrozenRightDataRows();for(t=0;t<r.length;t++)r[t].setAttribute("aria-rowindex",t.toString()),i&&n[t].setAttribute("aria-rowindex",t.toString())}},e.prototype.updateChildCount=function(e){for(var t=this.parent.grid.getPrimaryKeyFieldNames()[0],i="Child"===this.parent.editSettings.newRowPosition?"primaryParent":"parentItem",r=0;r<this.parent.getBatchChanges().addedRecords.length;r++)sf.base.isNullOrUndefined(this.parent.getBatchChanges().addedRecords[r][i])||this.parent.getBatchChanges().addedRecords[r][i][t]===e[this.addRowIndex][t]&&(this.batchChildCount=this.batchChildCount+1)},e.prototype.beforeBatchSave=function(e){var t=e.batchChanges.changedRecords;if(e.batchChanges.changedRecords.length)for(var i=0;i<t.length;i++)ce({value:t[i],action:"edit"},this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,void 0);if(e.batchChanges.deletedRecords.length){var r=e.batchChanges.deletedRecords;for(i=0;i<r.length;i++){this.deleteUniqueID(r[i].uniqueID);for(var n=O(r[i]),s=0;s<n.length;s++)this.deleteUniqueID(n[s].uniqueID);e.batchChanges.deletedRecords=e.batchChanges.deletedRecords.concat(n)}}this.isAdd=!1},e.prototype.deleteUniqueID=function(e){delete this.parent.uniqueIDFilterCollection[e];delete this.parent.uniqueIDCollection[e]},e.prototype.batchCancelAction=function(){var e,t=this.parent.grid.getCurrentViewRecords(),i=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,r=this.parent.grid.getPrimaryKeyFieldNames()[0];if(!sf.base.isNullOrUndefined(this.parent.targetElement)){var n=this.parent.targetElement.closest("tr");this.parent.collapseRow(n),this.parent.targetElement=null}if(!sf.base.isNullOrUndefined(this.batchAddedRecords))for(var s=0;s<this.batchAddedRecords.length;s++)if(e=i.map((function(e){return e[r]})).indexOf(this.batchAddedRecords[s][r]),i.splice(e,1),"Child"===this.parent.editSettings.newRowPosition&&(e=t.map((function(e){return e[r]})).indexOf(this.batchAddedRecords[s].parentItem?this.batchAddedRecords[s].parentItem[r]:this.batchAddedRecords[s][r]),!sf.base.isNullOrUndefined(t[e])))for(var a=t[e].childRecords,o=0;a&&o<a.length;o++)a[o][r]===this.batchAddedRecords[s][r]&&t[e].childRecords.splice(o,1);if(!sf.base.isNullOrUndefined(this.batchDeletedRecords))for(s=0;s<this.batchDeletedRecords.length;s++)if(!sf.base.isNullOrUndefined(this.batchDeletedRecords[s].parentItem)){e=t.map((function(e){return e[r]})).indexOf(this.batchDeletedRecords[s].parentItem[r]);var d=0===this.batchDeletedRecords[s].index?this.batchDeletedRecords[s].index:this.batchDeletedRecords[s].index-1;sf.base.isNullOrUndefined(t[e])||t[e].childRecords.splice(d,0,this.batchDeletedRecords[s])}this.batchAddedRecords=this.batchRecords=this.batchAddRowRecord=this.currentViewRecords=[],this.batchRecords=E(this.parent.grid.getCurrentViewRecords()),this.batchIndex=0,this.currentViewRecords=E(this.parent.grid.getCurrentViewRecords()),this.batchDeletedRecords=[],this.parent.grid.renderModule.refresh()},e.prototype.batchSave=function(e){if("Batch"===this.parent.editSettings.mode){var t=void 0,i=Object.hasOwnProperty.call(e,"updatedRecords")?e.updatedRecords:this.parent.getBatchChanges(),r=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,n=this.parent.grid.getCurrentViewRecords(),s=this.parent.grid.getPrimaryKeyFieldNames()[0],a=i.addedRecords,o=void 0,d=void 0,l=void 0;if(a.length>1&&"Bottom"!==this.parent.editSettings.newRowPosition&&a.reverse(),"Bottom"!==this.parent.editSettings.newRowPosition&&!Object.hasOwnProperty.call(e,"updatedRecords"))if(r.splice(r.length-a.length,a.length),this.parent.allowPaging||r.length===n.length){var p=E(r);if(p.length){var h=p.map((function(e){return e[s]})).indexOf(n[0][s]),c=h+this.parent.grid.pageSettings.pageSize;n=p.splice(h,c)}}else n.length>a.length&&n.splice(n.length-a.length,a.length);for(0===this.batchAddRowRecord.length&&this.batchAddRowRecord.push(this.parent.flatData[e.index]),t=0;t<a.length;t++){var u=sf.base.extend({},a[t]);if(delete u.parentItem,delete u.uniqueID,delete u.index,delete u.level,delete u.hasChildRecords,delete u.childRecords,delete u.parentUniqueID,sf.base.isNullOrUndefined(u.primaryParent)||delete u.primaryParent,a[t].taskData=u,l=this.batchAddRowRecord[t],sf.base.isNullOrUndefined(l)&&(l=this.batchAddRowRecord[t-1]),this.isSelfReference&&(sf.base.isNullOrUndefined(a[t].parentItem)||ge(s,a[t].parentItem,"add",this.parent,this.isSelfReference,a[t])),sf.base.isNullOrUndefined(l)||(d=l.index),"Top"!==this.parent.editSettings.newRowPosition&&"Bottom"!==this.parent.editSettings.newRowPosition&&sf.base.isNullOrUndefined(a[t].parentItem)&&-1===this.selectedIndex&&(o=-1,l=null),ce({value:a[t],action:"add"},this.parent,this.isSelfReference,d,o,void 0,l),o=null,"Child"===this.parent.editSettings.newRowPosition&&!sf.base.isNullOrUndefined(a[t].parentItem))for(var g=n.map((function(e){return e[s]})).indexOf(a[t].parentItem[s]),f=n[g].childRecords,y=0;y<f.length;y++)f[y][s]===a[t][s]&&n[g].childRecords.splice(y,1)}if(i.deletedRecords.length)for(t=0;t<i.deletedRecords.length;t++)ce({value:i.deletedRecords[t],action:"delete"},this.parent,this.isSelfReference,d,o,void 0,l);this.parent.parentData=[];for(var b=0;b<r.length;b++)r[b].index=b,sf.base.setValue("uniqueIDCollection."+r[b].uniqueID+".index",b,this.parent),r[b].level||this.parent.parentData.push(r[b])}this.batchAddRowRecord=this.batchAddedRecords=this.batchRecords=this.batchDeletedRecords=this.currentViewRecords=[]},e.prototype.getActualRowObjectIndex=function(e){var t=this.parent.grid.getDataRows();if(("Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&this.selectedIndex>-1){if(!sf.base.isNullOrUndefined(this.batchRecords[this.addRowIndex])&&this.batchRecords[this.addRowIndex].expanded)if(this.parent.getBatchChanges()[this.addedRecords].length>1||this.parent.getBatchChanges()[this.deletedRecords].length){if(e+=O(this.batchRecords[this.addRowIndex]).length,"Child"!==this.parent.editSettings.newRowPosition)e+=this.getBatchChildCount()}else e+=O(this.batchRecords[this.addRowIndex]).length;e>=t.length&&(e=t.length-1),this.updateChildCount(this.parent.grid.getCurrentViewRecords()),this.batchChildCount&&(e+=this.batchChildCount),this.batchChildCount=0}return e},e.prototype.immutableBatchAction=function(e){e.args.cancel=!0;var t=this.parent.grid.getBatchChanges(),i=[];Object.keys(t).length&&(i=t.addedRecords);for(var r=0;r<i.length;r++)e.rows.splice(i[r].index,1)},e.prototype.nextCellIndex=function(e){e.index=this.parent.getSelectedRows()[0].rowIndex},e}(),Ge=function(){function e(e){this.addedRecords="addedRecords",this.deletedRecords="deletedRecords",this.prevAriaRowIndex="-1",this.isAddedRowByMethod=!1,sf.grids.Grid.Inject(sf.grids.Edit),this.parent=e,this.isSelfReference=!sf.base.isNullOrUndefined(e.parentIdMapping),this.previousNewRowPosition=null,this.internalProperties={},this.batchEditModule=new He(this.parent),this.addEventListener()}return e.prototype.getModuleName=function(){return"edit"},e.prototype.addEventListener=function(){this.parent.on("crudAction",this.crudAction,this),this.parent.on("beginEdit",this.beginEdit,this),this.parent.on("beginAdd",this.beginAdd,this),this.parent.on("recordDoubleClick",this.recordDoubleClick,this),this.parent.on("cellSave",this.cellSave,this),this.parent.on("batchCancel",this.batchCancel,this),this.parent.grid.on("key-pressed",this.keyPressed,this),this.parent.grid.on("batchedit-form",this.lastCellTab,this),this.parent.grid.on("content-ready",this.contentready,this),this.parent.on("cellEdit",this.cellEdit,this),this.parent.on("actionBegin",this.editActionEvents,this),this.parent.on("actionComplete",this.editActionEvents,this),this.parent.grid.on("double-tap",this.recordDoubleClick,this),this.parent.grid.on("dblclick",this.gridDblClick,this),this.parent.grid.on("recordAdded",this.customCellSave,this),this.parent.on("savePreviousRowPosition",this.savePreviousRowPosition,this),this.parent.grid.on("edit-form",this.beforeStartEdit,this),this.parent.grid.on("before-batch-cancel",this.beforeBatchCancel,this),this.parent.grid.on("reset-edit-props",this.resetIsOnBatch,this),this.parent.grid.on("get-row-position",this.getRowPosition,this)},e.prototype.gridDblClick=function(e){this.doubleClickTarget=e.target},e.prototype.getRowPosition=function(e){e.newRowPosition=this.parent.editSettings.newRowPosition,e.addRowIndex=this.addRowIndex,e.ariaRowIndex=+this.prevAriaRowIndex},e.prototype.beforeStartEdit=function(e){this.parent.trigger("actionBegin",e)},e.prototype.beforeBatchCancel=function(e){"Cell"===this.parent.editSettings.mode&&this.parent.trigger("actionComplete",e)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("crudAction",this.crudAction),this.parent.off("beginEdit",this.beginEdit),this.parent.off("beginAdd",this.beginAdd),this.parent.off("recordDoubleClick",this.recordDoubleClick),this.parent.off("batchCancel",this.batchCancel),this.parent.grid.off("key-pressed",this.keyPressed),this.parent.grid.off("batchedit-form",this.lastCellTab),this.parent.grid.off("content-ready",this.contentready),this.parent.off("cellEdit",this.cellEdit),this.parent.off("actionBegin",this.editActionEvents),this.parent.off("actionComplete",this.editActionEvents),this.parent.grid.off("recordAdded",this.customCellSave),this.parent.grid.off("double-tap",this.recordDoubleClick),this.parent.off("savePreviousRowPosition",this.savePreviousRowPosition),this.parent.grid.off("edit-form",this.beforeStartEdit),this.parent.grid.off("before-batch-cancel",this.beforeBatchCancel),this.parent.grid.off("dblclick",this.gridDblClick),this.parent.grid.off("reset-edit-props",this.resetIsOnBatch),this.parent.grid.off("get-row-position",this.getRowPosition))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.applyFormValidation=function(e){this.parent.grid.editModule.applyFormValidation(e)},e.prototype.editActionEvents=function(e){var t=sf.grids.getObject("editAction",e),i=sf.grids.getObject("name",t),r=this.parent,n=r.dataSource.adaptor;if((C(r)||n instanceof sf.data.RemoteSaveAdaptor)&&"save"===t.requestType&&"add"===t.action&&("Child"===r.editSettings.newRowPosition||"Below"===r.editSettings.newRowPosition||"Above"===r.editSettings.newRowPosition))if("actionBegin"===i){var s=sf.base.isNullOrUndefined(t.row)||!Object.keys(t.row).length?this.selectedIndex:t.row.rowIndex-1,a=sf.base.isNullOrUndefined(s)||-1===s?-1:r.getCurrentViewRecords()[s][r.getPrimaryKeyFieldNames()[0]];r.grid.query.addParams("relationalKey",a)}else if("actionComplete"===i)for(var o=r.grid.query.params.length,d=0;d<o;d++)"relationalKey"===r.grid.query.params[d].key&&r.grid.query.params.splice(d);this.parent.enableInfiniteScrolling&&"actionComplete"===i&&this.infiniteAddAction(t),"Batch"===this.parent.editSettings.mode&&"paging"===t.requestType&&this.parent.notify("batchPageAction",{})},e.prototype.infiniteAddAction=function(e){if("save"===e.requestType&&"add"===e.action||"delete"===e.requestType){if("Top"!==this.parent.editSettings.newRowPosition&&-1!==this.selectedIndex&&"save"===e.requestType&&"add"===e.action){var t=this.parent.grid.getRowsObject(),i=t.splice(0,1)[0],r=this.addRowIndex,n=this.parent.getCurrentViewRecords();"Below"!==this.parent.editSettings.newRowPosition&&"Child"!==this.parent.editSettings.newRowPosition||(r+=O(n[r+1]).length),r="Below"===this.parent.editSettings.newRowPosition?r+1:r,t.splice(r,0,i);var s=n.splice(0,1)[0];n.splice(r,0,s),this.updateInfiniteCurrentViewData(s,this.addRowIndex)}var a=this.parent.grid.getMovableRows(),o=this.parent.grid.getMovableRowsObject(),d=this.parent.infiniteScrollSettings.enableCache;d||(sf.grids.resetRowIndex(this.parent.grid,this.parent.grid.getRowsObject(),this.parent.grid.getRows(),0),this.updateIndex(this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords())),!d&&this.parent.getFrozenColumns()>0&&(sf.grids.resetRowIndex(this.parent.grid,o,a,0),this.updateIndex(this.parent.grid.dataSource,a,this.parent.getCurrentViewRecords()))}},e.prototype.updateInfiniteCurrentViewData=function(e,t){var i=this,r=Math.ceil(t/this.parent.grid.pageSettings.pageSize),n=r>0?r:1,s=t-(n-1)*this.parent.pageSettings.pageSize,a=this.parent.grid.infiniteScrollModule.infiniteCurrentViewData;a[1].splice(0,1);var o=a[n];sf.base.isNullOrUndefined(this.addRowRecord)||(o.filter((function(e,t){e.uniqueID===i.addRowRecord.uniqueID&&(s=t)})),(this.addRowRecord.hasChildRecords&&this.addRowRecord.childRecords.length&&"Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&(s+=O(this.addRowRecord).length)),s>=this.parent.pageSettings.pageSize&&(o=a[n+=1],s=s-this.parent.pageSettings.pageSize>=0?s-this.parent.pageSettings.pageSize:0),s="Below"===this.parent.editSettings.newRowPosition?s+1:s,o.splice(s,0,e),this.parent.grid.infiniteScrollModule.updateCurrentViewData()},e.prototype.recordDoubleClick=function(e){var t=e.target;if(!sf.base.isNullOrUndefined(t.closest("td.e-rowcell"))&&this.parent.grid.editSettings.allowEditing&&!this.parent.grid.isEdit){var i=this.parent.grid.getColumnByIndex(+t.closest("td.e-rowcell").getAttribute("aria-colindex"));if("Cell"===this.parent.editSettings.mode&&!this.isOnBatch&&i&&!i.isPrimaryKey&&this.parent.editSettings.allowEditing&&i.allowEditing&&!t.classList.contains("e-treegridexpand")&&!t.classList.contains("e-treegridcollapse")&&this.parent.editSettings.allowEditOnDblClick){if(this.isOnBatch=!0,this.parent.grid.setProperties({selectedRowIndex:e.rowIndex},!0),this.parent.enableVirtualization){var r=sf.grids.parentsUntil(e.target,"e-row");this.prevAriaRowIndex=r.getAttribute("aria-rowindex"),r.setAttribute("aria-rowindex",r.rowIndex+"")}this.updateGridEditMode("Batch")}}},e.prototype.updateGridEditMode=function(e){this.parent.grid.setProperties({editSettings:{mode:e}},!0),sf.grids.getObject("updateEditObj",this.parent.grid.editModule).apply(this.parent.grid.editModule),this.parent.grid.isEdit=!1},e.prototype.resetIsOnBatch=function(){this.parent.enableVirtualization&&"Cell"===this.parent.editSettings.mode&&(this.isOnBatch=!1,this.updateGridEditMode("Normal"))},e.prototype.keyPressed=function(e){this.isOnBatch&&(this.keyPress=e.action),"f2"===e.action&&this.recordDoubleClick(e),"escape"==e.action&&this.parent.closeEdit()},e.prototype.deleteUniqueID=function(e){delete this.parent.uniqueIDFilterCollection[e];delete this.parent.uniqueIDCollection[e]},e.prototype.cellEdit=function(e){var t=this,i=e.promise;if(delete e.promise,this.parent.enableVirtualization&&!sf.base.isNullOrUndefined(this.prevAriaRowIndex)&&(e.row.setAttribute("aria-rowindex",this.prevAriaRowIndex),this.prevAriaRowIndex=void 0),"enter"!==this.keyPress&&this.parent.trigger("cellEdit",e,(function(e){e.cancel||"Cell"!==t.parent.editSettings.mode?e.cancel&&"Cell"===t.parent.editSettings.mode&&(t.isOnBatch=!1,t.updateGridEditMode("Normal")):t.enableToolbarItems("edit"),sf.base.isNullOrUndefined(i)||i.resolve(e)})),this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")||this.doubleClickTarget.classList.contains("e-summarycell")))return e.cancel=!0,void(this.doubleClickTarget=null);"Cell"===this.parent.editSettings.mode&&("tab"===this.keyPress||"shiftTab"===this.keyPress?this.keyPress=null:"enter"===this.keyPress&&(e.cancel=!0,this.keyPress=null,sf.base.setValue("isEditCollapse",!1,this.parent)),e.columnObject.allowEditing||(e.cancel=!0))},e.prototype.enableToolbarItems=function(e){if(!sf.base.isNullOrUndefined(this.parent.grid.toolbarModule)){var t=this.parent.element.id+"_gridcontrol_";this.parent.grid.toolbarModule.enableItems([t+"add",t+"edit",t+"delete"],"save"===e),this.parent.grid.toolbarModule.enableItems([t+"update",t+"cancel"],"edit"===e)}},e.prototype.batchCancel=function(){if("Cell"===this.parent.editSettings.mode){var e=sf.base.getValue("editModule.cellDetails",this.parent.grid.editModule),t=this.parent.getCellFromIndex(e.rowIndex,this.parent.treeColumnIndex);this.parent.renderModule.cellRender({data:e.rowData,cell:t,column:this.parent.grid.getColumns()[this.parent.treeColumnIndex]}),this.updateGridEditMode("Normal"),this.isOnBatch=!1}"Batch"===this.parent.editSettings.mode&&this.parent.notify("batchCancelAction",{})},e.prototype.customCellSave=function(e){x(this.parent)&&"Cell"===this.parent.editSettings.mode&&"edit"===e.action&&(this.updateCell(e,e.rowIndex),this.afterCellSave(e,e.row,e.rowIndex))},e.prototype.cellSave=function(e){var t=this;if("Cell"===this.parent.editSettings.mode&&this.parent.element.querySelector("form")){e.cancel=!0;var i,r;sf.base.setValue("isEdit",!1,this.parent.grid),sf.base.setValue("isEditCollapse",!0,this.parent),e.rowData[e.columnName]=e.value,i=sf.base.isNullOrUndefined(e.cell)?this.parent.grid.editModule.editModule.form.parentElement.parentNode:e.cell.parentNode;var n=this.parent.getPrimaryKeyFieldNames();if(sf.base.isNullOrUndefined(i))this.parent.grid.getCurrentViewRecords().filter((function(t,i){t[n[0]]!==e.rowData[n[0]]||(r=i)}));else{var s=this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0;r=s?-1!=this.parent.getRows().indexOf(i)?this.parent.getRows().indexOf(i):-1!=this.parent.getFrozenRightRows().indexOf(i)?this.parent.getFrozenRightRows().indexOf(i):this.parent.getMovableRows().indexOf(i):-1===this.parent.getRows().indexOf(i)&&this.parent.getFrozenColumns()>0?this.parent.grid.getMovableRows().indexOf(i):this.parent.getRows().indexOf(i)}var a={};if(sf.base.extend(a,e),a.cancel=!1,a.type="save",i=this.parent.grid.getRows()[i.rowIndex],this.parent.trigger("actionBegin",a),a.cancel)this.parent.grid.isEdit=!0;else if(i.rowIndex===this.parent.getCurrentViewRecords().length-1&&"tab"===this.keyPress&&(this.isTabLastRow=!0),C(this.parent)||this.parent.dataSource instanceof sf.data.DataManager&&this.parent.dataSource.adaptor instanceof sf.data.RemoteSaveAdaptor){if(C(this.parent)||this.parent.dataSource instanceof sf.data.DataManager&&this.parent.dataSource.adaptor instanceof sf.data.RemoteSaveAdaptor){var o=this.parent.grid.query;this.parent.grid.dataSource.update(n[0],e.rowData,o.fromTable,o,e.previousValue).then((function(n){sf.base.isNullOrUndefined(n)||(e.rowData[e.columnName]=n[e.columnName]),t.updateCell(e,r),t.afterCellSave(e,i,r)}))}}else if(x(this.parent)){var d={requestType:"save",data:e.rowData,action:"edit",row:i,rowIndex:r,rowData:e.rowData,columnName:e.columnName,filterChoiceCount:null,excelSearchOperator:null};this.parent.grid.getDataModule().eventPromise(d,this.parent.grid.query)}else this.updateCell(e,r),this.afterCellSave(e,i,r)}},e.prototype.afterCellSave=function(e,t,i){var r;this.parent.grid.aggregateModule&&this.parent.grid.aggregateModule.refresh(e.rowData),this.parent.grid.editModule.destroyWidgets([this.parent.grid.getColumnByField(e.columnName)]),this.parent.grid.editModule.formObj.destroy(),"tab"!==this.keyPress&&"shiftTab"!==this.keyPress&&(this.updateGridEditMode("Normal"),this.isOnBatch=!1),this.enableToolbarItems("save"),this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0?(r=e.cell.closest(".e-frozen-left-header")||e.cell.closest(".e-frozen-left-content")?this.parent.grid.getRows()[i]:e.cell.closest(".e-movableheader")||e.cell.closest(".e-movablecontent")?this.parent.grid.getMovableRows()[i]:this.parent.grid.getFrozenRightRows()[i],sf.base.removeClass([r],["e-editedrow","e-batchrow"]),sf.base.removeClass(r.querySelectorAll(".e-rowcell"),["e-editedbatchcell","e-updatedtd"])):this.parent.getFrozenColumns()>0&&(r=e.cell.closest(".e-frozenheader")||e.cell.closest(".e-frozencontent")?this.parent.grid.getRows()[i]:this.parent.grid.getMovableRows()[i],sf.base.removeClass([r],["e-editedrow","e-batchrow"]),sf.base.removeClass(r.querySelectorAll(".e-rowcell"),["e-editedbatchcell","e-updatedtd"])),sf.base.removeClass([t],["e-editedrow","e-batchrow"]),sf.base.removeClass(t.querySelectorAll(".e-rowcell"),["e-editedbatchcell","e-updatedtd"]),!1!==this.parent.isCellSaveFocus&&this.parent.grid.focusModule.restoreFocus(),ce({value:e.rowData,action:"edit"},this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,e.columnName),t.rowIndex===this.parent.getCurrentViewRecords().length-1&&"enter"===this.keyPress&&(this.keyPress=null);var n={type:"save",column:this.parent.getColumnByField(e.columnName),data:e.rowData,previousData:e.previousValue,row:t,target:e.cell};this.parent.aggregates.map((function(e){return 1==e.showChildSummary})).length&&this.parent.grid.refresh(),this.parent.trigger("actionComplete",n)},e.prototype.lastCellTab=function(){!this.parent.grid.isEdit&&this.isOnBatch&&"tab"===this.keyPress&&"Cell"===this.parent.editSettings.mode&&(this.parent.editSettings.allowNextRowEdit?this.enableToolbarItems("edit"):(this.updateGridEditMode("Normal"),this.isOnBatch=!1,this.keyPress=null))},e.prototype.updateCell=function(e,t){this.parent.grid.editModule.updateCell(t,e.columnName,e.rowData[e.columnName]),this.parent.grid.getRowsObject()[t].data=e.rowData},e.prototype.crudAction=function(e,t){ce(e,this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,t,this.addRowRecord),this.parent.parentData=[];for(var i=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,r=0;r<i.length;r++){i[r].index=r;var n=this.parent.grid.getPrimaryKeyFieldNames()[0];e.value[n]===i[r][n]&&"add"===e.action&&(i[r].level=this.internalProperties.level,i[r].taskData=this.internalProperties.taskData,i[r].uniqueID=this.internalProperties.uniqueID,sf.base.isNullOrUndefined(this.internalProperties.parentItem)||(i[r].parentItem=this.internalProperties.parentItem,i[r].parentUniqueID=this.internalProperties.parentUniqueID),i[r].childRecords=this.internalProperties.childRecords),sf.base.setValue("uniqueIDCollection."+i[r].uniqueID+".index",r,this.parent),i[r].level||this.parent.parentData.push(i[r])}"add"===e.action&&null!=this.previousNewRowPosition&&(this.parent.setProperties({editSettings:{newRowPosition:this.previousNewRowPosition}},!0),this.previousNewRowPosition=null)},e.prototype.updateIndex=function(e,t,i){for(var r=0;r<this.parent.getDataRows().length;r++){var n=i[r],s=sf.base.getValue("uniqueIDCollection."+n.uniqueID+".index",this.parent);if(n.index=s,!sf.base.isNullOrUndefined(n.parentItem)){var a=sf.base.getValue("uniqueIDCollection."+n.parentItem.uniqueID+".index",this.parent);n.parentItem.index=a}}var o=-1,d=this.parent.treeColumnIndex;if(this.parent.getFrozenColumns()>0)for(var l=t[0].querySelectorAll(".e-rowcell"),p=0;p<l.length;p++)if(l[p].classList.contains("e-gridrowindex0level0")){d=p;break}for(var h=0;h<this.parent.getRows().length;h++){t[h].classList.contains("e-detailrow")||o++;var c=i[o],u=(s=c.index,c.level),g=t[h];sf.base.isNullOrUndefined(c.parentItem)||(s=sf.base.getValue("uniqueIDCollection."+c.parentItem.uniqueID+".index",this.parent));var f=g.cells[d];if(!sf.base.isNullOrUndefined(f)){for(p=0;p<f.classList.length;p++){var y=f.classList[p],b=y.match(/e-gridrowindex/i),m=y.match(/e-griddetailrowindex/i);null!=b&&sf.base.removeClass([f],y),null!=m&&sf.base.removeClass([f],y)}t[h].classList.contains("e-detailrow")?sf.base.addClass([f],"e-griddetailrowindex"+s+"level"+u):sf.base.addClass([f],"e-gridrowindex"+s+"level"+u)}}},e.prototype.beginAdd=function(){var e,t=this.addRowIndex,i=this.parent.grid.getCurrentViewRecords();"Batch"===this.parent.editSettings.mode&&(t=this.batchEditModule.getAddRowIndex(),this.selectedIndex=this.batchEditModule.getSelectedIndex(),(this.parent.getBatchChanges()[this.addedRecords].length>1||this.parent.getBatchChanges()[this.deletedRecords].length)&&(i=this.batchEditModule.getBatchRecords()));var r=this.parent.grid.getDataRows(),n=r.length?+r[0].getAttribute("aria-rowindex"):0,s=r.length?+r[r.length-1].getAttribute("aria-rowindex"):0,a=this.selectedIndex>=n&&this.selectedIndex<=s,o=this.parent.enableVirtualization&&this.addRowIndex>-1&&"-1"!==this.prevAriaRowIndex;if("Dialog"!==this.parent.editSettings.mode){if("Above"===this.parent.editSettings.newRowPosition)e="before";else if(("Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&(this.selectedIndex>-1||o)&&a){if(e="after",!sf.base.isNullOrUndefined(i[t])&&i[t].expanded)if("Batch"===this.parent.editSettings.mode&&(this.parent.getBatchChanges()[this.addedRecords].length>1||this.parent.getBatchChanges()[this.deletedRecords].length)){if(t+=O(i[t]).length,"Child"!==this.parent.editSettings.newRowPosition)t+=this.batchEditModule.getBatchChildCount()}else t+=O(i[t]).length}if((this.selectedIndex>-1||o)&&a&&(t||"Child"===this.parent.editSettings.newRowPosition||"Below"===this.parent.editSettings.newRowPosition)){t>=r.length-1&&(t=r.length-2);var d="rows",l=this.parent.grid.contentModule[d][0],p=document.activeElement;r[t+1][e](r[0]),sf.base.setValue("batchIndex",t+1,this.batchEditModule);var h="Above"===this.parent.editSettings.newRowPosition?t:t+1;"Batch"===this.parent.editSettings.mode&&(this.parent.grid.contentModule[d].splice(0,1),this.parent.grid.contentModule[d].splice(h,0,l));var c=this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0;if(this.parent.frozenRows||this.parent.getFrozenColumns()||this.parent.frozenColumns||c){var u=this.parent.getMovableDataRows(),g=this.parent.grid.getRowsObject()[0];if(u[t+1][e](u[0]),c){var f=this.parent.getFrozenRightDataRows();f[t+1][e](f[0])}"Batch"===this.parent.editSettings.mode&&(this.parent.grid.contentModule.freezeRows.splice(0,1),this.parent.grid.contentModule.freezeRows.splice(h,0,g)),sf.base.setValue("batchIndex",t+1,this.batchEditModule)}if("Row"===this.parent.editSettings.mode||"Cell"===this.parent.editSettings.mode){for(var y=this.parent.grid.getContentTable().querySelectorAll(".e-griderror"),b=0;b<y.length;b++)y[b].remove();sf.base.setValue("errorRules",[],this.parent.grid.editModule.formObj)}o&&(this.prevAriaRowIndex="-1"),p.focus()}}},e.prototype.beginEdit=function(e){if("refresh"===e.requestType&&this.isOnBatch)e.cancel=!0;else if("Cell"!==this.parent.editSettings.mode||"beginEdit"!==e.requestType){if(this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")||this.doubleClickTarget.classList.contains("e-frame")))return e.cancel=!0,void(this.doubleClickTarget=null);if("delete"===e.requestType)for(var t=e.data,i=0;i<t.length;i++){this.deleteUniqueID(t[i].uniqueID);for(var r=O(t[i]),n=0;n<r.length;n++)this.deleteUniqueID(r[n].uniqueID);e.data=t.concat(r)}if("add"===e.requestType||this.isAddedRowByMethod&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)){if((-1===this.parent.grid.selectedRowIndex&&this.isAddedRowByMethod||e.index!==this.parent.grid.selectedRowIndex)&&0!==e.index||(this.selectedIndex=this.parent.grid.selectedRowIndex),this.parent.enableVirtualization){var s='.e-row[aria-rowindex="'+this.selectedIndex+'"]',a=void 0;this.selectedIndex>-1&&"Top"!==this.parent.editSettings.newRowPosition&&"Bottom"!==this.parent.editSettings.newRowPosition?(this.prevAriaRowIndex=this.selectedIndex.toString(),a=this.parent.getContent().querySelector(s),this.addRowIndex=a?a.rowIndex:0):this.prevAriaRowIndex&&"-1"!==this.prevAriaRowIndex?(s='.e-row[aria-rowindex="'+this.prevAriaRowIndex+'"]',a=this.parent.getContent().querySelector(s),this.addRowIndex=a?a.rowIndex:0):this.addRowIndex=0}else this.isAddedRowByMethod&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)?this.addRowIndex=e.index:this.addRowIndex=this.parent.grid.selectedRowIndex>-1?this.parent.grid.selectedRowIndex:0;this.isAddedRowByMethod&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)?this.addRowRecord=this.parent.flatData[e.index]:this.addRowRecord=this.parent.getSelectedRecords()[0]}this.isAddedRowByMethod&&0!==e.index&&(this.addRowRecord=this.parent.flatData[e.index]),"Child"===this.parent.editSettings.newRowPosition&&sf.base.isNullOrUndefined(this.addRowRecord)&&!sf.base.isNullOrUndefined(this.parent.getSelectedRecords()[0])&&(this.addRowRecord=this.parent.getSelectedRecords()[0]),this.isAddedRowByMethod=!1,e=this.beginAddEdit(e)}else e.cancel=!0},e.prototype.savePreviousRowPosition=function(){null===this.previousNewRowPosition&&(this.previousNewRowPosition=this.parent.editSettings.newRowPosition)},e.prototype.beginAddEdit=function(e){var t=e.data;if("add"===e.action){var i=this.parent.grid.getPrimaryKeyFieldNames()[0],r=null;t.taskData=sf.base.isNullOrUndefined(t.taskData)?sf.base.extend({},e.data):t.taskData;var n=this.parent.grid.getCurrentViewRecords(),s=this.addRowIndex;t.uniqueID=sf.grids.getUid(this.parent.element.id+"_data_"),sf.base.setValue("uniqueIDCollection."+t.uniqueID,t,this.parent);var a=0,o=void 0,d=void 0,l=void 0,p=void 0,h=this.parent.enableVirtualization&&this.addRowIndex>-1&&"-1"!==this.prevAriaRowIndex,c=this.parent.getRows(),u=c.length?+c[0].getAttribute("aria-rowindex"):0,g=c.length?+c[c.length-1].getAttribute("aria-rowindex"):0,f=this.selectedIndex>=u&&this.selectedIndex<=g;if(n.length&&(o=n[this.addRowIndex][this.parent.idMapping],p=n[this.addRowIndex][this.parent.parentIdMapping],n[this.addRowIndex].parentItem&&(d=n[this.addRowIndex].parentItem.uniqueID),l=n[this.addRowIndex].parentItem),"Top"!==this.parent.editSettings.newRowPosition&&n.length){if(a=n[this.addRowIndex].level,"Above"===this.parent.editSettings.newRowPosition)r="before",s=n[this.addRowIndex].index;else if("Below"===this.parent.editSettings.newRowPosition){r="after";var y=O(n[this.addRowIndex]).length,b=n[this.addRowIndex].index;s=y>0?b+y:b}else if("Child"===this.parent.editSettings.newRowPosition){r="after",(this.selectedIndex>-1||h)&&f&&(t.parentItem=sf.base.extend({},n[this.addRowIndex]),t.parentUniqueID=t.parentItem.uniqueID,delete t.parentItem.childRecords,delete t.parentItem[this.parent.childMapping]);var m=O(n[this.addRowIndex]).length,v=n[this.addRowIndex].index;this.selectedIndex>=0&&(t.level=a+1),s=m>0?v+m:v,this.isSelfReference&&(t.taskData[this.parent.parentIdMapping]=t[this.parent.parentIdMapping]=o,sf.base.isNullOrUndefined(t.parentItem)||ge(i,t.parentItem,"add",this.parent,this.isSelfReference,t))}if("Above"!==this.parent.editSettings.newRowPosition&&"Below"!==this.parent.editSettings.newRowPosition||((this.selectedIndex>-1||h)&&a&&f&&(t.parentUniqueID=d,t.parentItem=sf.base.extend({},l),delete t.parentItem.childRecords,delete t.parentItem[this.parent.childMapping]),t.level=a,this.isSelfReference&&(t.taskData[this.parent.parentIdMapping]=t[this.parent.parentIdMapping]=p,sf.base.isNullOrUndefined(t.parentItem)||ge(i,t.parentItem,"add",this.parent,this.isSelfReference,t))),null!=r&&(this.selectedIndex>-1||h)&&f&&(e.index="before"===r?s:s+1),"Bottom"===this.parent.editSettings.newRowPosition){var w=this.parent.grid.dataSource instanceof sf.data.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource;e.index=w.length}}sf.base.isNullOrUndefined(t.level)&&(t.level=a),t.hasChildRecords=!1,t.childRecords=[],t.index=0}if("add"===e.action&&(this.internalProperties={level:t.level,parentItem:t.parentItem,uniqueID:t.uniqueID,taskData:t.taskData,parentUniqueID:sf.base.isNullOrUndefined(t.parentItem)?void 0:t.parentItem.uniqueID,childRecords:t.childRecords}),"delete"===e.requestType)for(var R=e.data,C=0;C<R.length;C++)if(R[C].parentItem){l=k(this.parent,R[C].parentItem.uniqueID);if(!sf.base.isNullOrUndefined(l)&&l.hasChildRecords){var x=l.childRecords.indexOf(R[C]);l.childRecords.splice(x,1)}}return e},e.prototype.addRecord=function(e,t,i){if(this.parent.editSettings.newRowPosition!==this.previousNewRowPosition&&null!==this.previousNewRowPosition||(this.previousNewRowPosition=this.parent.editSettings.newRowPosition),this.isSelfReference||sf.base.isNullOrUndefined(e)||!Object.hasOwnProperty.call(e,this.parent.childMapping))e?(t>-1?(this.selectedIndex=t,this.addRowIndex=t):(this.selectedIndex=this.parent.selectedRowIndex,this.addRowIndex=this.parent.selectedRowIndex),i&&this.parent.setProperties({editSettings:{newRowPosition:i}},!0),this.parent.grid.editModule.addRecord(e,t)):this.parent.grid.editModule.addRecord(e,t);else{var r=[],n=this.parent.editSettings.mode,s=this.parent.grid.editSettings.mode;r.push(e),this.parent.setProperties({editSettings:{mode:"Batch"}},!0),this.parent.grid.setProperties({editSettings:{mode:"Batch"}},!0),sf.base.isNullOrUndefined(i)||this.parent.setProperties({editSettings:{newRowPosition:i}},!0);var a={addedRecords:r,changedRecords:[],deletedRecords:[]};this.parent.notify("batchSave",{updatedRecords:a,index:t}),this.parent.setProperties({editSettings:{mode:n}},!0),this.parent.grid.setProperties({editSettings:{mode:s}},!0),this.parent.refresh()}},e.prototype.editFormValidate=function(){return this.parent.grid.editModule.editFormValidate()},e.prototype.destroyForm=function(){this.parent.grid.editModule.destroyForm()},e.prototype.contentready=function(e){sf.base.isNullOrUndefined(e.args.requestType)||"delete"!==e.args.requestType.toString()&&"save"!==e.args.requestType.toString()&&("Batch"!==this.parent.editSettings.mode||"batchsave"!==e.args.requestType.toString())||(this.updateIndex(this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords()),(this.parent.frozenRows||this.parent.getFrozenColumns()||this.parent.frozenColumns)&&this.parent.grid.dataSource.length===this.parent.getMovableDataRows().length&&this.updateIndex(this.parent.grid.dataSource,this.parent.getMovableDataRows(),this.parent.getCurrentViewRecords()))},e.prototype.editCell=function(e,t){"Cell"!==this.parent.editSettings.mode&&"Batch"!==this.parent.editSettings.mode||("Batch"!==this.parent.editSettings.mode&&(this.isOnBatch=!0,this.updateGridEditMode("Batch")),this.parent.grid.editModule.editCell(e,t))},e}(),Qe=function(){function e(e){sf.grids.Grid.Inject(sf.grids.CommandColumn),this.parent=e}return e.prototype.getModuleName=function(){return"commandColumn"},e.prototype.destroy=function(){},e}(),Ke=function(){function e(e){sf.grids.Grid.Inject(sf.grids.DetailRow),this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"detailRow"},e.prototype.addEventListener=function(){this.parent.on("dataBoundArg",this.dataBoundArg,this),this.parent.on("detaildataBound",this.detaildataBound,this),this.parent.grid.on("detail-indentcell-info",this.setIndentVisibility,this),this.parent.on("childRowExpand",this.childRowExpand,this),this.parent.on("rowExpandCollapse",this.rowExpandCollapse,this),this.parent.on("actioncomplete",this.actioncomplete,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("dataBoundArg",this.dataBoundArg),this.parent.off("detaildataBound",this.detaildataBound),this.parent.off("childRowExpand",this.childRowExpand),this.parent.off("rowExpandCollapse",this.rowExpandCollapse),this.parent.off("actioncomplete",this.actioncomplete),this.parent.grid.off("detail-indentcell-info",this.setIndentVisibility))},e.prototype.setIndentVisibility=function(e){e.visible=!1},e.prototype.dataBoundArg=function(){for(var e=this.parent.getRows().filter((function(e){return!e.classList.contains("e-detailrow")})),t=0;t<e.length;t++){var i=e[t].getElementsByClassName("e-detailrowcollapse"),r=this.parent.grid.getRowObjectFromUID(e[t].getAttribute("data-Uid")),n=sf.grids.getObject("parentItem",this.parent.grid.getCurrentViewRecords()[t]);(sf.base.isNullOrUndefined(n)||!sf.base.isNullOrUndefined(n)&&M(this.parent,r.data,this.parent.grid.getCurrentViewRecords()))&&this.parent.grid.detailRowModule.expand(i[0])}},e.prototype.childRowExpand=function(e){var t=e.row.getElementsByClassName("e-detailrowcollapse");sf.base.isNullOrUndefined(t[0])||this.parent.grid.detailRowModule.expand(t[0])},e.prototype.rowExpandCollapse=function(e){if(!C(this.parent))for(var t=0;t<e.detailrows.length;t++)e.detailrows[t].style.display=e.action},e.prototype.detaildataBound=function(e){var t=e.data,i=e.detailElement.parentElement.previousSibling,r="e-gridrowindex"+(sf.base.isNullOrUndefined(t.parentItem)?t.index:t.parentItem.index)+"level"+t.level,n=i.querySelector("."+r).classList,s=[].slice.call(n).filter((function(e){return e===r})),a=s[0].length,o="e-griddetail"+s.toString().slice(6,a);sf.base.addClass([e.detailElement.parentElement],o)},e.prototype.actioncomplete=function(e){if("beginEdit"===e.requestType||"add"===e.requestType){var t=e.row.querySelectorAll(".e-editcell")[0].getAttribute("colSpan"),i=(parseInt(t,10)-1).toString();e.row.querySelectorAll(".e-editcell")[0].setAttribute("colSpan",i)}for(var r=this.parent.grid.contentModule.getRows(),n=0;n<r.length;n++)r[n].cells[0].visible=!1;sf.grids.getObject("focusModule",this.parent.grid).refreshMatrix(!0)({rows:this.parent.grid.contentModule.getRows()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),We=(ve=function(e,t){return(ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ve(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ye=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.isExpandCollapse=!1,r.translateY=0,r.maxiPage=0,r.recordAdded=!1,r.startIndex=-1,r.endIndex=-1,r.preTranslate=0,r.isRemoteExpand=!1,r.isDataSourceChanged=!1,r.addEventListener(),r}return We(t,e),t.prototype.getModelGenerator=function(){return new qe(this.parent)},t.prototype.getRowByIndex=function(e){return this.parent.getDataRows().filter((function(t){return parseInt(t.getAttribute("aria-rowindex"),10)===e}))[0]},t.prototype.addEventListener=function(){this.parent.on("virtual-action-args",this.virtualOtherAction,this),this.parent.on("index-modifier",this.indexModifier,this)},t.prototype.virtualOtherAction=function(e){e.setTop?(this.translateY=0,this.startIndex=0,this.endIndex=this.parent.pageSettings.pageSize-1):e.isExpandCollapse&&(this.isExpandCollapse=!0)},t.prototype.indexModifier=function(e){var t=this.parent.getContent().querySelector(".e-content");if(this.recordAdded&&this.startIndex>-1&&this.endIndex>-1){if(this.endIndex>e.count-this.parent.pageSettings.pageSize){var i=~~(t.scrollTop/this.parent.getRowHeight()),r=i+this.parent.getRows().length;r>e.count&&(r=i+(e.count-i)),this.startIndex=r-this.parent.getRows().length,this.endIndex=r}else this.startIndex+=1,this.endIndex+=1;this.recordAdded=!1}this.isDataSourceChanged&&(this.startIndex=0,this.endIndex=this.parent.pageSettings.pageSize-1),e.startIndex=this.startIndex,e.endIndex=this.endIndex},t.prototype.eventListener=function(t){var i=this;this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&x(this.parent)?e.prototype.eventListener.call(this,"on"):(this.parent[t]("data-ready",this.onDataReady,this),this.fn=function(){i.observers.observes((function(e){return i.scrollListeners(e)})),i.parent.off("content-ready",i.fn)},this.parent.addEventListener("dataBound",this.dataBoundEvent.bind(this)),this.parent.addEventListener("rowSelected",this.rowSelectedEvent.bind(this)),this.parent[t]("select-virtual-Row",this.toSelectVirtualRow,this),this.parent.on("content-ready",this.fn,this),this.parent.addEventListener("actionComplete",this.onActionComplete.bind(this)),this.parent[t]("virtual-scroll-edit-action-begin",this.beginEdit,this),this.parent[t]("virtual-scroll-add-action-begin",this.beginAdd,this),this.parent[t]("virtual-scroll-edit-success",this.virtualEditSuccess,this),this.parent[t]("edit-reset",this.resetIseditValue,this),this.parent[t]("get-virtual-data",this.getData,this),this.parent[t]("virtual-scroll-edit-cancel",this.cancelEdit,this),this.parent[t]("select-row-on-context-open",this.toSelectRowOnContextOpen,this),this.parent[t]("refresh-virtual-editform-cells",this.refreshCell,this),this.parent[t]("virtaul-cell-focus",this.cellFocus,this))},t.prototype.cellFocus=function(t){e.prototype.virtualCellFocus.call(this,t)},t.prototype.onDataReady=function(t){e.prototype.onDataReady.call(this,t),this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&x(this.parent)||(sf.base.isNullOrUndefined(t.count)||(this.totalRecords=t.count,sf.base.getValue("virtualEle",this).setVirtualHeight(this.parent.getRowHeight()*t.count,"100%")),(!sf.base.isNullOrUndefined(t.requestType)&&"collapseAll"===t.requestType.toString()||this.isDataSourceChanged)&&(this.contents.scrollTop=0,this.isDataSourceChanged=!1))},t.prototype.renderTable=function(){e.prototype.renderTable.call(this),this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&x(this.parent)||(sf.base.getValue("observer",this).options.debounceEvent=!1,this.observers=new Je(sf.base.getValue("observer",this).element,sf.base.getValue("observer",this).options),this.contents=this.getPanel().firstChild)},t.prototype.getTranslateY=function(t,i,r,n){return this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||x(this.parent)?this.isRemoteExpand?(this.isRemoteExpand=!1,this.preTranslate):(this.preTranslate=e.prototype.getTranslateY.call(this,t,i,r,n),e.prototype.getTranslateY.call(this,t,i,r,n)):e.prototype.getTranslateY.call(this,t,i,r,n)},t.prototype.dataBoundEvent=function(){if(this.parent.getRows().length&&!this.initialRowTop&&!sf.base.isNullOrUndefined(this.parent.getRowByIndex(0))){var t=this.parent.getRowByIndex(0).getBoundingClientRect().top,i=this.parent.element.getBoundingClientRect().top;this.initialRowTop=t>0?this.parent.getRowByIndex(0).getBoundingClientRect().top-i:this.content.getBoundingClientRect().top-this.parent.getRowByIndex(0).getBoundingClientRect().height}e.prototype.dataBound.call(this)},t.prototype.rowSelectedEvent=function(t){e.prototype.rowSelected.call(this,t)},t.prototype.toSelectVirtualRow=function(t){if(!this.parent.isEdit){e.prototype.selectVirtualRow.call(this,t)}},t.prototype.refreshCell=function(e){e.cells=this.generateCells()},t.prototype.generateCells=function(){for(var e=[],t=0;t<this.parent.columns.length;t++)e.push(this.generateCell(this.parent.columns[t]));return e},t.prototype.generateCell=function(e,t,i,r,n,s){var a={visible:e.visible,isDataCell:!sf.base.isNullOrUndefined(e.field||e.template),isTemplate:!sf.base.isNullOrUndefined(e.template),rowID:t,column:e,cellType:sf.base.isNullOrUndefined(i)?sf.grids.CellType.Data:i,colSpan:r,commands:e.commands,isForeignKey:e.isForeignColumn&&e.isForeignColumn(),foreignKeyData:e.isForeignColumn&&e.isForeignColumn()&&sf.base.getValue(e.field,s)};return(a.isDataCell||"checkbox"===a.column.type||a.commands)&&(a.index=n),new sf.grids.Cell(a)},t.prototype.beginEdit=function(e){var t='.e-row[aria-rowindex="'+e.index+'"]',i=this.parent.getContent().querySelector(t).rowIndex,r=this.parent.getCurrentViewRecords()[i];e.data=r},t.prototype.beginAdd=function(t){var i={newRowPosition:this.rowPosition,addRowIndex:this.addRowIndex,ariaRowIndex:this.ariaRowIndex};this.parent.notify("get-row-position",i),this.rowPosition=i.newRowPosition,this.addRowIndex=i.addRowIndex,this.ariaRowIndex=i.ariaRowIndex;var r=this.parent.getRows(),n=r.length?+r[0].getAttribute("aria-rowindex"):0,s=r.length?+r[r.length-1].getAttribute("aria-rowindex"):0,a=this.parent.selectedRowIndex>=n&&this.parent.selectedRowIndex<=s;"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.isAdd=!0),"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.addRowIndex&&-1!==this.addRowIndex||-1!==this.parent.selectedRowIndex&&a)||e.prototype.addActionBegin.call(this,t)},t.prototype.restoreEditState=function(){e.prototype.restoreEdit.call(this)},t.prototype.resetIseditValue=function(){this.parent.notify("reset-edit-props",{}),"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition||!this.isAdd||e.prototype.resetIsedit.call(this)},t.prototype.virtualEditSuccess=function(){var e=this.parent.getContent().querySelector(".e-content");this.isAdd&&e.querySelector(".e-addedrow")&&(this.recordAdded=!0)},t.prototype.cancelEdit=function(t){e.prototype.editCancel.call(this,t)},t.prototype.toSelectRowOnContextOpen=function(t){e.prototype.selectRowOnContextOpen.call(this,t)},t.prototype.restoreNewRow=function(){var e=this.parent.getContent().querySelector(".e-content");this.isAdd&&!e.querySelector(".e-addedrow")&&(this.parent.isEdit=!1,this.parent.addRecord())},t.prototype.getData=function(t){e.prototype.getVirtualData.call(this,t)},t.prototype.onActionComplete=function(t){if("add"===t.requestType){var i={newRowPosition:this.rowPosition,addRowIndex:this.addRowIndex,ariaRowIndex:this.ariaRowIndex};this.parent.notify("get-row-position",i),this.rowPosition=i.newRowPosition,this.addRowIndex=i.addRowIndex,this.ariaRowIndex=i.ariaRowIndex}e.prototype.actionComplete.call(this,t)},t.prototype.scrollListeners=function(e){var t=e.sentinel,i=this.parent.getContent().querySelector(".e-content"),r=10*this.parent.getRowHeight(),n=e.offset.top-this.translateY<0,s=Math.ceil(e.offset.top-this.translateY)>=r;if(n){var a=+(this.parent.height.toString().indexOf("%")<0?this.parent.height:this.parent.element.getBoundingClientRect().height),o=~~(i.scrollTop/this.parent.getRowHeight())+Math.ceil(a/this.parent.getRowHeight())-this.parent.pageSettings.pageSize;if(o=o>0?o:0,sf.base.isNullOrUndefined(this.selectedRowIndex)||-1===this.selectedRowIndex||o===this.selectedRowIndex||(o=this.selectedRowIndex),this.startIndex=o,this.endIndex=o+this.parent.pageSettings.pageSize,this.endIndex>this.totalRecords){var d=this.totalRecords-1,l=this.endIndex%d;this.endIndex=d,this.startIndex=this.startIndex-l<0?0:this.startIndex-l}var p=Math.ceil(e.offset.top/this.parent.getRowHeight());p%=this.parent.pageSettings.pageSize;var h=0;if(!sf.base.isNullOrUndefined(this.parent.getRows()[p])&&!sf.base.isNullOrUndefined(this.parent.getContent().querySelectorAll(".e-content tr")[p]))h=+this.parent.getContent().querySelectorAll(".e-content tr")[p].querySelector("td").getAttribute("index");if(0===h)this.translateY=e.offset.top;else{var c=this.parent.getRowHeight();this.translateY=e.offset.top-10*c>0?e.offset.top-10*c+10:0}}else if(s){var u=~~(i.scrollTop/this.parent.getRowHeight()),g=!(this.selectedRowIndex+this.parent.pageSettings.pageSize<this.totalRecords);sf.base.isNullOrUndefined(this.selectedRowIndex)||-1===this.selectedRowIndex||u===this.selectedRowIndex||g||(u=this.selectedRowIndex);var f=u+this.parent.pageSettings.pageSize;f>this.totalRecords&&(f=u+(this.totalRecords-u)),this.startIndex=g?u:f-this.parent.pageSettings.pageSize,this.endIndex=f,e.offset.top>this.parent.getRowHeight()*this.totalRecords?this.translateY=this.getTranslateY(e.offset.top,i.getBoundingClientRect().height):this.translateY=e.offset.top}if(s&&e.offset.top<this.parent.getRowHeight()*this.totalRecords||n){var y=sf.base.getValue("getInfoFromView",this).apply(this,[e.direction,t,e.offset]);this.previousInfo=y;var b=y.loadNext&&!y.loadSelf?y.nextInfo.page:y.page;this.parent.setProperties({pageSettings:{currentPage:b}},!0),y.event="refresh-virtual-block"===y.event?"model-changed":y.event,this.parent.notify(y.event,{requestType:"virtualscroll",focusElement:e.focusElement})}},t.prototype.appendContent=function(t,i,r){if(this.parent.dataSource instanceof sf.data.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||x(this.parent))sf.base.getValue("isExpandCollapse",r)&&(this.isRemoteExpand=!0),e.prototype.appendContent.call(this,t,i,r);else{var n=r.virtualInfo.sentinelInfo&&"Y"===r.virtualInfo.sentinelInfo.axis&&sf.base.getValue("currentInfo",this).page&&sf.base.getValue("currentInfo",this).page!==r.virtualInfo.page?sf.base.getValue("currentInfo",this):r.virtualInfo,s=n.columnIndexes[0]-1,a=this.getColumnOffset(s);this.virtualEle.setWrapperWidth(null,sf.base.Browser.isIE||"edge"===sf.base.Browser.info.name),(t=this.parent.createElement("tbody")).appendChild(i);this.getTable().querySelector("tbody").replaceWith(t),this.isExpandCollapse&&0!==this.translateY?this.isExpandCollapse=!1:sf.base.getValue("virtualEle",this).adjustTable(a,this.translateY),sf.base.setValue("prevInfo",this.previousInfo?this.previousInfo:n,this);e.prototype.focusCell.call(this,r);this.isAdd&&!this.parent.getContent().querySelector(".e-content").querySelector(".e-addedrow")&&"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.ariaRowIndex>=this.startIndex?this.restoreNewRow():this.addRowIndex&&this.addRowIndex>-1&&(this.isAdd=!1,this.parent.isEdit=!1)),this.restoreEditState(),e.prototype.restoreAdd.call(this)}},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("data-ready",this.onDataReady),this.parent.off("content-ready",this.fn),this.parent.off("select-virtual-Row",this.toSelectVirtualRow),this.parent.off("dataBound",this.dataBoundEvent),this.parent.off("rowSelected",this.rowSelectedEvent),this.parent.off("virtual-action-args",this.virtualOtherAction),this.parent.off("index-modifier",this.indexModifier),this.parent.off("virtual-scroll-edit-action-begin",this.beginEdit),this.parent.off("virtual-scroll-add-action-begin",this.beginAdd),this.parent.off("virtual-scroll-edit-success",this.virtualEditSuccess),this.parent.off("edit-reset",this.resetIseditValue),this.parent.off("get-virtual-data",this.getData),this.parent.off("virtual-scroll-edit-cancel",this.cancelEdit),this.parent.off("select-row-on-context-open",this.toSelectRowOnContextOpen),this.parent.off("refresh-virtual-editform-cells",this.refreshCell),this.parent.off("virtaul-cell-focus",this.cellFocus))},t}(sf.grids.VirtualContentRenderer),Je=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isWheeling=!1,t.newPos=0,t.lastPos=0,t.timer=0,t}return We(t,e),t.prototype.observes=function(t){e.prototype.containerRect=sf.base.getValue("options",this).container.getBoundingClientRect(),sf.base.EventHandler.add(sf.base.getValue("options",this).container,"scroll",this.virtualScrollHandlers(t),this)},t.prototype.clear=function(){this.lastPos=null},t.prototype.virtualScrollHandlers=function(e){var t=this,i=0,r=0;return function(n){var s=n.target.scrollTop,a=n.target.scrollLeft,o=i<s?"down":"up";o=r===a?o:r<a?"right":"left",i=s,r=a;var d=sf.base.getValue("sentinelInfo",t)[o],l=0;t.newPos=s,null!=t.lastPos&&(l=t.newPos-t.lastPos),t.lastPos=t.newPos,t.timer&&clearTimeout(t.timer),t.timer=setTimeout(t.clear,0),(l>100||l<-100)&&n&&n.preventDefault&&(n.returnValue=!1,n.preventDefault()),e({direction:o,isWheel:t.isWheeling,sentinel:d,offset:{top:s,left:a},focusElement:document.activeElement})}},t}(sf.grids.InterSectionObserver),Xe=(we=function(e,t){return(we=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}we(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),$e=function(){function e(e){this.prevstartIndex=-1,this.prevendIndex=-1,this.parent=e,sf.grids.Grid.Inject(Ze),this.addEventListener()}return e.prototype.returnVisualData=function(e){e.data=this.visualData},e.prototype.getModuleName=function(){return"virtualScroll"},e.prototype.addEventListener=function(){this.parent.on("localPagedExpandCollapse",this.collapseExpandVirtualchilds,this),this.parent.on("pagingActions",this.virtualPageAction,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("localPagedExpandCollapse",this.collapseExpandVirtualchilds),this.parent.off("pagingActions",this.virtualPageAction))},e.prototype.collapseExpandVirtualchilds=function(e){this.parent.grid.notify("virtual-action-args",{isExpandCollapse:!0}),this.expandCollapseRec=e.record,e.record.expanded="collapse"!==e.action;var t={result:this.parent.flatData,row:e.row,action:e.action,record:e.record,count:this.parent.flatData.length};this.parent.grid.clearSelection();var i=sf.base.getValue("isCollapseAll",this.parent)?"collapseAll":"refresh";sf.base.getValue("grid.renderModule",this.parent).dataManagerSuccess(t,{requestType:i})},e.prototype.virtualPageAction=function(e){var t=this,i=new sf.data.DataManager(e.result),r=new sf.data.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),n=i.executeLocal((new sf.data.Query).where(r)),s=n.filter((function(e){return M(t.parent,e,n)}));this.visualData=s,this.parent.grid.notify("data-listener",{data:s});var a={startIndex:-1,endIndex:-1,count:e.count};this.parent.grid.notify("index-modifier",a);var o=a.startIndex,d=a.endIndex;if(e.count=s.length,-1===o&&-1===d){var l=new sf.data.Query,p=this.parent.grid.pageSettings.pageSize,h=p*(this.parent.grid.pageSettings.currentPage-1);l=l.skip(h).take(p),i.dataSource.json=s,e.result=i.executeLocal(l)}else{var c=e.actionArgs.requestType;if(("filtering"===c||"collapseAll"===c||"refresh"===c&&this.parent.enableCollapseAll&&d>s.length)&&(o=0,d=this.parent.grid.pageSettings.pageSize-1,this.parent.grid.getContent().firstElementChild.scrollTop=0,this.parent.grid.notify("virtual-action-args",{setTop:!0})),!sf.base.isNullOrUndefined(this.expandCollapseRec)){var u=this.parent.getRows(),g=s.indexOf(this.expandCollapseRec);s.slice(g,g+u.length).length<u.length&&g>=0?(o=g=(g=s.length-u.length)>0?g:0,d=s.length):sf.base.getValue("isCollapseAll",this.parent)&&(o=0,d=this.parent.grid.pageSettings.pageSize-1,this.parent.grid.notify("virtual-action-args",{setTop:!0})),this.expandCollapseRec=null}!sf.base.isNullOrUndefined(this.expandCollapseRec)&&this.parent.enableCollapseAll&&(o=e.count<this.parent.getRows()[0].getBoundingClientRect().height?s[0].index:-1===this.prevstartIndex?0:this.prevstartIndex),e.result=s.slice(o,d),this.prevstartIndex=o,this.prevendIndex=d}this.parent.notify("updateAction",e)},e.prototype.destroy=function(){this.removeEventListener()},e}(),Ze=function(e){function t(t,i){var r=e.call(this,t,i)||this;return sf.base.getValue("parent",r).off("initial-load",sf.base.getValue("instantiateRenderer",r),r),sf.base.getValue("parent",r).on("initial-load",r.instantiateRenderers,r),r}return Xe(t,e),t.prototype.getModuleName=function(){return"treeVirtualScroll"},t.prototype.instantiateRenderers=function(){sf.base.getValue("parent",this).log(["limitation","virtual_height"],"virtualization");var e=sf.base.getValue("locator",this).getService("rendererFactory");sf.base.getValue("addRenderer",e).apply(e,[sf.grids.RenderType.Content,new Ye(sf.base.getValue("parent",this),sf.base.getValue("locator",this))]),this.ensurePageSize()},t.prototype.ensurePageSize=function(){var e=sf.base.getValue("parent",this),t=e.getRowHeight();sf.base.isNullOrUndefined(e.height)||"string"!=typeof e.height||-1===e.height.indexOf("%")||(e.element.style.height=e.height);var i=2*~~((e.height.toString().indexOf("%")<0?e.height:e.element.getBoundingClientRect().height)/t),r=e.pageSettings.pageSize;e.setProperties({pageSettings:{pageSize:r<i?i:r}},!0)},t}(sf.grids.VirtualScroll),et=function(){function e(e){sf.grids.Grid.Inject(sf.grids.Freeze),this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("rowExpandCollapse",this.rowExpandCollapse,this),this.parent.on("dataBoundArg",this.dataBoundArg,this),this.parent.grid.on("dblclick",this.dblClickHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("rowExpandCollapse",this.rowExpandCollapse),this.parent.off("dataBoundArg",this.dataBoundArg),this.parent.grid.off("dblclick",this.dblClickHandler))},e.prototype.rowExpandCollapse=function(e){var t,i,r=this.parent.getMovableDataRows(),n=this.parent.getRows(),s=this.parent.getFrozenLeftColumnsCount()>0||this.parent.getFrozenRightColumnsCount()>0;s&&(i=this.parent.getFrozenRightRows().filter((function(t){return t.querySelector(".e-gridrowindex"+e.record.index+"level"+(e.record.level+1))}))),t=e.detailrows.length?e.detailrows:r.filter((function(t){return t.querySelector(".e-gridrowindex"+e.record.index+"level"+(e.record.level+1))}));for(var a=0;a<t.length;a++){var o=this.parent.grid.getRowObjectFromUID(t[a].getAttribute("data-Uid")).data;t[a].style.display=e.action,s&&(i[a].style.display=e.action);var d="none"===e.action?".e-treecolumn-container .e-treegridcollapse":".e-treecolumn-container .e-treegridexpand";if(n[t[a].rowIndex].querySelector(d)){for(var l=[],p=0;p<r.length;p++)r[p].querySelector(".e-gridrowindex"+o.index+"level"+(o.level+1))&&l.push(r[p]);l.length&&this.rowExpandCollapse({detailrows:l,action:e.action})}}},e.prototype.dblClickHandler=function(e){sf.grids.parentsUntil(e.target,"e-rowcell")&&this.parent.grid.editSettings.allowEditOnDblClick&&"Cell"!==this.parent.editSettings.mode&&this.parent.grid.editModule.startEdit(sf.grids.parentsUntil(e.target,"e-row"))},e.prototype.dataBoundArg=function(){this.parent.getColumns().filter((function(e){return e.showCheckbox})).length&&this.parent.freezeModule&&this.parent.initialRender&&sf.base.addClass([this.parent.element.getElementsByClassName("e-grid")[0]],"e-checkselection")},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getModuleName=function(){return"freeze"},e}(),tt=function(){function e(e){sf.grids.Grid.Inject(sf.grids.ColumnChooser),this.parent=e}return e.prototype.openColumnChooser=function(e,t){return this.parent.grid.columnChooserModule.openColumnChooser(e,t)},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"ColumnChooser"},e}(),it=function(){function e(e){this.parent=e,sf.grids.Grid.Inject(sf.grids.InfiniteScroll),this.addEventListener()}return e.prototype.getModuleName=function(){return"infiniteScroll"},e.prototype.addEventListener=function(){this.parent.on("pagingActions",this.infinitePageAction,this),this.parent.on("infinite-remote-expand",this.infiniteRemoteExpand,this),this.parent.grid.on("delete-complete",this.infiniteDeleteHandler,this),this.parent.grid.on("infinite-edit-handler",this.infiniteEditHandler,this),this.parent.grid.on("infinite-crud-cancel",this.createRows,this),this.parent.grid.on("content-ready",this.contentready,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("infinite-remote-expand",this.infiniteRemoteExpand),this.parent.grid.off("delete-complete",this.infiniteDeleteHandler),this.parent.grid.off("infinite-edit-handler",this.infiniteEditHandler),this.parent.off("pagingActions",this.infinitePageAction),this.parent.grid.off("infinite-crud-cancel",this.createRows),this.parent.grid.off("content-ready",this.contentready))},e.prototype.infiniteRemoteExpand=function(e){for(var t=this.parent.grid.getRowsObject(),i=this.parent.grid.infiniteScrollModule.serviceLocator,r=new sf.grids.RowRenderer(i,null,this.parent.grid),n=this.parent.getRows(),s=e.index===n.length-1?"after":"before",a=this.parent.grid.getColumns(),o=this.parent.grid.infiniteScrollModule.generateRows(e.childData,e),d=[],l=0;l<o.length;l++)d.push(r.render(o[l],a));t.splice.apply(t,[e.index+1,0].concat(o));for(l=0;l<d.length;l++)"after"===s?n[e.index+l][s](d[l]):n[e.index+l+1][s](d[l]),n.splice(e.index+1+l,0,d[l]);sf.grids.resetRowIndex(this.parent.grid,this.parent.grid.getRowsObject(),this.parent.grid.getRows(),0)},e.prototype.contentready=function(){if(this.parent.infiniteScrollSettings.enableCache&&!sf.base.isNullOrUndefined(this.parent.editModule)){this.parent.editModule.updateIndex(this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords()),this.parent.getFrozenColumns()&&this.parent.editModule.updateIndex(this.parent.grid.dataSource,this.parent.getMovableDataRows(),this.parent.getCurrentViewRecords())}},e.prototype.infinitePageAction=function(e){var t=new sf.data.DataManager(e.result),i=new sf.data.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),r=t.executeLocal((new sf.data.Query).where(i)),n=sf.base.getValue("actionArgs",e.actionArgs),s=!!sf.base.getValue("actions",this.parent.grid.infiniteScrollModule).some((function(e){return e===n.requestType}))||!!this.parent.initialRender;if(this.visualData=r,e.count=r.length,sf.base.getValue("isPrinting",e.actionArgs))e.result=r;else{var a=new sf.data.Query,o=this.parent.infiniteScrollSettings.enableCache;o&&this.parent.infiniteScrollSettings.initialBlocks>this.parent.infiniteScrollSettings.maxBlocks&&(this.parent.infiniteScrollSettings.initialBlocks=this.parent.infiniteScrollSettings.maxBlocks);var d=s?this.parent.pageSettings.pageSize*this.parent.infiniteScrollSettings.initialBlocks:this.parent.pageSettings.pageSize,l=this.parent.grid.pageSettings.currentPage;if(sf.base.isNullOrUndefined(n))a=a.page(l,d);else{var p=sf.base.getValue("lastIndex",this.parent.grid.infiniteScrollModule),h=sf.base.getValue("firstIndex",this.parent.grid.infiniteScrollModule);if(o||"delete"!==n.requestType)a=o&&"delete"===n.requestType||"save"===n.requestType&&"add"===n.action?(a=a.skip(h)).take(this.parent.infiniteScrollSettings.initialBlocks*this.parent.pageSettings.pageSize):a.page(l,d);else{var c=p-n.data.length+1,u=n.data.length;a=a.skip(c).take(u)}}t.dataSource.json=r,o||sf.base.isNullOrUndefined(n)||"save"!==n.requestType||"add"!==n.action?e.result=t.executeLocal(a):e.result=[n.data]}this.parent.notify("updateAction",e)},e.prototype.infiniteEditHandler=function(e){var t=this.parent.grid.infiniteScrollModule.infiniteCurrentViewData,i=Object.keys(t);if("delete"===e.e.requestType&&e.result.length>1)for(var r=1;r<e.result.length;r++)t[i[i.length-1]].push(e.result[r])},e.prototype.infiniteDeleteHandler=function(e){if("delete"===e.requestType){var t=this.parent.grid.getRowsObject(),i=this.parent.getRows(),r=e.data instanceof Array?e.data:[e.data],n=this.parent.grid.getPrimaryKeyFieldNames()[0];if(this.removeRows(i,t,r,n,!0),this.parent.getFrozenColumns()>0){var s=this.parent.grid.getMovableRowsObject(),a=this.parent.grid.getMovableRows();this.removeRows(a,s,r,n)}}},e.prototype.removeRows=function(e,t,i,r,n){for(var s=this,a=function(a){t.filter((function(o,d){if(o.data[r]===i[a][r]){if(n){var l=Math.ceil((d+1)/s.parent.grid.pageSettings.pageSize);s.parent.grid.infiniteScrollModule.resetInfiniteCurrentViewData(l,d)}t.splice(d,1),sf.base.remove(e[d]),e.splice(d,1)}}))},o=0;o<i.length;o++)a(o)},e.prototype.createRows=function(e){var t,i,r=e.args.e,n=e.row,s=this.parent.grid.infiniteScrollModule.serviceLocator,a=new sf.grids.RowRenderer(s,null,this.parent.grid),o=this.parent.getCurrentViewRecords(),d=e.isMovable?this.parent.grid.getMovableRows():this.parent.grid.getDataRows();t=e.isFrozenRight?this.parent.element.querySelector(".e-frozen-right-content").querySelector("tbody"):this.parent.grid.isFrozenGrid()?e.isMovable?this.parent.grid.getMovableVirtualContent().querySelector("tbody"):this.parent.grid.getFrozenVirtualContent().querySelector("tbody"):this.parent.getContent().querySelector("tbody"),this.parent.frozenRows&&(t=e.isFrozenRows&&"add"!==this.parent.grid.infiniteScrollModule.requestType||!e.isFrozenRows&&"add"===this.parent.grid.infiniteScrollModule.requestType?this.parent.grid.isFrozenGrid()?e.isMovable?this.parent.grid.getMovableVirtualHeader().querySelector("tbody"):e.isFrozenRight?this.parent.element.querySelector(".e-frozen-right-header").querySelector("tbody"):this.parent.grid.getFrozenVirtualHeader().querySelector("tbody"):this.parent.getHeaderContent().querySelector("tbody"):t);for(var l=this.parent.editModule.addRowIndex,p=0;p<n.length;p++){var h=a.render(n[p],this.parent.grid.getColumns());"save"===r.requestType&&"add"===r.action?-1!==sf.base.getValue("selectedIndex",this.parent.editModule)&&"Top"!==this.parent.editSettings.newRowPosition?"Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition?(i="after",l+=O(o[l+1]).length,"Child"===this.parent.editSettings.newRowPosition&&(l-=1),d[l][i](h)):"Above"===this.parent.editSettings.newRowPosition&&(i="before",d[this.parent.editModule.addRowIndex][i](h)):"Bottom"===this.parent.editSettings.newRowPosition?t.appendChild(h):t.insertBefore(h,t.firstElementChild):"delete"===r.requestType&&t.appendChild(h)}e.cancel=!0},e.prototype.destroy=function(){this.removeEventListener()},e}();return De.Inject(Ue,Le,je,Me,Ve,Fe,Oe,ze,Be,Te,Qe,_e,Ge,L,$e,Ke,Pe,et,tt,m,it),e.TreeGrid=De,e.load="load",e.rowDataBound="rowDataBound",e.dataBound="dataBound",e.queryCellInfo="queryCellInfo",e.beforeDataBound="beforeDataBound",e.actionBegin="actionBegin",e.dataStateChange="dataStateChange",e.actionComplete="actionComplete",e.rowSelecting="rowSelecting",e.rowSelected="rowSelected",e.checkboxChange="checkboxChange",e.rowDeselected="rowDeselected",e.toolbarClick="toolbarClick",e.beforeExcelExport="beforeExcelExport",e.beforePdfExport="beforePdfExport",e.resizeStop="resizeStop",e.expanded="expanded",e.expanding="expanding",e.collapsed="collapsed",e.collapsing="collapsing",e.remoteExpand="remoteExpand",e.localPagedExpandCollapse="localPagedExpandCollapse",e.pagingActions="pagingActions",e.printGridInit="printGrid-Init",e.contextMenuOpen="contextMenuOpen",e.contextMenuClick="contextMenuClick",e.beforeCopy="beforeCopy",e.beforePaste="beforePaste",e.savePreviousRowPosition="savePreviousRowPosition",e.crudAction="crudAction",e.beginEdit="beginEdit",e.beginAdd="beginAdd",e.recordDoubleClick="recordDoubleClick",e.cellSave="cellSave",e.cellSaved="cellSaved",e.cellEdit="cellEdit",e.batchDelete="batchDelete",e.batchCancel="batchCancel",e.batchAdd="batchAdd",e.beforeBatchDelete="beforeBatchDelete",e.beforeBatchAdd="beforeBatchAdd",e.beforeBatchSave="beforeBatchSave",e.batchSave="batchSave",e.keyPressed="key-pressed",e.updateData="update-data",e.doubleTap="double-tap",e.virtualColumnIndex="virtualColumnIndex",e.virtualActionArgs="virtual-action-args",e.dataListener="data-listener",e.indexModifier="index-modifier",e.beforeStartEdit="edit-form",e.beforeBatchCancel="before-batch-cancel",e.batchEditFormRendered="batcheditform-rendered",e.detailDataBound="detailDataBound",e.rowDrag="rowDrag",e.rowDragStartHelper="rowDragStartHelper",e.rowDrop="rowDrop",e.rowDragStart="rowDragStart",e.rowsAdd="rows-add",e.rowsRemove="rows-remove",e.rowdraging="row-draging",e.rowDropped="row-dropped",e.DataManipulation=K,e.Reorder=Me,e.Resize=Oe,e.RowDD=Pe,e.Column=a,e.EditSettings=oe,e.Predicate=l,e.FilterSettings=p,e.PageSettings=ee,e.SearchSettings=z,e.SelectionSettings=G,e.AggregateColumn=re,e.AggregateRow=ne,e.SortDescriptor=pe,e.SortSettings=he,e.RowDropSettings=ke,e.InfiniteScrollSettings=xe,e.Render=Q,e.TreeVirtualRowModelGenerator=qe,e.isRemoteData=C,e.isCountRequired=x,e.isCheckboxcolumn=S,e.isFilterChildHierarchy=I,e.findParentRecords=D,e.getExpandStatus=M,e.findChildrenRecords=O,e.isOffline=P,e.extendArray=E,e.getPlainData=A,e.getParentData=k,e.isHidden=N,e.Filter=Ue,e.ExcelExport=Be,e.PdfExport=Te,e.Page=Le,e.Toolbar=Ve,e.Aggregate=Fe,e.Sort=je,e.TreeClipboard=R,e.ColumnMenu=ze,e.ContextMenu=_e,e.Edit=Ge,e.CommandColumn=Qe,e.Selection=L,e.DetailRow=Ke,e.VirtualScroll=$e,e.TreeVirtual=Ze,e.Freeze=et,e.ColumnChooser=tt,e.Logger=m,e.treeGridDetails=v,e.InfiniteScroll=it,e},sf.treegrid=sf.treegrid({})}});