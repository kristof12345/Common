@page "/stock"

<Container Margin=@(new Border("70px", "0px", "0px", "0px")) Padding=@(new Border("10px")) Width="auto">
    <Paper Width="1920px" Margin=@(new Border("0px", "30px")) Padding=@(new Border("120px", "20px" )) VerticalAlign=@VerticalAlignment.Start>
        <Horizontal HorizontalAlign=@HorizontalAlignment.Center Height="40px">
            <Heading>@Model.Name</Heading>
        </Horizontal>
        <StockChart Data=@Model.Prices StartDate=@(new DateTime(2016,1,1)) EndDate=@(new DateTime(2017,1,1)) />
        <Paragraph> Company description </Paragraph>
        <Paragraph Align="justify"> @Model.Description</Paragraph>
    </Paper>
</Container>

<ThemeToggle />

@code
{
    [Inject]
    private DataService StockService { get; set; }

    [Inject]
    private CacheService CacheService { get; set; }

    private DemoStock Model { get; set; } = new DemoStock();

    protected override async Task OnInitializedAsync()
    {
        var model = CacheService.Get<DemoStock>("AAPL");

        if (model == null)
        {
            model = await StockService.LoadFromJson<DemoStock>("aapl.json");
            CacheService.Set("AAPL", model, 0);
        }

        Model = model;
    }
}