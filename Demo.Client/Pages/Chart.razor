@page "/chart"

@using Common.Application
@using System.Timers
@using System.Collections.ObjectModel
@using Syncfusion.Blazor.Charts

<Paper Width="1920px" Margin=@Border.Top("30px") Padding=@(new Border("120px", "20px" ))>
    <MultiSeriesChart Data=@MultiSeriesList StartDate=@(new DateTime(2020,1,1)) EndDate=@(new DateTime(2020,1,2)) />
</Paper>

<Paper Width="1920px" Margin=@Border.Top("30px") Padding=@(new Border("120px", "20px" ))>
    <SingleSeriesChart Data=@Series StartDate=@(new DateTime(2020,1,1)) EndDate=@(new DateTime(2020,1,2)) Color=@Colors.Primary IntervalType=@Syncfusion.Blazor.Charts.RangeIntervalType.Months />
</Paper>

<Paper Width="1920px" Margin=@Border.Top("30px") Padding=@(new Border("120px", "20px" ))>
    <SingleSeriesChart Data=@ZeroList StartDate=@(new DateTime(2020,1,1)) EndDate=@(new DateTime(2020,1,2)) Type=@ChartSeriesType.Area IntervalType=@RangeIntervalType.Months Color=@Colors.Secondary Opacity="0.75" />
</Paper>

<Paper Width="1920px" Margin=@Border.Top("30px") Padding=@(new Border("120px", "20px" ))>
    <RealtimeSeriesChart Data=@RealTimeData Color=@Colors.Primary />
</Paper>

@code
{
    [Inject]
    private DataService StockService { get; set; }

    private List<Price> ZeroList;

    private List<StockPrice> Series;

    private List<ChartDataSeries> MultiSeriesList;

    private static Timer timer;
    private Random randomNum = new Random();
    public ObservableCollection<ITemporalValue> RealTimeData;

    protected override async Task OnInitializedAsync()
    {
        RealTimeData = new ObservableCollection<ITemporalValue>();

        for (int i = 0; i < 360; i++)
        {
            RealTimeData.Add(new Price
            {
                Date = DateTime.Now.AddSeconds(i - 360),
                Value = randomNum.Next(30, 80)
            });
        }

        timer = new Timer(1000);
        timer.Elapsed += AddData;
        timer.AutoReset = true;

        await Task.Delay(new TimeSpan(0, 0, 5)).ContinueWith(o => { timer.Start(); });

        ZeroList = new List<Price>
{
                    new Price
                    {
                        Date= new DateTime(2020,1,1),
                        Value=0
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,2),
                        Value=0
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,3),
                        Value=0
                    }

        };

        Series = await StockService.LoadFromJson<List<StockPrice>>("exchange.json");

        MultiSeriesList = new List<ChartDataSeries>
{
        new ChartDataSeries
        {
            Label = "Series 1",
            Color = Colors.Get(1),
            Data = new List<Price>
{
                new Price
                {
                    Date= new DateTime(2020,1,1),
                    Value=1
                },
                new Price
                {
                    Date= new DateTime(2020,1,2),
                    Value=2
                },
                new Price
                {
                    Date = new DateTime(2020, 1, 3),
                    Value = 3
                }
            }
        },
        new ChartDataSeries
        {
            Label = "Series 2",
            Color = Colors.Get(2),
            Data = new List<Price>
{
                    new Price
                    {
                        Date= new DateTime(2020,1,1),
                        Value=11
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,2),
                        Value=12
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,3),
                        Value=13
                    }
                }
        },
        new ChartDataSeries
        {
            Label = "Series 3",
            Color = Colors.Get(3),
            Data = new List<Price>
{
                    new Price
                    {
                        Date= new DateTime(2020,1,1),
                        Value=10
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,2),
                        Value=20
                    },
                    new Price
                    {
                        Date= new DateTime(2020,1,3),
                        Value=30
                    }
                }
        }
    };
    }

    private void AddData(Object source, ElapsedEventArgs e)
    {
        RealTimeData.RemoveAt(0);
        RealTimeData.Add(new Price
        {
            Date = DateTime.Now,
            Value = randomNum.Next(30, 80)
        });
    }

    public class Price : ITemporalValue
    {
        public DateTime Date { get; set; }

        public decimal Value { get; set; }
    }
}