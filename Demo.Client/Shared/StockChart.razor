<div class="finance-chart" style="height: 450px;">
    @if (Data == null)
    {
        <LoadingIndicator />
    }
    else
    {
        <div class="chart">
            <SfChart Theme=@ChartTheme.Material Background=@Colors.Transparent Height="350">

                <ChartPrimaryXAxis ValueType=@Syncfusion.Blazor.Charts.ValueType.DateTimeCategory LabelFormat="  yyyy.MM.dd  " LabelIntersectAction=@LabelIntersectAction.Hide EdgeLabelPlacement=@EdgeLabelPlacement.Shift>
                    <ChartAxisMajorGridLines Width="0"></ChartAxisMajorGridLines>
                </ChartPrimaryXAxis>

                <ChartPrimaryYAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Double" Span="1" OpposedPosition="true" LabelIntersectAction=@LabelIntersectAction.Hide RowIndex="1" RangePadding=@ChartRangePadding.Additional Minimum=@Minimum Maximum=@Maximum>
                    <ChartAxisMajorGridLines Width="1"></ChartAxisMajorGridLines>
                </ChartPrimaryYAxis>

                <ChartAxes>
                    <ChartAxis Name="Volume" ValueType="Syncfusion.Blazor.Charts.ValueType.Double" RowIndex="1" Visible="false" Maximum=@VolumeMax Minimum=@VolumeMin>
                        <ChartAxisMajorGridLines Width="0"></ChartAxisMajorGridLines>
                    </ChartAxis>
                </ChartAxes>

                <ChartRows>
                    <ChartRow Height="0%"></ChartRow>
                    <ChartRow Height="100%"></ChartRow>
                </ChartRows>

                <ChartSeriesCollection>
                    <ChartSeries DataSource=@RangedData XName="Date" Open="Open" Close="Close" High="High" Low="Low" Type=@ChartSeriesType.Candle />
                    <ChartSeries DataSource=@RangedData XName="Date" YName="Volume" Type=@ChartSeriesType.Column Fill=@Colors.Warning YAxisName="Volume" />
                </ChartSeriesCollection>

            </SfChart>
        </div>

        <div class="range">
            <SfRangeNavigator ValueType=@RangeValueType.DateTime Theme=@ChartTheme.Material Height="100" IntervalType=@IntervalType Interval="1" LabelFormat=@IntervalType.ToFormat()>
                <RangeNavigatorEvents Changed=@RangeChanged></RangeNavigatorEvents>
                <RangeNavigatorSeriesCollection>
                    <RangeNavigatorSeries DataSource=@Data Type=@RangeNavigatorType.Line Fill=@Colors.Warning Width="2" XName="Date" YName="Close" />
                </RangeNavigatorSeriesCollection>
            </SfRangeNavigator>
        </div>
    }
</div>

@code
{
    [Parameter]
    [EditorRequired]
    public IEnumerable<StockPrice> Data { get; set; }

    [Parameter]
    [EditorRequired]
    public DateTime StartDate { get; set; }

    [Parameter]
    [EditorRequired]
    public DateTime EndDate { get; set; }

    [Parameter]
    public decimal? Minimum { get; set; } = null;

    [Parameter]
    public decimal? Maximum { get; set; } = null;

    [Parameter]
    public RangeIntervalType IntervalType { get; set; } = RangeIntervalType.Auto;

    private IEnumerable<StockPrice> RangedData { get => Data.Where(d => d.Date >= StartDate && d.Date <= EndDate); }

    private decimal VolumeMin { get => RangedData.Any() ? RangedData.Min(s => s.Volume) * 1 : 0; }

    private decimal VolumeMax { get => RangedData.Any() ? RangedData.Max(s => s.Volume) * 4 : 0; }

    private void RangeChanged(IChangedEventArgs args)
    {
        StartDate = (DateTime)args.Start;
        EndDate = (DateTime)args.End;
    }
}